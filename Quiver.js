// This file is generated from /src/Quiver-Dev.js and /src/functions/
var QUIVER_ASSETS_PATH=api.getTempFolder()+"/quiver_assets/",QUIVER_EMBEDDED_ASSETS={"quiver_text-paste_v01.png":"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","quiver_text-import_v01.png":"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","quiver_icon-settings_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAG1BMVEVMaXH////////////////////////////////liRbkAAAACHRSTlMA5R6DpDrBZrQgvs4AAAAJcEhZcwAAWJUAAFiVAdltN9MAAAJjSURBVHja7ZvrkoIwDIXNpZf3f+JVd3RdKcWmCUTN+cuMfAM1l5NwOoVCoVAoFAq9qzBDfRbjARxLjLNgfxKuTeXdQdocFbyA1AD5UhAsTCgBScRFPWbQOAjpxpZb7KJRENKNcn8xlMZASDfePsZyGgEh3cj/P6fQ6yCkm4Oec9uNJK2BYItjnmSZY6mb8+7XSTcvt3L95U5ItXZJSLdCWKk5mKF2tHZdToLd+41LSqLNISXR5xCSGHCISEo1UdEqjmfFwyBkA0LDIMkGRHBayccDeZ0E8llgyPECCXC5P+pUGIw4tkhyWpwrtuHokrQbf2QTjnWS5dPYzAw0VxnR+I+SBUe7xNmI0wUMOBrJD9JmMAQLt4KHORokbABSJLlbAwREL5vUvTUSvuyse1gXfQNKszcnDf9U8q574f4VP7ZfMw+8apysXVmt0MvdjCn2xq5KajUeTIGAYkMyBcKKjcAUSFFsjaZABkMBmoFomcKzIKDZPs+ADM9icoB8G4ibw+rm7zvqKaTPD/Fukt6uZQDsUxhV6wJPr+h0Uzx3vRaldgLycOO3MKOS9IEQ6rac2bZlFgz1jFrmd7Al3Bg1XqwrL2aeF3uThiNjynsaz3tb4P2hwNKMSvmI4cTvmCQ9bP/AUeOanQZHXkZpaDNcTO87bnUzgHYzkkebJYV3Xttws8jiZ7XHz7LT+vpXL8pc+wbSXhBfXYijjUBB2ovqa90EbsVw9aGel6VJP2ukfhZr/awa+1m+vuRipiRZR0d62P45xZcCAXIICHgByVrF8cd8DNZq/AX+aSgUCoVCoZAb/QAiPqgxf4MN6gAAAABJRU5ErkJggg==","quiver_icon-rectangle_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAJ1BMVEVMaXH7+/v8/Pz///////////////////81NTVTU1NoaGizs7OamppgGXzMAAAAB3RSTlMA3vNcQCCQ5g43tgAAAAlwSFlzAABYlQAAWJUB2W030wAAAVVJREFUeNrtm+tuhCAQhZdBuajv/7zdbCraLSUlDOmk+c5fmZMvg3JJjo8HQgih+VqCkxjFheVPfb2LRc7rYXT6rrfhr5JVB6PX10t8k6g0pdfXx4oUSHp9V6kVyPDsdPu6WJUbBen19fEH+QkT0/It4HJsKeVdqyW9vkt5ntNLuTgMrWzdvuF8/Dn+WSFRU999Q7ODeyo6NDkqvvW5kXfwlLYpDbl8pQpyFqSbNEFqvrZBzqnZrvFZE6TiK82X9bgKdk2Qiq9rfr6SpzSk5htsL2i3vWl/lmyHaC/xv/U1s+mZOQbYORiZOSraOTzbuU7YuWB9WYG0r5zdvs29cUDdvoAAAggggAACCCCAAAIIIIAAAggggAACCCCAAAIIIIAAAggggAACyAxfIyEFcvHk4snFk4snF08unlw8uXhy8eTiycWTiycX/w9z8TZ+xUYIITSmD7ureNE6xI3GAAAAAElFTkSuQmCC","quiver_icon-align_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAGFBMVEVMaXH////////////////////////////eQubUAAAAB3RSTlMAgKXiI2RGK0DVagAAAAlwSFlzAABYlQAAWJUB2W030wAAAnpJREFUeNrt2uuSgjAMBWCS9PL+b7zrrkp1UJI0R3Am+bPrCPhJT0upLEtWVlZWVlZWVlbW91aVLuTYr3ANdVC/FNsd0nsJdzgkv44OcJgllx0F4TBKqq89NQ7TcS8B6Z0wDovkz9EbyKGXXPcsKIdWUq9b4xw6yX9AojrNtkMlEe/QY3EoDs+3LQnq2JWsu7ZQhzz93ZOUdbsS6eDb/0QqSVnB81mt40feISOP9gMSkVUZj7VCBolosjWf1YfvNECGj3nR/G0MdQ07I7w8Qe4vZDcgIZ2GxjZ+gNxe0V6bBg3wNGTtEfLw1vvBJ2SAb0Rt2YSMb73ubLGzom2IZgTpobMiK0SerwRbVfGQd1enkK6khNR+DkhROgTdNKJ0FDCE4Q2jgyiDOtejFRBtQBg8jhSBB1UHYXxQVRD6QFA1kPaJoCog2oAw+qL3maDuQ+pnghoGafj5CMtWdcAciRwHY8Sk0QOR+Fm0C1LCg+qEUHhQnRCBTObtkIK5u7FDanxQfRCOD6oPEroyMQFpoLtOM4RBt+FmiCAC4oA0kMMMIURQPRABLY9YIQW0XmSGVExA7BBGOYyQggmqHVIxQbVDGBNUO0RAAbFCGs5hgzAoqB4ILWeAFIE5XDdYCfkmCDmfmIqG8PzcIATSAmYpFLl8PSOJhUxIQptmRhITVpqXRHXfaUnUgDYtoei1dK8kboiflARea+YkhHmEiv3Ps1JAyYRE+xO3uaySgoKYG1tQEDlL23TfpOb4M6L/QdVY1fWI/vFZvfadSsHjyKF3BZyOdKTDMyYe6mgncQwn5ODVDTqJ4940h6/2XDvN8Y7/FaO6ZGVlZWVlHV8/wptNKj8NpEwAAAAASUVORK5CYII=","quiver_icon-flatten_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAIVBMVEX///9MaXH///////////////////////////////////+zsAL3AAAACnRSTlMzABUg3+/JcUKYIINMbgAAAAlwSFlzAABYlQAAWJUB2W030wAAA0RJREFUeNrt2+GS4yAIAGCCxmje/4Gvt3vdJlEUFHXnRv52pvM1NsQgwPZLAhZkQRZkQRZkQRbkP4b44Kx1wU+GeHf+C2tmQo7zEsc8yM2RkgyC+PMRfhLEPiFuDiS6IPElYUIQDXyHMSiHhBgSKiA/iHeILTaGODEkYnwFNq7MaaWQJENIce0QBDpMJpU7Fz4fQ8IhXJqc4xXpS/j+/W+KsSmI6M9qoBCJ5YH9vD9TMLUwstu36EhILo5vCeGwgoSGwIic46+EcEhSPMvxkDwcLwnhkDz0eI7b4kQOKiTbANPPYb1kY9TksAep2IVbRdPkMBshcV66eW50bEmJ9eJdvGl1pCQO5a8T7Y5YknUQEFRwPCV5Rz2k7LhLCg4CYlQcN4k1NRAlh0RSB+E6BJIqCN/Bl9RAJI6bxOlCZI6bxGtCpI6rJChC5I6LRBFS4/hInFpCq3P8vFA4rRTf6JAvzdbHcSrtR5oddlOBNDt2U1Fn7eGAmoIvDnawXyd6O2gIjnUwXzn7O3gv4QMcrLLECAenUDPEwShdjXEUinlG3YFYd4KF2g6yPis4FNBxUBIY7iAkMN6RlsAER7pQPMORksAUR6pkPccRS2CSI5LALMdTAtMcDwnMc9wPFGCi4/5Anei4XZLCNqCvgw+xfR1syNHZwYa4zg42ZO/sMFzI++uhj4OfR1gF/XoHP7NahkTJwb1rSImWIw/BvSRRcxQS2lE4+NFzlJ41eYmio/j0zUk0HeX9CC1RdTB2aIGQ6DqKEAzEkamyo1gNcMQhsraj1OzkiGN1dUchoSX6Yb4k+o4sJN0f9JJ0cOQg3hI9INDBQUO8YzTp6DkIiA+sdiFFRxJCrEno6UhBiPag8PxA1ZGAUG1K+PhI1xFDPO24SZQdMcRmHBeJVXZEEJ91vHJqeN3WuztQ2RFBQrKnz7S03/K6koHRnnxCf0cEsYz25IY+oDaI31okWDfo4xhdwdV9L41/1rA1SLB29MnLVyYnwfoZLCdfGV6fR3OK91u1BJum0opDSlX9FTWnnEeVI5Zg85zeZ2/svOi7GhzkVjEz2reJ+xrGTy6aaof2MBgWRm9GznIi4ramWxdkQRZkQRbkF0L+AArNkvas99yQAAAAAElFTkSuQmCC","quiver_icon-text-horizontal-left_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAElBMVEVMaXH////////////////////7e1ULAAAABXRSTlMAomHpI0HHT/8AAAAJcEhZcwAAWJUAAFiVAdltN9MAAADTSURBVHja7dqLFcQgCERRAe2/5U0JGhnDJu9WMCd+jgRaAwAAAADgi7rFULG+kEMX4xLzSWxI2XQQbY4R00FCnOT/lqbMZr2Ory7GyvEFAABAQX5XT30J+s7r2RNz7L2P85LEqbpFXXJW+SJRZY/kLc3eJ7HU82u3OZcwAADAuytOk1l6SlqNTpq6g+VVenpRpctZprkYp0rOxN8WyiSxdH57dxUuaQAAgPb2edYTg21zI4KhT2IPdIh2Kr2QB4nT3czyS1Nms87MszKXCgAAgK/5ASKeK+fs6AOdAAAAAElFTkSuQmCC","quiver_icon-text-vertical-top_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAFVBMVEX///9MaXH///////////////////8m1qDYAAAABnRSTlMzAAcFHLfEJvOyAAAACXBIWXMAAFiVAABYlQHZbTfTAAABh0lEQVR42u3cUbKDIAwF0Jhc3P+S24+ODzRSnXkJOL3ZQA8hYH8uskxSQsjTIBpWlyGmgIQWoN8hFozYMNqFZDEcSgNRSS09g0CSCz4k3dFIxHO8xzqy4EnkOB8afHVZvWjdQ9Tbt8DaKLaDINfxt3K0EE3aFqcn1kCQ3I/jb34gH13yB7duidQ7g1yI1uMgdZfS/4NUy68hbUNQ1n+vAmdKaohzZLCGFJxx7UNKDKQ0d+weYg5kDSoHos+AJG5NH5IxrJcgGcf3GiShCCGEkB+G9C67gjwIblzjoZBy48MWCrnzqf8NyDRbM82wTnN8ebMSQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIYQQQgghhBBCCCGEEEIIIUMgyyCInmQnMB6CMRCc5GsmCProkCHBMfpkI8Ngc8bjTNIl6gYGtxyhZgcXdxHKrSXDQ6VVzBZ52+LEbNvgcWzuuB88nieKPU84fZ64/luS+YCBzfGkg31/bSPjkQt70rMfC19kIaSBvAA56FTPH9XauQAAAABJRU5ErkJggg==","quiver_icon-text-horizontal-center_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAElBMVEVMaXH////////////////////7e1ULAAAABXRSTlMAomHpI0HHT/8AAAAJcEhZcwAAWJUAAFiVAdltN9MAAADSSURBVHja7doLFoAgCERREd3/lmsJkkxRvbuCOfk5ErQGAAAAAMAfDfOpYiOQQxfj5OtJbErZchBtjunLQVyc5H1LU2aznsdXFyNyfAEAAPAC/aqR+jLsO6/pnphj772cl8TvqmPUJWiVL+JV9kje0ux9Eks9v3ZZ5xIGAAD4VoVpMqGno9XopKk7WL1KT8+rdDnLNBf9rhIz8TeFMomHzu8YXYVLGgAAoP19zlU5+BYbHXRdEnuwY7RTAbosiD/V3Sy7NGU2a2TOlblVAAAAfM0B9tAtJ5L5LFgAAAAASUVORK5CYII=","quiver_icon-text-horizontal-right_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAElBMVEVMaXH////////////////////7e1ULAAAABXRSTlMAomHpI0HHT/8AAAAJcEhZcwAAWJUAAFiVAdltN9MAAADTSURBVHja7dqJDcQwCETRwNj9t7wpwQc4WPtfBaP4kAk8DwAAAAAA/6iZehZrEznyYrw0nsR6KhsOkpujaziIkpPctzRlNut7fPNizBxfAAAAXMhXtdCXou+8rj0wx977OS6JTtU12SVplS+iKnskbmn2PomFnl9b5lzCAAAAd1eUlmbqqWg1OmnZHSyv0tNTlS5nmeaiTpWUgb8lMpNo6vy25lm4pAEAAB7mYPfnWZdzKHpEcJF90DnaqRCVHkSnu5zll6bMZh2Zg2WeFQAAALf6Aa0xK+emN4e1AAAAAElFTkSuQmCC","quiver_icon-text-horizontal-justified_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAElBMVEVMaXH////////////////////7e1ULAAAABXRSTlMAomHpI0HHT/8AAAAJcEhZcwAAWJUAAFiVAdltN9MAAACuSURBVHja7drbDcAgCAXQIrr/yu0I+kGC6TkT3PiKKM8DAAAAfzQjV5WYBznqYnxyP0msUrEdpDbHyu0gWZzkvqlps1i/7VsX42T7AgDQ0Kgyj26Ko/L2PA5y1JYTo0uB1abkXF1GJLuskf2pqR2SONq/UWY4pAEA7q44m1wVo0c1Uf2DNe4rsNZPPhfzvmeJ0iR5tH/nLHu7ckgDADz6WfWz6mfVz6qfFQAAOngBoXo5Z6NCrdAAAAAASUVORK5CYII=","quiver_icon-text-vertical-middle_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAFVBMVEX///9MaXH///////////////////8m1qDYAAAABnRSTlMzAAcFHLfEJvOyAAAACXBIWXMAAFiVAABYlQHZbTfTAAABhklEQVR42u3cW67DIAwEUGIP7H/J7UeVyyuPStfGUccb6AEDqZCGtAWpRMjTIGJWtyEqQDItQK4haozYMXIK8WJMKA1EkmvJEQTJuTCHuDsaSZo53svasjCTpHF9iPHRpfWgpYfIrG+GtVO0g8DX8TdytBBxastkTrSBwHk+xt/8QD465w9uPSWp7gx8IVIvh1TPkvt/kGr4NQTeEAwQ9y2zDY1YCtEeomshQgghhBBCCCGEEEIIIYQQ8rsQ5HJYGX4QlNOCGySfQ7IbpFzU70HCtCbMYg2zfXmyEkIIIbcgyOXfqzvsbkFQTApfQ7INJH8NKUb1XEiY1oRZrGG2L09WQgghhPcjvB/h/QjvR3g/QgghhBBCCCGEEEIIIYQQ8kDIqsiCHGQnsB4SJtYSJugjSxYJxuiTrgyDxYzHaXKXyDQwuOcIxTu42EUo9ylZHiqtYrbwa8skZtsGj21zx+fB4zhR7Djh9Dhx/bfE8wEDjfGkg16/tuHxyIU+6dmPjS+yENJAXs5hWaOYFCD6AAAAAElFTkSuQmCC","quiver_icon-text-vertical-bottom_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAFVBMVEX///9MaXH///////////////////8m1qDYAAAABnRSTlMzAAcFHLfEJvOyAAAACXBIWXMAAFiVAABYlQHZbTfTAAABgElEQVR42u3cS5LDIBADUNwtuP+RJ4uUBwz+pGpakBrpAnmmMc5GpG2RJEG+DWJheQxxA1JoALuHeDBix9glhMUYUBqIJWrsDIJEDsYQuqORpJHjta0jg5Ek9fvDgo8urx/ajhAbzS0wO8UPEHAdv0+OFmKksQzWxBsIyOvR/+Yb8taRP7j1kqR6MuBCrN4OqV4l+n+Q6vFrCNgQdBD6K7N1g5gK8SPE50JMEEEEEUQQQQQRRBBBBBFEEEEEEUQQQQQRRBBBBBFEEEEEEUQQQQQRRBBBBBEkBoJcTpPBg6BcBjRIvoZkGqTc5P9BlhnNMpt1mddXJ6sgggjyCIJc/jyHw+4RBCUk+BiSYyD5Y0gJyndAtkmjsZPuBNibtYeMai2E1xcn/ZoFij425WhFX33ymWWwNetxnugSGxYG9x6hsYuLhwrlviTTS6VVzRa8sQxqtm3xOLZ3fF08XqeKvU45fZ26/kvCvMDA17jSwe9v22BccuHfdO3HphtZBGkgP+ipVM91KvbMAAAAAElFTkSuQmCC","quiver_icon-text-vertical-baseline_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAG1BMVEX///9MaXH////////////////////////////wbDDDAAAACHRSTlMzAAccx0GSZeDdAAMAAAAJcEhZcwAAWJUAAFiVAdltN9MAAALfSURBVHja7dzZDuMgDAVQYjvA/3/xzMOow5bUNmCohJ8rcQo3hC6OuzYpdyC/BoFpxYYAILqphQjfITAZ8cHAK8SK0aBkEHCmBU8QdMaFbYi5I5O4luNvrGcWtiSuzgfM372wHsyVDrTZSD+UEoK2jv/vHHMI2C1LOSc5BI3nox7zH6RYMKMbbjqoS1cGbSGQxsGls2R+BknefgpBawhWEPNL5qoWYikESgishcCBHMiBHMiBfIpiWrAMEjJHDMsg+YREWgXBWNS9COJLiF8EoRIijesgSKgc0rgOgtQTIo3rGIiLjboXQHwL4u0hkIzulXEdAkmiet/KKRkCoTShpIvrCMidXbNeF9cRkGRozAJDthAsRiZVXAdAQrGb6uI6AFKlM9lLLCH1BKji2g/Jo1rQyA6CjVE1ce2GhMaNPyji2g2hamWyrSRaQdrXqiKuvZD2kIq4dkLwYUT52bUTEh7OqF4c105IK6q6uPZBnrNA0rj2Qejx04M4rl0QfB4NpHHtgrxFUhrXLshTVIu1ibMh4TUHwrj2QOj1g26QxbUDgu95TOPqpkKSONLdKBLFtQNCkV8wERIEDkZc9RDJhDDiqoZgjEOnRA3xMoifBiEZ5GtctZAgdHz9bk8LkU7I17gqIWlU6aX4cVVCPPOt8ndXHQSIufieHVcdJI0qMr9v/BJXHYQ/48SNqwri+Bm8uS9VQbzgJsLdXTUQlGzd3LhqIOyolssYBkNIdBplvloBuWW/DgVeXBUQLzye8xIlh6D0JxleXM9/Aw7kQA7EBuLEh3bGsR7lEIxTCsUQmgMhMSROqt+FTFoa/7thvdDvcfmenfVADuQNsk3LwuXWdJPUkG3aWrZp9FmTVqxbn2CXZrB92uMuZy4pehTLFkqwblzEsrt1VVMpPLfZot2yNNps88bjuX3H743H+7Ri79Ocvk+7vvEDDDZ5pAPjaRt7PORio8d+XOeJLAeSQf4AUgh8ecudsxUAAAAASUVORK5CYII=","quiver_icon-apply_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAIgAAACICAMAAAALZFNgAAAAG1BMVEVMaXH////////////////////////////////liRbkAAAACHRSTlMA4SSCYqgQRDgc/1gAAAAJcEhZcwAAWJUAAFiVAdltN9MAAAFcSURBVHja7ZnZcsMgEASNOMT/f3FcOXXYWJAss6nqftZDCwkYhtsNAAAAAAAAAAAAAP4FZV0XDx5LqDUsPjw8mHx46E2+PNQmPx53k6LzSBuPWqPOo+7ITjxkIxIPHqq/9eRRfHhkLx6i/yP78CjZx3wpwYfHgkfbI+GxW05XJx6/315Szv0vs/69Rxz5vKnaePROPAOPNLIEREOPHhMDj2VkWbSIQXlgAzeJQbk/StjEj9Q9ylbxo/N7G8aPrhlgGoM61ibj+HHZxHzbv7h/TYgfl3b000MWMeiCiUH8GBr2SR4vTVKYdtpvTs00s3VomKS57cfTZXN6C/PkPK1oYR6YFE0Lc3r7HETtx9GkylqYtsnM03504tEyieIWWdfCPDZJHioYWQtzMlG1MEcT4ZXUzkR6NbYxEV8WfpvIr08/TRxcKL9HJeWF5bZwjC48AAAAAAAAAAAArHkDaMknFFhGm0EAAAAASUVORK5CYII=","quiver_logo_v01.png":"iVBORw0KGgoAAAANSUhEUgAAA1IAAAEYCAMAAABhpDcWAAAAG1BMVEVMaXH////////////////////////////////liRbkAAAACHRSTlMAgOQ/GWTAm1+9KPsAAAAJcEhZcwAAWJUAAFiVAdltN9MAABXBSURBVHja7Z3ZdispDEWLSfj/v7id6XYSMwgQICrnPPbq67jKbNCEdF0QBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEEQBEFc+RCCw2uAIBGcXLSPN9mAlwFBg3KGHv+LPN4IBPXjFMg+forwViCo03mKv3F6F2w/COp3nhKyMP0gaMB5ehXifhDUYO2RfVRk8JogaMR5AlLQCcZVJIrBeUXOEz2YAlIzfgAPF3VI4Z+vT2SC24yWY1h78KVm/gAf758iXm33lvS6gu0TLorRmPAu967wKfPxX/wm5+mXsJ0KA2WRSZ9AFFNvh5ocWVznCbnemTI/f2EcVD2ix5gsCRSwetP5NZDqnUgU7GqZl9iFVQx+z5fATz7Fq0YqXfIl9or6D4zYz7LCWJn71IGL0SKiutGRSp5VfvVBSYryaCaStb+N4mjcOQepQ8WXLqLe1BN49QN/L2hJo9mitxnPOLIiTOvtoYnUueHWmX0aQuiOGVihA24hJ58kApPVoYnXxeOXcb3blfKm5Zi3QflZ9QBSakITv38FP+gTs//Q5jKDlTGcXUgh87fRkfq+H69Byp1yQHW+GpxSIKrH+qMDXaleoHRDZYGUttBE38Ix54XQnV13iCPi97dDEz0elT/NlfK02NvcmZdCXfIKD4a9GfvJdO/ZQINd7W3u9AVg963Ir/LXjZubmTr0iNJ7cwI1fmqDE60VYvEYV8rZ5RvOVm8KnpSCpNQ6psLpb82oZwp3Z5pWBy1hKs5jyukIid2Lqe+eIuGMau7issL6Y/oM8YBqpOp3fDYYeGsv8K5nixxSXv6Ra1bwWewLoDp7Ix3LFKkiyiZbTPlacxqdATV/5G0vTe2RyZ5o+wU9RFGxINaVbGwEqe96WrkwEaw5THklRBGjwNznk1lg6uZkvXkA1toDmCId1SZsj8NFNPf8m3HAT+f6q4fCR+e+D4X/9eZ8272x9Kghet7kwueyxIhU/w2kmGeasOMTlYbQnUxVUdr8Q7e8m8+e4SP1PeQqVSpgVbpS6VqTjpIiHzEk668i5VoSGRwOeMsm6nSlopy9FnBzFkgJFWeTrN1nNjtS3dZaskoQ7hSQ6oAqikYn3F6zb8BWE/44SLn8V3Tvkr/T6ASvTdi9Zt8QAimmYPoBqQ4kyuuw7SISbTX7Bg+VFFOI+t1W/UjVDyqSu9oXtt5/dvIxeRxTd0fKTLmgF8Quy7qdh1TQ+aHQdXyut/2ysBMiyu48pOIU/wwRCiDVw1Rm3TQ3dIint2NIvCfU+l0on+igI8q0SAkbD6kwqcTJYvEhMdXDlGP/C6uhGilMOyAJ3hSQEmHq1WzK/P+xkPmljYeUn5ZARtCPe2n24yaE/exN8JyLFzTfQh5HquJPGS5RhWqKuK8CPU68gYXcFKOgNHf7gUh41pB/v5b7Bu4Htt3U+pHEFIspxyUqz9SytRcnmpyvbynywLbje4NlmqOhcGAHcdvXjV57sOwpnKbyOpKtjuw+pDLXi1L2TZGoLFN+W0/eOJPXXCxRB1JG2k71bR/IG+fFnOBVRMrnJltuKJ/gtZAMbKIyTNG+4ISfCmzQjJSTthViw7HXMH3IcqLVJaTyJeA7yidYReX/b8ZVotIfZLYNDKItH68DqZeva4RDP15qtAPjtnUeqdJhuCfXy3GniE9Ukim3ze4Lk4MfXjNSQTaR5tg2dXsj+mo6PotUmDDXQgapMlOh9L+Yqsuxze6zsy9iBc1IvXxdJ2rIuKbmAoNXVHNIxRmjYpwMUkXc3zcRJlGvj0nb7L44O6BImpF6eR8kaQJY4Vkp5c4gGaTiYyZSbubkUmog6uVB3bY8r5ud9rKqkXKS1Y6Bt12FORMD00jFh26kiqafaSDq16PStjyvnX8F32lGSjQ1RSw3Mk6awplEyjyUI1XOTtkmCzjuuAQR5wfvifUC1CAlmJpiJaV8nDXZNoVUmDV2UyTX2zm03tRfwcJ5nDS/rjWwqFWDlJezhDlJqUq16If6mEogxRgMuh+p1umlpthU0q6eebQgeO9ZtqUapF52mTg1KRVLg4f8t8k92a7H1IBUnDccWg6pRt9S2R08tyJ4z3Km9CAllpriJKXSa5ySsehc+Z9hIxUe05Eycy4FnTNlM6yog2IZl3qQEktNMZJSpnGuQ9rxclyk7OtR+HYWvk3bCF/zLK+9ud5W08+on65uVnAbVSMllSNkJKVc+6CUlO+VcadekArlmWEfp6AGpPimn77OC7SiDspxjkJFSDmZOuJQ/fUTmzGjZ7bhLqwXpKhK7rNy99pcPtFk+insZbLkSgkrPqEIKaHa2XpSKvYNSnmttUgfU7/Yozh1NpFcYopv+ikkyq0pLbQMcDUhJZKaqielEj0/fGcrSdPWxTX6SzlSjF7pHbPPdiBF28xLTUiJpKaqSSn+jWfGVuhbVqVR2n2i3fTT1xgyrEEqMkJ+mpASSU3Z2rcZKVwJHErMUnNJMNfbEvWL/g8G/BJ/JipHSqB2tpqU8kM7LjH+sVnqgEgjxY36KbP+aE2bvXAaUtd4aqqalIpDkSHPqO41a5vZSSPFLicm/9di6DyXTRdSwwGKalLKDx4ejG9o1nofkuUTjQlfRZE/uwkpqx2p4dRUeDTmk+3oevM8pILWSQNDTOkJUyzqdOaPQ2o4NVVLSvnha1nm0ZoLmNyAQR6p8tUpnR6VWM1ka8sY9UgN1s5Wk1Jh2MP5DWVkIRX0Du8YvOahI/TnFyHFOQ2VITVYO1tNStH4Uqfa45q1M8ukE1OtF6es+zvFE6zyCWVIDaambGNwwgrEUR0DqXASUq1XETVEKfYh5dQjNZSaqialosBS97XPMGu7gksj5dvbRu03/tyqnMWBSA21dakmpUhiqVOF21ekpk6DEc71eivdMepWSNGBSA2kppqTUiRRWUqbJxHJIuWtfBe26zYlfmci5fuNpmpSKoi4OLXnNYunwUgi1UnU9iDFPqSCfqQGUlNVs45ETg9f+TNm8TQYwfKJ3va72zNUQKqEVHdqqm7WWZmokC2DaRZHxORyvQNEbZ4HDaRKv0B3aqoanHBCr73yIGbxNBgxpDJE0QFMAaniDxA742XVM8gJnR6xESm/ZgS2n0NU4DtYDkjpRKozNVVv3xeFVoAp/yGzeBqMUGIqSxR/rN2+GAUifmUzoa9qKFbPBhI6PcIdkSoR9Rap1x1LR16qDErXmmTknEioZqURKXMCUmWi2GMZdjEFpMpIdbV1YeScpN66K3+OWexhSOR6q0RxrT9CjZ9GpLpSU9RaIQyk2ohidiQzOi53oBK9EqBof6dxZCZ229+qITXdFhpGiklUbYTQxrDfMqQehyLV0daFEc3rnyPaZuuYNZfh5Mon2ESxrL897tS2K4jXIUi1TxxgFEaYPUjZ6ctpMNfbQhTnoCIV7VzQe2IwNdU/U+rPI9VGFGdrcn+oQxKdglRzaioODD6cjNT8TXuofCJNVLEItlYKuMP0Qx+/GiWNbVdYF6Ho7kg5OaLah20tu3LZ36x8UZWGUqQaa2dZF6GAFDfaUC8sqhh//q490Tm3DJQi1djWhTiWxyakomKkQnepnlEWoQhrTko6bXJHb2rKs17nbZHqzvWGgeLXoCtCgflSdWO3xfLjlZjPQiqeilQYKicPqo4pjymIVaRaamd5t3XtXZHqLJ8Igxc0gqpjakliyp02q7e3rYvjBXtmnVJGC1JmKVFlpiImyqtDqqF2NvLgm4SUdduR6sn1BoFLhEZRbmpJFN1wdg69SLFTU9zufL+Roiih13V8BFJB5Fpu1NOIYsm9XtasRb1IsVNT3O58tCh5sh6p9vIJGaJKXSnojjemWGVPepFit3XhXtaNizzofUi5xUQVJ1H5+8UneNg68VEWYkgxa2c91zEGUuJElUw/c78B2DzjUjFSzOawbFLiImtfPVKCRBVMv9WW34ImvzxqBZAys5DipabYLWTDom10PVJtud4g2jAsaLH83PygI+8GiQBScRZSrNSUY589YVHqRDlSQTjobbXE/KZfmWJGQASQollIsVJTsTsjTLdBqqV8Qpqo/DEVdztTcXbqK56HFKN2tmFklF/U8WMfUqY3OztiI2W9KXttzkxJW37MY1AAKTsNKUbtbGg47Bd1/NiAFDvXayaUOkQlzpSfXGgYmHvGOFLszb8DqXpqqqWDrF0TRVeM1Ayi8rkpt9vyoy2G5ThSbiJS1dSUbzGfaY3/vAEpZvmEmVOOZ7XWJIlCzT4Ex5EKE5GqUhBbbI24xn/eiJTbQVTW8lsdn3j16uLM4IS9ZiFFM5Gq1c7alpM+rPGftSI1i6hszI+2N6AQDFB49o4xjpSdidTLxuM7k1KDk7VvgNQ0ohKrbU/IL+HVxXm4ZlfPMFL8CuAepCqpqdjGiF1i7G9AipHrNROvNeWcqWv7PUSxXZN/SI0jFeYiVQx++MY9KS6xTFQiNZOo7OVOv71PkthPzD+kXpbs+OuURaoY+Q6NAZ6w5OrpBqSq5RNTicrGJ/z+Ps5CQb/QYFL6wbfgH5ORMoVHaR1r6JeEeTciZbYQlUVqfXN0M+chExUinr3K3DC+wkj5/Cvyzb6oXWH57UAqFJGaTFS2B8V6pBJrn6bsGZFfpROGT1phpAqpqdh8whqhH92Xsqo7kfI7iMpG0TeM8AgzMs6hzaa1QwvAPaYjlU9N2ebtSKonaShdt9qBVKl8YjpRmpBKhUqceGy+fNeOhtYYzUcq29bFdexGMt3ePr5SbmDMTqTcDqKyVX47kHLiz5owJq0fnczUtD1JI/XyDc3AN5e5Tf31KdHrR2oBUVmktowYjcJPm7q8EsbnyLTk+MSRyqSmfE+i/PX9hKG0X8rSUoXUCqJ0IZVCYOB5Ux8X214HjUZ6xJHKtHUJXVaGRBkYlccF7kDKZ5BaQlQWqWuLnGBnjeRIu9rr8/0GsH+sQSrd1oW66j7c+PqqIbMTqbCDqFx4wu5BKp0mM3JP5lvPABq8IS2PVDI15TtfGY2WVrraFqQHqUVE5ZCiTUilF2Zsf+z0ANXQzrQbq+ySRyqZmuoNq/jBez2+2hdgB1LJ8olVRGlDqmekN3/qqpnX/yw+liGV8vds788Xh5jy9Wr2LUglyieWEZWrnoi7kMpaoi0elaP+h+q6C+mzTTwmIJVITbnuwF3KLCDfu//ZSxdSfgNRud01bEMqWyJFbgwo5tYdO862b1amtdORKg1dafeEQ//+FTjLRgdSC4nKuQBuH1L5FWODZ3imuesqzL3XtZ9u361M9+vXm4GUezQO92xfAQzvNbFzkZJU70tiaiVROaT8pZGp548WSrC7kJ/tx7ZmqPHd/1ha8ffePQOp6gRDNx4RspX+Qo6blteA1FKiLqsqhs6xbCwZ97pm/BMnK7Jxu6Zd++de/fYrLUAqyNl9hUMvZsn0jh9PVYCUGdtjL5HeE3QpZuoTrOckzPfXFiORbR3K3H4GpBaYM/Z1US1AypefNwh5rw8bnefvXVFN2ezP8om1ROV2KLMZqdIo4Q61xeBd6Xj0/xaWoXRwcAFSFcvPS+5glqIJwTkXQjCxsHll7KitSIXsw00jKrd83G6karZNk1pfX+WMtLa4qFYgVQxQ0AyroL5t+UslUquJyp0GfjtSNeOmQc21F71/OlXAOgepyz5kp5cPM5WNu29B6v/yieVEZSwIuhTIRxmjz0mVcNQUrnVIGbHghIylnX/Le5D6SkytJ+oiZbUTjKqitp/aLDM7zbUQKS+UlBJiyurqPfEPKVpPlNfqSskcVNb4Za6cuVYiVQhQONHqymFndSdSG4jKubmXGg38zgNAdTAVrrVIBfnR5d0bWNTWdOwzMbWDqMwPQ5ci9Vp/Q0C1wvzdlViDlJ8xxqjrXVt36URqC1GZeEi4rtOhIrfS6vzxM61BalKbYGOld65tSO0hKmOR+0uZHLXxFPxKln8lkhch5ebcyvFNUNnmebiLkPK7iPIaC/zS3zQwqbIxCL41xvp6WVWLkMpshwKRJe6r5tnWm5DaRFRmp4uXSlWpepbOBPlGAtS6qlYhZeZthz4SY+9yanuib6iZKEcn3KVV3pl0kdnzbHJ+OcrpVeXdD2W3s5/q6K7hUhJ86sIJTdF1fk2/kajot3RM1mn3/VyLIdrFAZXnn/y5wqaciPp2sOdj06/6Rpq4e00m6toy0kmv3Vc0etYcrP5zx/W3hyl90Jzy3DF3e3X+9/eH2X15J9BcEFSOTHyUpk82Pd2Jdl964p/HUvpD0BhbUoEoM5sro750omvAJnRz0aNZ34n64mqGHUsHlE60jlmCbq8gQdQkruwRpRM8FxSmHw6pZqLEuXLn2n2J0AphrQGpHqL+cTULqWNiZ/EBdwpI8e6ePBNsgYPVMFfx1BB65nYDmAJShTzrCq5I9+3DqzleSfCngFR5o53MlT3YleoZbQ39QaRiutDKsNyrVq7cqdVIpQeIgApIcdazn8GVOzcrVXAGbQBUQIoZbONzxQuzh+ORysycwEl1IdXLD18LchWPRyrb04RM8iITUPtbx5RpKrYX4IqOTkvVNqyf93reb/4gHXybc4o49bK24xLLWDiQTg9PXJweqT/fNc6pP2QS2t57l91c2XOvdnT3HUZx7R9iyg7dZ+7h6vE4uGq2k6mAVfd33Cw73icgNIXZvdJhbVNr/VGzdHNFYYurKX2ldKToNbXVMuITN5eZ4cRwuTL3cTc8O/lnseiA1DSu4p02cnbXYYT8gNRYr6jQjtSZGzl3JgDiE0BqGlfxZu4Gz6NCfAJISbUNDVxf6lwPnjPfA/EJIDWPK3s/08hHi/jEdbNGl7YqMpuQ+s2VvWWBgStThVPqukVhdO5nNZu2z49wIN11G3eB0vMTCHeprpsWnbvNSH2E2c2dt/FnVMY8p058WQ0Un/ltLNDz1FoWY7aeDh5RZghIzT9UsZdDQOoSrDdFRAwCUqLRFETEICB1SV41gisFASnRYwquFASkJL0puFKQKtnTkHoJ+sGVgq4TU716kPpt+sGVgq4DC5L+IRX2nw+/vjJcKUhbJTSrZ19MrOegYRuAKwWdeec0vqxnu8/i+s4UXCnoOnLIRPxeNf0m53V8N7hS0DnnlObb2l93zDHxDLrODLDra4AQ7F7rE4JuhtTzpDK4nwcBKQgCUkAKgoAUBAEpCAJSEAQBKQgCUhAEpCAIAlIQBKQgCEhBEJACUhAEpCAISEEQkIIgCEhBEJCCoOtG/VxwIR2ChuW+dcvDjXQIkmtD9LBo6QpBQpPO33v24UVAUEX/AUqYSDxyM0X7AAAAAElFTkSuQmCC","quiver_icon_v01.png":"iVBORw0KGgoAAAANSUhEUgAAAHAAAAB0CAMAAABqr0ZvAAAALVBMVEVMaXH///////////////////////////////////////////////////////9xAJ22AAAADnRSTlMAgNwhOBHwn1FgunGQaHlmhq0AAAAJcEhZcwAALEsAACxLAaU9lqkAAAPySURBVHja7ZrZcusgDIaN2LHj93/c4yxtAIMWcDNzZqKrTmPnC0L6EYJl+dp/a9ZE8zmaWZPb993bT8D06u+wh6U/92PYYM9N/+mkbWmv7TyNGnaXtjUYbS+YNBpocw84OCylBPD8w6vACTQbfRN2GJwe9jthLkV8HkxC3j4Fjdo5liISkw57s34x7EyDLjKh7+lTwOyzSHSAgAQMbb45l+h3eGHAcAaJRkEon93Fpho5gQ3RSuab4yMiEE5JEeVIsAKiaoptcn9G7MmUNnF7iBkLndhedZg+KaWeIWX1Ya/fUa81T9u4RGwx1L/A+oN4/q6VqTcrJvgH8Nb57Iys58Ym0RQ+81ep/g9SeOB0UhHQRWY9iP1PAyCz00t9TwKRJb+OipUhNREFRhxYE51u8ZygfgoHEH2iIqYGTxXP4FP4AOL1i3ENhxW88ldtRNVFApe1dKo98wqioYGBqM622qknXk4kqk7NAFbxGBq8N9FTX4ZIzdsNpVOhuRA9iUDW+KjUtJ3aWfi0B9joPYVCpQZPcvpFudQ0nTrDW24sYMup6xCPlpquU70eBnK2SuYqnxomsFn5gh4DBtaT/prA0Vxgp0QTD5IlNVgRCkFIZEkNusNTYqCa4kmJHKnJeTBLZEhNzouNelVGpKWm5N0De0rnSKmpefd/JVm5LZKaBq+1DwB7kdRkPJeXuKdBbtdITc4zuLiaK6QG4dX1I79HikgNyjvVyGZaaghevUimWakhebVXzZzUMHjVnnubkhoWb7GO2b4gpYbHq5LDjEsNl1cOcR2WGjavrFj9qNQIeEV3GQalRsJbrDxqaqkR8cresB2RGiGvAOoBqTEgrDmTGFhITSbIzBrXi4G51Mh5BdBKpWaAVwClVc0IL59DEFY1Q7wcmGRVzRhvAfH69JKaQd7C7lwWwHWYZwarmlFeDnQLv6rxo7x8BU78DdQ4Lw/SyH0nTPDyIGW/epvgWXHaj+dDHTPc7Ux881wQAxWdFFb5wrKw3u4SEIwdihkQdZR+eU+LbKqjSzageQ9bY6DvaZjuSTMJPOLlODm8KRk1MBZfomfWpHbvpChGUgCjR3dQ15p63ITBYiYxT1qQ/GtQbzUVOGmvzdsS0Umyx8k0RnXSpeK1+cFbV1aHHlW+GCZur6xFjUG+/02i5pw1IRZI+U4myfuPNkuc/l5Nb742MwjM09V1d6PQuYWSJk51Dmp/ve+dR08Bi6TWHwG+ewqwfAT4FlPPuKV1BfD3FCwyjo7ewLiM3/KETsmWCejPFYv4s8NOMxciX4e/nNpuYlzl4S/dE4IrgXdVoY4+LgZy6/Mv8Av8Ak/AT17iB3aH+msd+wcbFLIIafkSsgAAAABJRU5ErkJggg==","quiver_firing-loader_v02.svg":"PHN2ZyB3aWR0aD0iMTkyMCIgaGVpZ2h0PSIxMDgwIiB2aWV3Qm94PSIwIDAgMTkyMCAxMDgwIiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8ZyBpZD0iRmlyaW5nLi4uIj4KPHJlY3Qgd2lkdGg9IjE5MjAiIGhlaWdodD0iMTA4MCIgZmlsbD0iYmxhY2siIGZpbGwtb3BhY2l0eT0iMC43Ii8+CjxyZWN0IHg9IjYzNyIgeT0iNDc2IiB3aWR0aD0iNjQ2LjUwNSIgaGVpZ2h0PSIxMjciIHJ4PSIxNiIgZmlsbD0iIzJEMkQyRCIvPgo8cGF0aCBkPSJNNjgxLjA1NiA1NTguNDE5QzY4MS42NDYgNTU4LjQxOSA2ODIuMTI1IDU1OC44ODkgNjgyLjEyNSA1NTkuNDcxVjU2Ny44MDlDNjgyLjEyNSA1NjguMzkgNjgxLjY0NiA1NjguODYgNjgxLjA1NiA1NjguODZINjc5LjgyMkM2NzkuMjMyIDU2OC44NiA2NzguNzUzIDU2OC4zOSA2NzguNzUzIDU2Ny44MDlWNTYzLjEzNUM2NzguNzUzIDU2Mi41NTQgNjc4LjI3NiA1NjIuMDgzIDY3Ny42ODYgNTYyLjA4M0g2NzIuMjA5QzY3MS42MTkgNTYyLjA4MyA2NzEuMTQgNTYxLjYxMSA2NzEuMTQgNTYxLjAyOVY1NTkuNDcxQzY3MS4xNCA1NTguODg5IDY3MS42MTkgNTU4LjQxOSA2NzIuMjA5IDU1OC40MTlINjgxLjA1NloiIGZpbGw9IndoaXRlIi8+CjxwYXRoIGQ9Ik03MjguNTM0IDUxMC4yMTRDNzMwLjEyMiA1MDkuNzk0IDczMS41NzYgNTExLjIyNyA3MzEuMTUxIDUxMi43OTNMNzI3Ljc3OCA1MjUuMTk2QzcyNy4zNTMgNTI2Ljc2MiA3MjUuMzY3IDUyNy4yODYgNzI0LjIwNCA1MjYuMTM5TDcyMC45NTQgNTIyLjkzN0w3MTUuMzY1IDUyOC4zOTZDNzE2LjM5OCA1MjguOTkxIDcxNy41NzQgNTI5LjY4NiA3MTguNzIzIDUzMC40OThDNzIxLjk0MiA1MzIuNzcyIDcyNS40MDEgNTM2LjIyOSA3MjYuMTU3IDU0MS44MDVDNzI2LjgzNyA1NDYuODMzIDcyNC41NDggNTUxLjI1NiA3MjMuOTYxIDU1NC4xNzdDNzIzLjcyMyA1NTUuMzY1IDcyNC4xNjQgNTU2LjQyNSA3MjQuNDg4IDU1Ny4xMjhDNzI0LjU4NyA1NTcuMzQzIDcyNC42MSA1NTcuNTg0IDcyNC41NTIgNTU3LjgxMkw3MjMuMzQ4IDU2Mi41NjVDNzIzLjIwNSA1NjMuMTI5IDcyMi42MjEgNTYzLjQ4IDcyMi4wNzIgNTYzLjI2OEM3MjEuMzAzIDU2Mi45NjkgNzIwLjU3OSA1NjIuNTQ1IDcxOS45NTQgNTYxLjk1QzcxOS4wNDQgNTYxLjA4MyA3MTguNTM4IDU2MC4wNCA3MTguMjg4IDU1OS4wMDlDNzE3LjgzOSA1NTcuMTUzIDcxOC4xODcgNTU1LjA5MSA3MTguNTEgNTUzLjQ4NUM3MTkuMjQ5IDU0OS43OTkgNzIwLjMwMiA1NDYuMzI4IDcxOS44MDQgNTQyLjY0M0M3MTkuMzggNTM5LjUwNyA3MTcuNDk3IDUzNy40MDQgNzE0Ljk4OCA1MzUuNjMxQzcxMy43MDkgNTM0LjcyOCA3MTIuMzggNTMzLjk5IDcxMS4wNCA1MzMuMjI0QzcxMC45MTMgNTMzLjE1MiA3MTAuNzg0IDUzMy4wNzYgNzEwLjY1MSA1MzNMNjg3LjYzNiA1NTUuNDgyTDY4Ny41OTggNTU1LjQ0M1Y1NjEuNDMyQzY4Ny41OTggNTYyLjAxNCA2ODcuMTIxIDU2Mi40ODYgNjg2LjUzMSA1NjIuNDg2SDY4NS4yOTdDNjg0LjcwNyA1NjIuNDg2IDY4NC4yMjggNTYyLjAxNCA2ODQuMjI4IDU2MS40MzJWNTU2Ljc2MUM2ODQuMjI4IDU1Ni4xNzkgNjgzLjc0OSA1NTUuNzA3IDY4My4xNTkgNTU1LjcwN0g2NzcuNjgyQzY3Ny4wOTIgNTU1LjcwNyA2NzYuNjE1IDU1NS4yMzUgNjc2LjYxNSA1NTQuNjUzVjU1My4wOTVDNjc2LjYxNSA1NTIuNTEzIDY3Ny4wOTIgNTUyLjA0MyA2NzcuNjgyIDU1Mi4wNDNINjg1LjA5MUw3MDcuMTQ0IDUzMC40OTNDNzA2LjIxMiA1MjkuNTE3IDcwNS4zMzEgNTI4LjEwOCA3MDQuNjQ1IDUyNy4wNkM3MDMuODEgNTI1Ljc4NCA3MDIuOTM4IDUyNC41MDMgNzAxLjg2MSA1MjMuMzM0QzY5OS44MDkgNTIxLjEwNiA2OTcuMDI1IDUxOS4yNjkgNjkyLjQwNyA1MTkuMzg1QzY4Ny42NzkgNTE5LjUwNCA2ODQuMjQxIDUxOS4yODEgNjgxLjgyNiA1MTguOTI4QzY4MC42MjIgNTE4Ljc1MiA2NzkuNjMgNTE4LjUzOCA2NzguODM4IDUxOC4yOThDNjc4LjQzMyA1MTguMTc2IDY3Ny45NyA1MTguMDE2IDY3Ny41MTkgNTE3Ljc5N0M2NzYuOTkgNTE3LjU0IDY3Ni45MTIgNTE2Ljg3NCA2NzcuMjgxIDUxNi40MTlMNjgwLjE4NyA1MTIuODM5QzY4MC40NSA1MTIuNTE1IDY4MC44ODMgNTEyLjM3NiA2ODEuMjk3IDUxMi40NTJDNjgxLjg1NiA1MTIuNTU1IDY4Mi40NDggNTEyLjYzMyA2ODIuNzcxIDUxMi42ODFDNjg0LjcyNSA1MTIuOTY2IDY4Ny43NzQgNTEzLjE4IDY5Mi4yNCA1MTMuMDY3QzY5OS4xMTcgNTEyLjg5MyA3MDMuNTkyIDUxNS44MTUgNzA2LjYwNiA1MTkuMDg4QzcwOC4wNjMgNTIwLjY2OSA3MDkuMTc3IDUyMi4zMjQgNzEwLjAzNCA1MjMuNjMzQzcxMC44ODUgNTI0LjkzMyA3MTEuMzUyIDUyNS42MzkgNzExLjcwNCA1MjYuMDRMNzE3LjkzIDUxOS45NTdMNzE0Ljk5IDUxNy4wNkM3MTMuODI4IDUxNS45MTMgNzE0LjM1OSA1MTMuOTU3IDcxNS45NDcgNTEzLjUzN0w3MjguNTM0IDUxMC4yMTRaIiBmaWxsPSJ3aGl0ZSIvPgo8cGF0aCBpZD0iVmVjdG9yIiBkPSJNNjg4LjY3NSA1NTAuOTQ4TDcyMS43NDQgNTU3LjYyM0w3MjEuNTI3IDU1OC42NTZMNzIxLjMxNCA1NTkuNjg4TDY4Ni43MDUgNTUyLjcwNEw2ODYuNjI1IDU1MS45MzFMNjgzLjE2MSA1MTcuNjY1TDY4NS4yOSA1MTcuNDZMNjg4LjY3NSA1NTAuOTQ4WiIgZmlsbD0id2hpdGUiIGZpbGwtb3BhY2l0eT0iMC41Ii8+Cjx0ZXh0IGlkPSJGaXJpbmcgdG93YXJkcyBDYXZhbHJ5Li4uIiBmaWxsPSJ3aGl0ZSIgeG1sOnNwYWNlPSJwcmVzZXJ2ZSIgc3R5bGU9IndoaXRlLXNwYWNlOiBwcmUiIGZvbnQtZmFtaWx5PSJMYXRvIiBmb250LXNpemU9IjQ3LjIyMDMiIGZvbnQtd2VpZ2h0PSJib2xkIiBsZXR0ZXItc3BhY2luZz0iLTAuMDJlbSI+PHRzcGFuIHg9Ijc2NS41NTgiIHk9IjU1Ni42NCI+RmlyaW5nIHRvd2FyZHMgQ2F2YWxyeS4uLjwvdHNwYW4+PC90ZXh0Pgo8L2c+Cjwvc3ZnPgo="};function initializeQuiverAssets(){for(var filename in api.isDirectory(QUIVER_ASSETS_PATH)||api.makeFolder(QUIVER_ASSETS_PATH),QUIVER_EMBEDDED_ASSETS){var filePath=QUIVER_ASSETS_PATH+filename;if(!api.isFile(filePath)){var base64Data=QUIVER_EMBEDDED_ASSETS[filename];api.writeEncodedToBinaryFile(filePath,base64Data)}}}initializeQuiverAssets();
// Quiver üèπ - Development Version
const currentVersion="1.6.2",SCRIPT_KEY="com.canva.quiver";ui.setTitle("Quiver"),ui.setBackgroundColor("#2d2d2d");
// quiver_utilities_checkVersion.js
var GITHUB_REPO="phillip-motion/Quiver",scriptName="Quiver";function compareVersions(v1,v2){for(var parts1=v1.split(".").map(function(n){return parseInt(n,10)||0}),parts2=v2.split(".").map(function(n){return parseInt(n,10)||0}),i=0;i<Math.max(parts1.length,parts2.length);i++){var num1=parts1[i]||0,num2=parts2[i]||0;if(num1>num2)return 1;if(num1<num2)return-1}return 0}function checkForUpdate(githubRepo,scriptName,currentVersion,callback){var oneDayAgo=(new Date).getTime()-864e5,shouldFetchFromGithub=!0,cachedLatestVersion=null;if(api.hasPreferenceObject(scriptName+"_update_check")){var prefs=api.getPreferenceObject(scriptName+"_update_check");cachedLatestVersion=prefs.latestVersion,prefs.lastCheck&&prefs.lastCheck>oneDayAgo&&(shouldFetchFromGithub=!1)}if(shouldFetchFromGithub||!cachedLatestVersion)try{var path="/"+githubRepo+"/main/versions.json",client=new api.WebClient("https://raw.githubusercontent.com");if(client.get(path),200===client.status()){var latestVersion=JSON.parse(client.body())[scriptName];if(!latestVersion)return console.warn("Version check: Script name '"+scriptName+"' not found in versions.json"),void(callback&&callback(!1));latestVersion.startsWith("v")&&(latestVersion=latestVersion.substring(1)),api.setPreferenceObject(scriptName+"_update_check",{lastCheck:(new Date).getTime(),latestVersion:latestVersion}),compareVersions(latestVersion,currentVersion)>0?(console.warn(scriptName+" "+latestVersion+" update available (you have "+currentVersion+"). Download at github.com/"+githubRepo),callback&&callback(!0,latestVersion)):callback&&callback(!1)}else callback&&callback(!1)}catch(e){callback&&callback(!1)}else compareVersions(cachedLatestVersion,currentVersion)>0?(console.warn(scriptName+" "+cachedLatestVersion+" update available (you have "+currentVersion+"). Download at github.com/"+githubRepo),callback&&callback(!0,cachedLatestVersion)):callback&&callback(!1)}
// quiver_createUI.js
function createIconButton(symbol,tooltip,size){size=size||32;var btn=new ui.Button(symbol);return btn.setSize(size,size),tooltip&&btn.setToolTip(tooltip),btn}checkForUpdate(GITHUB_REPO,scriptName,"1.6.2");var pasteButton=new ui.ImageButton(QUIVER_ASSETS_PATH+"quiver_text-paste_v01.png");pasteButton.setImageSize(61,22),pasteButton.setMinimumHeight(36),pasteButton.setToolTip("Paste SVG content from clipboard"),pasteButton.onClick=function(){try{var svgCode="";try{svgCode=api.getClipboardText()}catch(clipboardError){return void console.error("Error accessing clipboard: "+clipboardError.toString())}if(!svgCode||""===(svgCode+"").trim())return void console.error("No content found in clipboard");if(!svgCode.includes("<svg")||!svgCode.includes("</svg>"))return void console.error("No valid SVG found in clipboard");if(autoSaveEnabled)console.info("Saving scene..."),saveSceneBeforeImport()?console.info("Scene saved. Parsing‚Ä¶"):console.error("Could not save. Parsing‚Ä¶");processAndImportSVG(svgCode)}catch(e){var errorMsg=e&&e.message?e.message:"Import failed";"undefined"!==errorMsg&&"null"!==errorMsg&&console.error("Error: "+errorMsg)}};var importFileButton=new ui.ImageButton(QUIVER_ASSETS_PATH+"quiver_text-import_v01.png");importFileButton.setImageSize(70,22),importFileButton.setMinimumHeight(36),importFileButton.setToolTip("Import SVG file from your computer"),importFileButton.onClick=function(){var startPath="";try{startPath=api.getProjectPath()||""}catch(e){}var filePath=api.presentOpenFile(startPath,"Select SVG file","SVG files (*.svg)");if(filePath&&""!==filePath)try{var fileContents=null;try{fileContents=api.readFromFile(filePath)}catch(readError){try{if(autoSaveEnabled)saveSceneBeforeImport();var importedLayers=api.convertSVGToLayers(filePath);if(importedLayers&&importedLayers.length>0)return void console.info("üèπ Import complete - "+importedLayers.length+" layers imported")}catch(convertError){}return void console.error("‚ùå Unable to read SVG file")}if(!fileContents||""===fileContents.trim())return void console.error("‚ùå File is empty");if(autoSaveEnabled)saveSceneBeforeImport()?console.info("Scene saved. Processing file..."):console.error("Could not save. Processing file...");processAndImportSVG(fileContents)}catch(error){console.error("‚ùå Error reading file")}else console.error("No file selected")};var statusLabel=new ui.Label("Ready to import");statusLabel.setMinimumHeight(20);var originalSetText=statusLabel.setText;statusLabel.setText=function(text){"Error: undefined"!==text&&"Error: null"!==text&&"undefined"!==text&&"null"!==text&&originalSetText.call(this,text)};var autoSaveEnabled=!0,keepOriginalEnabled=!1,defaultRadius="",importGradientsEnabled=!0,importLiveTextEnabled=!0,importEmojisEnabled=!0,importImageryEnabled=!0,importEffectsEnabled=!0,importGroupsEnabled=!0,imageFilterQuality=2,emojiPlaceholder="[e]",settingsButton=new ui.ImageButton(QUIVER_ASSETS_PATH+"quiver_icon-settings_v01.png");settingsButton.setImageSize(22,22),settingsButton.setSize(35,35),settingsButton.setToolTip("Settings");var convertRectButton=new ui.ImageButton(QUIVER_ASSETS_PATH+"quiver_icon-rectangle_v01.png");convertRectButton.setImageSize(22,22),convertRectButton.setSize(34,34),convertRectButton.setToolTip("Convert to Rectangle"),convertRectButton.onClick=function(evt){try{convertSelectionToRect(keepOriginalEnabled)}catch(e){}};var dynamicAlignButton=new ui.ImageButton(QUIVER_ASSETS_PATH+"quiver_icon-align_v01.png");dynamicAlignButton.setImageSize(22,22),dynamicAlignButton.setSize(34,34),dynamicAlignButton.setToolTip("Dynamic Align"),dynamicAlignButton.onClick=function(){try{var sel=null;try{sel=api.getSelection()}catch(e){sel=null}if(!sel||!sel.length)return void console.error("Select at least one layer");for(var applied=0,i=0;i<sel.length;i++)applyDynamicAlignToLayer(sel[i])&&applied++;console.info(applied?"Dynamic Align applied to "+applied+" layer(s)":"No valid layers for Dynamic Align")}catch(e){console.error("Dynamic Align error: "+e.message)}};var flattenShapeButton=new ui.ImageButton(QUIVER_ASSETS_PATH+"quiver_icon-flatten_v01.png");flattenShapeButton.setImageSize(22,22),flattenShapeButton.setSize(34,34),flattenShapeButton.setToolTip("Flatten Shape"),flattenShapeButton.onClick=function(){flattenShape()};var cycleTextAlignButton=new ui.ImageButton(QUIVER_ASSETS_PATH+"quiver_icon-text-horizontal-left_v01.png");cycleTextAlignButton.setImageSize(22,22),cycleTextAlignButton.setSize(34,34),cycleTextAlignButton.setToolTip("Horizontal Text Alignment"),cycleTextAlignButton.onClick=function(){cycleTextAlignment(),updateTextAlignIcon()};var cycleVerticalTextAlignButton=new ui.ImageButton(QUIVER_ASSETS_PATH+"quiver_icon-text-vertical-top_v01.png");function updateTextAlignIcon(){try{var selection=api.getSelection(),iconPath=QUIVER_ASSETS_PATH+"quiver_icon-text-horizontal-left_v01.png";if(selection&&selection.length>0)for(var i=0;i<selection.length;i++){var layerId=selection[i],isTextShape=!1;if("string"==typeof layerId&&0===layerId.indexOf("textShape#")&&(isTextShape=!0),!isTextShape)try{var layerType=api.getType(layerId);"textShape"!==layerType&&"text"!==layerType||(isTextShape=!0)}catch(e){}if(isTextShape){try{var alignment=api.get(layerId,"horizontalAlignment");iconPath=1===alignment?QUIVER_ASSETS_PATH+"quiver_icon-text-horizontal-center_v01.png":2===alignment?QUIVER_ASSETS_PATH+"quiver_icon-text-horizontal-right_v01.png":3===alignment?QUIVER_ASSETS_PATH+"quiver_icon-text-horizontal-justified_v01.png":QUIVER_ASSETS_PATH+"quiver_icon-text-horizontal-left_v01.png"}catch(e){}break}}cycleTextAlignButton.setImage(iconPath)}catch(e){}}function updateVerticalTextAlignIcon(){try{var selection=api.getSelection(),iconPath=QUIVER_ASSETS_PATH+"quiver_icon-text-vertical-top_v01.png";if(selection&&selection.length>0)for(var i=0;i<selection.length;i++){var layerId=selection[i],isTextShape=!1;if("string"==typeof layerId&&0===layerId.indexOf("textShape#")&&(isTextShape=!0),!isTextShape)try{var layerType=api.getType(layerId);"textShape"!==layerType&&"text"!==layerType||(isTextShape=!0)}catch(e){}if(isTextShape){try{var alignment=api.get(layerId,"verticalAlignment");iconPath=1===alignment?QUIVER_ASSETS_PATH+"quiver_icon-text-vertical-middle_v01.png":2===alignment?QUIVER_ASSETS_PATH+"quiver_icon-text-vertical-bottom_v01.png":3===alignment?QUIVER_ASSETS_PATH+"quiver_icon-text-vertical-baseline_v01.png":QUIVER_ASSETS_PATH+"quiver_icon-text-vertical-top_v01.png"}catch(e){}break}}cycleVerticalTextAlignButton.setImage(iconPath)}catch(e){}}cycleVerticalTextAlignButton.setImageSize(22,22),cycleVerticalTextAlignButton.setSize(34,34),cycleVerticalTextAlignButton.setToolTip("Vertical Text Alignment"),cycleVerticalTextAlignButton.onClick=function(){cycleVerticalTextAlignment(),updateVerticalTextAlignIcon()};var renamerInput=new ui.LineEdit;renamerInput.setMinimumHeight(36),renamerInput.setContentsMargins(6,6,6,6),renamerInput.setCornerRounding(4),renamerInput.setBackgroundColor(ui.getThemeColor("Window")),renamerInput.setPlaceholder("Rename layers...");var settingsWindow,renamerButton=new ui.ImageButton(QUIVER_ASSETS_PATH+"quiver_icon-apply_v01.png");function createSettingsWindow(){if(settingsWindow)return settingsWindow.close(),void(settingsWindow=null);(settingsWindow=new ui.Container).setMinimumWidth(350),settingsWindow.setMinimumHeight(520),settingsWindow.setBackgroundColor(ui.getThemeColor("Base"));var settingsLayout=new ui.VLayout;settingsLayout.setMargins(15,15,15,15),settingsLayout.setSpaceBetween(4);var titleLabel=new ui.Label("Settings");titleLabel.setTextColor(ui.getThemeColor("Light")),titleLabel.setFontSize(18),settingsLayout.add(titleLabel),settingsLayout.addSpacing(12);var autoSaveLayout=new ui.HLayout,autoSaveCheckbox=new ui.Checkbox(autoSaveEnabled);autoSaveEnabled?autoSaveCheckbox.setValue(!0):autoSaveCheckbox.setValue(!1),autoSaveCheckbox.onValueChanged=function(){autoSaveEnabled=autoSaveCheckbox.getValue()},autoSaveLayout.add(autoSaveCheckbox),autoSaveLayout.add(new ui.Label("Auto-save before import")),autoSaveLayout.setSpaceBetween(8),settingsLayout.add(autoSaveLayout);var groupsLayout=new ui.HLayout,importGroupsCheckbox=new ui.Checkbox(importGroupsEnabled);importGroupsCheckbox.onValueChanged=function(){importGroupsEnabled=importGroupsCheckbox.getValue()},groupsLayout.add(importGroupsCheckbox),groupsLayout.add(new ui.Label("Import groups")),groupsLayout.setSpaceBetween(8),settingsLayout.add(groupsLayout);var gradientsLayout=new ui.HLayout,importGradientsCheckbox=new ui.Checkbox(importGradientsEnabled);importGradientsCheckbox.onValueChanged=function(){importGradientsEnabled=importGradientsCheckbox.getValue()},gradientsLayout.add(importGradientsCheckbox),gradientsLayout.add(new ui.Label("Import gradients")),gradientsLayout.setSpaceBetween(8),settingsLayout.add(gradientsLayout);var liveTextLayout=new ui.HLayout,importLiveTextCheckbox=new ui.Checkbox(importLiveTextEnabled);importLiveTextCheckbox.onValueChanged=function(){importLiveTextEnabled=importLiveTextCheckbox.getValue()},liveTextLayout.add(importLiveTextCheckbox),liveTextLayout.add(new ui.Label("Import live text")),liveTextLayout.setSpaceBetween(8),settingsLayout.add(liveTextLayout);var emojisLayout=new ui.HLayout,importEmojisCheckbox=new ui.Checkbox(importEmojisEnabled);importEmojisCheckbox.onValueChanged=function(){importEmojisEnabled=importEmojisCheckbox.getValue()},emojisLayout.add(importEmojisCheckbox),emojisLayout.add(new ui.Label("Import emojis")),emojisLayout.setSpaceBetween(8),settingsLayout.add(emojisLayout);var imageryLayout=new ui.HLayout,importImageryCheckbox=new ui.Checkbox(importImageryEnabled);importImageryCheckbox.onValueChanged=function(){importImageryEnabled=importImageryCheckbox.getValue()},imageryLayout.add(importImageryCheckbox),imageryLayout.add(new ui.Label("Import imagery")),imageryLayout.setSpaceBetween(8),settingsLayout.add(imageryLayout);var effectsLayout=new ui.HLayout,importEffectsCheckbox=new ui.Checkbox(importEffectsEnabled);importEffectsCheckbox.onValueChanged=function(){importEffectsEnabled=importEffectsCheckbox.getValue()},effectsLayout.add(importEffectsCheckbox),effectsLayout.add(new ui.Label("Import effects (blur, drop shadow)")),effectsLayout.setSpaceBetween(8),settingsLayout.add(effectsLayout);var qualityLayout=new ui.HLayout;qualityLayout.add(new ui.Label("Image quality"));var filterQualityDropdown=new ui.DropDown;filterQualityDropdown.addEntry("None (Fastest)"),filterQualityDropdown.addEntry("Bilinear"),filterQualityDropdown.addEntry("Mipmaps (Use For Scaling Down)"),filterQualityDropdown.addEntry("Bicubic (Use For Scaling Up)"),filterQualityDropdown.setValue(imageFilterQuality),filterQualityDropdown.onValueChanged=function(){imageFilterQuality=filterQualityDropdown.getValue()},qualityLayout.addStretch(),qualityLayout.add(filterQualityDropdown),settingsLayout.add(qualityLayout);var emojiPlaceholderLayout=new ui.HLayout;emojiPlaceholderLayout.add(new ui.Label("Emoji placeholder"));var emojiPlaceholderInput=new ui.LineEdit;emojiPlaceholderInput.setText(emojiPlaceholder),emojiPlaceholderInput.setPlaceholder("[e]"),emojiPlaceholderInput.setMaximumWidth(60),emojiPlaceholderInput.onTextChanged=function(){var newValue=emojiPlaceholderInput.getText();3===newValue.length?emojiPlaceholder=newValue:newValue.length>0&&3!==newValue.length&&console.warn("Emoji placeholder must be exactly 3 characters")},emojiPlaceholderLayout.addStretch(),emojiPlaceholderLayout.add(emojiPlaceholderInput),settingsLayout.add(emojiPlaceholderLayout),settingsLayout.addSpacing(16),rectangleConversionLabel=new ui.Label("Rectangle conversion settings"),rectangleConversionLabel.setTextColor("#969696"),settingsLayout.add(rectangleConversionLabel);var radiusLayout=new ui.HLayout;radiusLayout.add(new ui.Label("Default radius"));var cornerRadiusInput=new ui.LineEdit;cornerRadiusInput.setText(defaultRadius),cornerRadiusInput.setPlaceholder("15"),cornerRadiusInput.setMaximumWidth(60),cornerRadiusInput.onTextChanged=function(){defaultRadius=cornerRadiusInput.getText()},radiusLayout.addStretch(),radiusLayout.add(cornerRadiusInput),settingsLayout.add(radiusLayout);var keepLayout=new ui.HLayout,keepOriginalCheckbox=new ui.Checkbox(keepOriginalEnabled);keepOriginalEnabled?keepOriginalCheckbox.setValue(!0):keepOriginalCheckbox.setValue(!1),keepOriginalCheckbox.onValueChanged=function(){keepOriginalEnabled=keepOriginalCheckbox.getValue()},keepLayout.add(keepOriginalCheckbox),keepLayout.add(new ui.Label("Keep original shapes")),keepLayout.setSpaceBetween(8),settingsLayout.add(keepLayout),settingsLayout.addSpacing(15);var buttonLayout=new ui.HLayout;buttonLayout.setSpaceBetween(10);var applyButton=new ui.Button("Apply");applyButton.setMinimumHeight(24),applyButton.onClick=function(){autoSaveEnabled=autoSaveCheckbox.getValue(),keepOriginalEnabled=keepOriginalCheckbox.getValue(),defaultRadius=cornerRadiusInput.getText(),importGradientsEnabled=importGradientsCheckbox.getValue(),importLiveTextEnabled=importLiveTextCheckbox.getValue(),importEmojisEnabled=importEmojisCheckbox.getValue(),importImageryEnabled=importImageryCheckbox.getValue(),importEffectsEnabled=importEffectsCheckbox.getValue(),importGroupsEnabled=importGroupsCheckbox.getValue(),imageFilterQuality=filterQualityDropdown.getValue();var emojiValue=emojiPlaceholderInput.getText();3===emojiValue.length?emojiPlaceholder=emojiValue:(console.warn("Emoji placeholder must be exactly 3 characters - keeping current value: "+emojiPlaceholder),emojiPlaceholderInput.setText(emojiPlaceholder)),console.info("Settings applied")};var closeButton=new ui.Button("Close");closeButton.setMinimumHeight(24),closeButton.onClick=function(){settingsWindow.close(),settingsWindow=null},buttonLayout.add(applyButton),buttonLayout.add(closeButton),settingsLayout.add(buttonLayout),settingsLayout.addSpacing(32);var settingsLogo=new ui.ImageButton(QUIVER_ASSETS_PATH+"quiver_logo_v01.png");settingsLogo.setImageSize(106,35),settingsLogo.setDrawStroke(!1),settingsLogo.setBackgroundColor(ui.getThemeColor("Base")),settingsLogo.setTransparentForMouseEvents(!0),settingsLayout.add(settingsLogo),settingsLayout.addSpacing(10);var sloganLabel=new ui.Label("Fire SVGs from Figma into Cavalry üèπ");sloganLabel.setTextColor("#bebebe"),sloganLabel.setAlignment(1),settingsLayout.add(sloganLabel);var versionLabel=new ui.Label("Version 1.6.2");versionLabel.setAlignment(1),versionLabel.setTextColor("#bebebe"),settingsLayout.add(versionLabel),settingsLayout.addSpacing(16);var finePrint1=new ui.Label("Any q's or bugs?");finePrint1.setTextColor("#969696"),finePrint1.setAlignment(1),settingsLayout.add(finePrint1);var finePrint2=new ui.Label("Raise an issue on GitHub.");finePrint2.setTextColor("#969696"),finePrint2.setAlignment(1),settingsLayout.add(finePrint2);var finePrintCredit=new ui.Label("Made by the Canva Creative Team");finePrintCredit.setAlignment(1),finePrintCredit.setTextColor("#969696"),settingsLayout.add(finePrintCredit);var openGitHubButton=new ui.Button("Open GitHub Repo");openGitHubButton.setMinimumHeight(24),openGitHubButton.onClick=function(){api.openURL("https://github.com/phillip-motion/quiver")},settingsLayout.add(openGitHubButton);var openCreativeTeamButton=new ui.Button("canvacreative.team/motion");openCreativeTeamButton.setMinimumHeight(24),openCreativeTeamButton.onClick=function(){api.openURL("https://canvacreative.team/motion")},settingsLayout.add(openCreativeTeamButton),settingsLayout.addSpacing(5),settingsLayout.addStretch(),settingsWindow.setLayout(settingsLayout),settingsWindow.move(50,50),settingsWindow.show()}renamerButton.setImageSize(22,22),renamerButton.setSize(34,34),renamerButton.setToolTip("Rename"),renamerButton.onClick=function(){try{renameSelectedLayers()}catch(e){console.error("Rename error: "+e.message)}},settingsButton.onClick=function(){createSettingsWindow()};var mainLayout=new ui.VLayout;mainLayout.setSpaceBetween(0),mainLayout.setMargins(0,0,0,0);var headerLayout=new ui.HLayout,newVersionAvailableLayout=new ui.HLayout;newVersionAvailableLayout.setMargins(6,0,3,6);var newVersionAvailableLabel=new ui.Label("New version available");newVersionAvailableLabel.setMinimumWidth(120),newVersionAvailableLabel.setContentsMargins(0,7,0,0),newVersionAvailableLabel.setTextColor("#ffffff"),newVersionAvailableLayout.add(newVersionAvailableLabel);var newVersionAvailableButton=new ui.Button("Update");newVersionAvailableButton.setMinimumHeight(24),newVersionAvailableButton.onClick=function(){api.openURL("https://github.com/phillip-motion/quiver/releases/latest")},newVersionAvailableLayout.addStretch(),newVersionAvailableLayout.add(newVersionAvailableButton);var newVersionAvailable=new ui.Container;if(newVersionAvailable.setBackgroundColor("#4a53fa"),newVersionAvailable.setLayout(newVersionAvailableLayout),api.hasPreferenceObject(scriptName+"_update_check")){var updatePrefs=api.getPreferenceObject(scriptName+"_update_check");updatePrefs.latestVersion&&compareVersions(updatePrefs.latestVersion,"1.6.2")>0&&mainLayout.add(newVersionAvailable)}var mainButtonsContainer=new ui.Container;mainButtonsContainer.setBackgroundColor(ui.getThemeColor("AlternateBase"));var mainButtons=new ui.HLayout;mainButtons.setSpaceBetween(6),mainButtons.setMargins(6,6,6,6);var logo=new ui.ImageButton(QUIVER_ASSETS_PATH+"quiver_icon_v01.png");logo.setImageSize(28,29),logo.setBackgroundColor(ui.getThemeColor("AlternateBase")),logo.setDrawStroke(!1),logo.setTransparentForMouseEvents(!0),logo.setSize(28,29),mainButtons.add(logo),mainButtons.add(pasteButton),mainButtons.add(importFileButton),mainButtonsContainer.setLayout(mainButtons),mainLayout.add(mainButtonsContainer);var toolButtonsContainer=new ui.Container,toolsVLayout=new ui.VLayout;toolsVLayout.setSpaceBetween(2),toolsVLayout.setMargins(6,6,6,6);var toolButtonsLayout=new ui.HLayout;toolButtonsLayout.add(convertRectButton),toolButtonsLayout.add(dynamicAlignButton),toolButtonsLayout.add(flattenShapeButton),toolButtonsLayout.add(cycleTextAlignButton),toolButtonsLayout.add(cycleVerticalTextAlignButton),toolButtonsLayout.addStretch(),toolButtonsLayout.add(settingsButton);var renameLayout=new ui.HLayout;function SelectionCallbacks(){this.onSelectionChanged=function(){updateTextAlignIcon(),updateVerticalTextAlignIcon()}}renameLayout.add(renamerInput),renameLayout.add(renamerButton),toolsVLayout.add(renameLayout),toolsVLayout.add(toolButtonsLayout),toolButtonsContainer.setLayout(toolsVLayout),mainLayout.add(toolButtonsContainer),mainLayout.addStretch(),ui.add(mainLayout),ui.setMargins(0,0,0,0),ui.setMinimumWidth(150);var selectionCallbackObj=new SelectionCallbacks;
// quiver_function_flattenShape.js
function flattenShape(){try{var sel=api.getSelection();if(!sel||0===sel.length)return void console.error("Please select shape(s) to flatten");for(var shapeTypes=["rectangleShape","ellipseShape","starShape","polygonShape","customShape","editable","editableShape","textShape","pathShape"],alternateTypes=["rectangle","ellipse","star","polygon","path","text"],validShapes=[],i=0;i<sel.length;i++)try{var type=api.getType(sel[i]);-1===shapeTypes.indexOf(type)&&-1===alternateTypes.indexOf(type)||validShapes.push(sel[i])}catch(e){}0===validShapes.length&&(validShapes=sel);var firstItemName="";try{firstItemName=api.getNiceName(validShapes[0])||""}catch(e){}var groupId,baseName=firstItemName||"Shape",customShapeName=baseName+" Flattened",groupName=baseName+" Group",customShapeId=null;try{customShapeId=api.create("customShape",customShapeName)}catch(e){var errorMsg=e&&e.message?e.message:"Failed to create custom shape";return void console.error(errorMsg)}try{groupId=api.create("group",groupName),api.parent(groupId,customShapeId);for(i=0;i<validShapes.length;i++)api.parent(validShapes[i],groupId)}catch(e){errorMsg=e&&e.message?e.message:"Failed to create/organize group";return void console.error(errorMsg)}try{api.connect(groupId,"id",customShapeId,"inputShape")}catch(e){errorMsg=e&&e.message?e.message:"Failed to connect group to custom shape";return void console.error(errorMsg)}try{api.set(groupId,{hidden:!0})}catch(e){}try{var deformerId=null,deformerName="Flatten Shape Layers ["+customShapeName+"]";try{deformerId=api.create("flattenShapeLayers",deformerName)}catch(eCreate){}if(!deformerId)return void console.error("Error: Could not create Flatten Shape Layers deformer");try{api.connect(deformerId,"id",customShapeId,"deformers")}catch(eConnect){return void console.error("Error connecting deformer to custom shape")}try{api.parent(deformerId,customShapeId)}catch(eParent){}}catch(e){errorMsg=e&&e.message?e.message:"Failed to add deformer";return void console.error(errorMsg)}try{api.select([customShapeId])}catch(e){}console.info("Flattened "+validShapes.length+" shape(s) into: "+customShapeName)}catch(e){console.error("Error: "+e.message)}}
// quiver_function_convertToRectangle.js
function _copyBasicStyles(fromId,toId){try{var fillOn=!1;try{fillOn=api.hasFill(fromId)}catch(e){}if(fillOn){try{api.setFill(toId,!0)}catch(eF1){}var fs={};try{var col=api.get(fromId,"material.materialColor");col&&(fs["material.materialColor"]=col)}catch(eC){}try{var al=api.get(fromId,"material.alpha");"number"==typeof al&&(fs["material.alpha"]=al)}catch(eA){}if(Object.keys(fs).length)try{api.set(toId,fs)}catch(eFS){}}else try{api.setFill(toId,!1)}catch(eF0){}var strokeOn=!1;try{strokeOn=api.hasStroke(fromId)}catch(eS){}if(strokeOn){try{api.setStroke(toId,!0)}catch(eS1){}var ss={};try{var scol=api.get(fromId,"stroke.strokeColor");scol&&(ss["stroke.strokeColor"]=scol)}catch(eSC){}try{var sw=api.get(fromId,"stroke.width");"number"==typeof sw&&(ss["stroke.width"]=sw)}catch(eSW){}try{var sa=api.get(fromId,"stroke.alpha");"number"==typeof sa&&(ss["stroke.alpha"]=sa)}catch(eSA){}try{var salign=api.get(fromId,"stroke.align");if(null!=salign){var okAlign=!1;try{api.set(toId,{"stroke.align":salign}),okAlign=!0}catch(eSetAlign){okAlign=!1}if(!okAlign){var enumVal=0,sval=(""+salign).toLowerCase();"inner"===sval?enumVal=1:"outer"===sval&&(enumVal=2);try{api.set(toId,{"stroke.align":enumVal})}catch(eSetAlign2){}}}}catch(eGA){}try{var capStyle=api.get(fromId,"stroke.capStyle");if(null!=capStyle)try{api.set(toId,{"stroke.capStyle":capStyle})}catch(eSetCap){}}catch(eGCap){}try{var joinStyle=api.get(fromId,"stroke.joinStyle");if(null!=joinStyle)try{api.set(toId,{"stroke.joinStyle":joinStyle})}catch(eSetJoin){}}catch(eGJoin){}try{var dp=api.get(fromId,"stroke.dashPattern");if(dp)try{api.set(toId,{"stroke.dashPattern":dp})}catch(eDPs){}var dm=api.get(fromId,"stroke.dashPatternMode");if(null!=dm)try{api.set(toId,{"stroke.dashPatternMode":dm})}catch(eDMs){}var dof=api.get(fromId,"stroke.dashOffset");if("number"==typeof dof)try{api.set(toId,{"stroke.dashOffset":dof})}catch(eDOf){}}catch(eDash){}if(Object.keys(ss).length)try{api.set(toId,ss)}catch(eSS){}}else try{api.setStroke(toId,!1)}catch(eS0){}}catch(eAll){}}function _mapAttributeToBasicShape(attrId){return attrId&&0===attrId.indexOf("material.colorShaders")&&attrId.indexOf(".shader")>0?"material.colorShaders":attrId&&0===attrId.indexOf("stroke.colorShaders")&&attrId.indexOf(".shader")>0?"stroke.colorShaders":attrId&&0===attrId.indexOf("masks.")&&/^masks\.\d+$/.test(attrId)?"masks":attrId}function _transferConnections(fromId,toId){var transferred=0;try{var inAttrs=api.getInConnectedAttributes(fromId);if(inAttrs&&inAttrs.length>0)for(var i=0;i<inAttrs.length;i++){var attrId=inAttrs[i];if(!attrId||0!==attrId.indexOf("filters.")&&0!==attrId.indexOf("masks.")&&0!==attrId.indexOf("materialBehaviours.")||!/\.\d+$/.test(attrId))try{var inConn=api.getInConnection(fromId,attrId);if(inConn&&inConn.length>0){var firstDotIndex=inConn.indexOf(".");if(firstDotIndex>0){var sourceLayerId=inConn.substring(0,firstDotIndex),sourceAttrId=inConn.substring(firstDotIndex+1),mappedAttrId=_mapAttributeToBasicShape(attrId);try{api.connect(sourceLayerId,sourceAttrId,toId,mappedAttrId,!0),transferred++}catch(eConnect){}}}}catch(eIn){}}}catch(eInAttrs){}try{var outAttrs=api.getOutConnectedAttributes(fromId);if(outAttrs&&outAttrs.length>0)for(var j=0;j<outAttrs.length;j++){var outAttrId=outAttrs[j];if(!outAttrId||!/\.\d+$/.test(outAttrId))try{var outConns=api.getOutConnections(fromId,outAttrId);if(outConns&&outConns.length>0)for(var k=0;k<outConns.length;k++){var outConn=outConns[k],outFirstDotIndex=outConn.indexOf(".");if(outFirstDotIndex>0){var destLayerId=outConn.substring(0,outFirstDotIndex),destAttrId=outConn.substring(outFirstDotIndex+1);try{api.connect(toId,outAttrId,destLayerId,destAttrId,!0),transferred++}catch(eConnectOut){}}}}catch(eOut){}}}catch(eOutAttrs){}return transferred}function convertSelectionToRect(keepOriginalHidden){try{var selection=api.getSelection();if(!selection||0===selection.length)return void console.error("Select at least one layer");for(var defVal=parseFloat(defaultRadius),converted=0,connectionsTransferred=0,i=0;i<selection.length;i++){var layerId=selection[i];if(api.layerExists(layerId)){var bbox=null;try{bbox=api.getBoundingBox(layerId,!0)}catch(eBB){bbox=null}if(bbox&&bbox.width&&bbox.height){var name=null;try{name=api.getNiceName(layerId)}catch(eNm){name=null}name||(name="Converted Shape");var isCircle=Math.abs((bbox.width||0)-(bbox.height||0))<.5&&!isNaN(defVal)&&defVal>=bbox.width/2-.5,prim=isCircle?"ellipse":"rectangle",newId=null;try{newId=api.primitive(prim,name+(isCircle?" (Circle)":" (Rect)"))}catch(eCr){newId=null}if(newId){try{if(isCircle)api.set(newId,{"generator.radius":[bbox.width/2,bbox.height/2],"position.x":bbox.centre.x,"position.y":bbox.centre.y});else if(api.set(newId,{"generator.dimensions":[bbox.width,bbox.height],"position.x":bbox.centre.x,"position.y":bbox.centre.y}),!isNaN(defVal)&&defVal>0)try{api.set(newId,{"generator.cornerRadius":defVal})}catch(eCR){}}catch(eSet){}_copyBasicStyles(layerId,newId);try{var parentId=api.getParent(layerId);parentId&&api.parent(newId,parentId);var rot=api.get(layerId,"rotation");"number"==typeof rot&&api.set(newId,{rotation:rot});var sx=api.get(layerId,"scale.x"),sy=api.get(layerId,"scale.y"),scaleSet={};"number"==typeof sx&&(scaleSet["scale.x"]=sx),"number"==typeof sy&&(scaleSet["scale.y"]=sy),Object.keys(scaleSet).length&&api.set(newId,scaleSet)}catch(eTr){}try{var children=api.getChildren(layerId);if(children&&children.length>0)for(var c=0;c<children.length;c++){var childId=children[c];try{api.getNiceName(childId)}catch(e){0}try{api.getNodeType(childId)}catch(e){0}try{api.parent(childId,newId)}catch(eReparent){}}}catch(eChildren){}try{connectionsTransferred+=_transferConnections(layerId,newId)}catch(eTransfer){}try{var inAttrs=api.getInConnectedAttributes(layerId);if(inAttrs&&inAttrs.length>0)for(var m=0;m<inAttrs.length;m++){var mAttr=inAttrs[m];if(mAttr&&0===mAttr.indexOf("masks.")&&/^masks\.\d+$/.test(mAttr))try{var maskConn=api.getInConnection(layerId,mAttr);if(maskConn&&maskConn.length>0){var dotIdx=maskConn.indexOf(".");if(dotIdx>0){var maskShapeId=maskConn.substring(0,dotIdx);api.connect(maskShapeId,"id",newId,"masks"),connectionsTransferred++}}}catch(eMaskConn){}}}catch(eMasks){}try{keepOriginalHidden?api.set(layerId,{hidden:!0}):api.deleteLayer(layerId)}catch(eDel){}converted++}}}}var msg=converted>0?"Converted "+converted+" layer(s)":"No valid layers";connectionsTransferred>0&&(msg+=" ("+connectionsTransferred+" connection(s) transferred)"),console.info(msg)}catch(e){var errorMsg=e&&e.message?e.message:"An error occurred";"undefined"!==errorMsg&&"null"!==errorMsg&&console.error("Error: "+errorMsg)}}
// quiver_function_dynamicAlign.js
function applyDynamicAlignToLayer(layerId){try{if(!api.layerExists(layerId))return!1;var bbox=null;try{bbox=api.getBoundingBox(layerId,!0)}catch(e){bbox=null}if(!bbox||!bbox.width||!bbox.height)return!1;var sx=1,sy=1;try{sx=api.get(layerId,"scale.x"),sy=api.get(layerId,"scale.y")}catch(eS){sx=1,sy=1}isFinite(sx)&&0!==sx||(sx=1),isFinite(sy)&&0!==sy||(sy=1);var originalWidth=bbox.width/sx,originalHeight=bbox.height/sy,alignId=null;try{alignId=api.create("align","Dynamic Align")}catch(eA){alignId=null}if(!alignId)return!1;try{api.connect(alignId,"id",layerId,"deformers")}catch(eConDef){}var jsId=null;try{jsId=api.create("javaScript","Scale Aware Pivot")}catch(eJ){jsId=null}if(!jsId)return!1;try{api.addDynamic(jsId,"array","double")}catch(eD1){}try{api.addDynamic(jsId,"array","double")}catch(eD2){}var expr="// Original unscaled dimensions\nvar originalWidth = "+originalWidth+";\nvar originalHeight = "+originalHeight+";\n\n// Half dimensions\nvar halfWidth = (originalWidth / 2);\nvar halfHeight = (originalHeight / 2);\n\n// Inputs\nvar pivotX = halfWidth * alignX;\nvar pivotY = halfHeight * alignY;\n\n[pivotX, pivotY]";try{api.set(jsId,{expression:expr})}catch(eExpr){}try{api.renameAttribute(jsId,"array.1","alignX")}catch(eR1){}try{api.renameAttribute(jsId,"array.2","alignY")}catch(eR2){}try{api.connect(alignId,"x",jsId,"array.1")}catch(eAx){}try{api.connect(alignId,"y",jsId,"array.2")}catch(eAy){}try{api.connect(jsId,"id",layerId,"pivot")}catch(ePiv){}try{api.parent(alignId,layerId)}catch(ePA){}try{api.parent(jsId,layerId)}catch(ePJ){}return!0}catch(eAll){return!1}}
// quiver_function_renameLayers.js
function renameSelectedLayers(){try{var sel=api.getSelection();if(!sel||0===sel.length)return void console.error("Please select layer(s) to rename");var newName=renamerInput.getText().trim();if(!newName)return void console.error("Please enter a name in the rename field");var renamed=0;if(1===sel.length)try{api.rename(sel[0],newName),renamed=1}catch(e){}else for(var i=0;i<sel.length;i++)try{var numberedName=newName+" "+(i+1);api.rename(sel[i],numberedName),renamed++}catch(e){}renamed>0?console.info("Renamed "+renamed+" layer(s)"):console.error("Failed to rename layers")}catch(e){console.error("Error: "+e.message)}}
// quiver_function_cycleTextAlignment.js
function cycleTextAlignment(){var selection=api.getSelection();if(selection&&0!==selection.length)for(var i=0;i<selection.length;i++){var layerId=selection[i],isTextShape=!1;if("string"==typeof layerId&&0===layerId.indexOf("textShape#")&&(isTextShape=!0),!isTextShape)try{var layerType=api.getType(layerId);"textShape"!==layerType&&"text"!==layerType||(isTextShape=!0)}catch(e){}if(isTextShape){var currentAlignment=0;try{currentAlignment=api.get(layerId,"horizontalAlignment")}catch(e){continue}var bboxBefore=null;try{bboxBefore=api.getBoundingBox(layerId,!0)}catch(e){}if(bboxBefore&&bboxBefore.centre){var targetCenterX=bboxBefore.centre.x,newAlignment=(currentAlignment+1)%4;try{api.set(layerId,{horizontalAlignment:newAlignment})}catch(e){continue}var bboxAfter=null;try{bboxAfter=api.getBoundingBox(layerId,!0)}catch(e){}if(bboxAfter&&bboxAfter.centre){var drift=bboxAfter.centre.x-targetCenterX,posAfterAlignment=0;try{posAfterAlignment=api.get(layerId,"position.x")}catch(e){continue}var correctedPosX=posAfterAlignment-drift;try{api.set(layerId,{"position.x":correctedPosX})}catch(e){continue}}}}}}
// quiver_function_cycleVerticalTextAlignment.js
function cycleVerticalTextAlignment(){var selection=api.getSelection();if(selection&&0!==selection.length)for(var i=0;i<selection.length;i++){var layerId=selection[i],isTextShape=!1;if("string"==typeof layerId&&0===layerId.indexOf("textShape#")&&(isTextShape=!0),!isTextShape)try{var layerType=api.getType(layerId);"textShape"!==layerType&&"text"!==layerType||(isTextShape=!0)}catch(e){}if(isTextShape){var currentAlignment=0;try{currentAlignment=api.get(layerId,"verticalAlignment")}catch(e){continue}var bboxBefore=null;try{bboxBefore=api.getBoundingBox(layerId,!0)}catch(e){}if(bboxBefore&&bboxBefore.centre){var targetCenterY=bboxBefore.centre.y,newAlignment=(currentAlignment+1)%4;try{api.set(layerId,{verticalAlignment:newAlignment})}catch(e){continue}var bboxAfter=null;try{bboxAfter=api.getBoundingBox(layerId,!0)}catch(e){}if(bboxAfter&&bboxAfter.centre){var drift=bboxAfter.centre.y-targetCenterY,posAfterAlignment=0;try{posAfterAlignment=api.get(layerId,"position.y")}catch(e){continue}var correctedPosY=posAfterAlignment-drift;try{api.set(layerId,{"position.y":correctedPosY})}catch(e){continue}}}}}}
// quiver_utiltiies_sharedFunctions.js
function clamp01(n){return Math.max(0,Math.min(1,n))}function parseOpacityValue(value){if(null==value||""===value)return null;var v=(""+value).trim();if(v.endsWith("%")){var num=parseFloat(v.slice(0,-1));return isNaN(num)?null:clamp01(num/100)}var n=parseFloat(v);return isNaN(n)?null:clamp01(n)}function parseColor(colorString){if(!colorString||"none"===colorString)return null;if("#"===colorString[0])return colorString;var named={white:"#FFFFFF",black:"#000000",red:"#FF0000",green:"#008000",blue:"#0000FF",yellow:"#FFFF00",cyan:"#00FFFF",magenta:"#FF00FF",gray:"#808080",grey:"#808080"},lower=(colorString+"").toLowerCase();if(named[lower])return named[lower];if(0===lower.indexOf("rgb(")){var m=lower.match(/rgb\((\d+),\s*(\d+),\s*(\d+)\)/);if(m)return"#"+parseInt(m[1]).toString(16).padStart(2,"0")+parseInt(m[2]).toString(16).padStart(2,"0")+parseInt(m[3]).toString(16).padStart(2,"0")}if(0===lower.indexOf("rgba(")){var mr=lower.match(/rgba\((\d+),\s*(\d+),\s*(\d+),\s*([\d.]+)\)/);if(mr)return"#"+parseInt(mr[1]).toString(16).padStart(2,"0")+parseInt(mr[2]).toString(16).padStart(2,"0")+parseInt(mr[3]).toString(16).padStart(2,"0")}return colorString}function normalizeDashArrayToCsv(val){try{if(null==val)return null;var s=(""+val).trim();if(!s||"none"===s.toLowerCase()||"0"===s)return null;for(var parts=(s=s.replace(/,/g," ")).split(/\s+/).filter(function(t){return""!==t}),nums=[],i=0;i<parts.length;i++){var n=parseFloat(parts[i]);!isNaN(n)&&isFinite(n)&&nums.push(Math.max(0,n))}return 0===nums.length?null:nums.join(", ")}catch(e){return null}}function extractAttribute(tag,name){if(!tag||!name)return null;var match=new RegExp("(?:^|\\s)"+name+'\\s*=\\s*"([^"]*)"').exec(tag);return match||(match=new RegExp("(?:^|\\s)"+name+"\\s*=\\s*'([^']*)'").exec(tag))?match[1]:null}function extractStyleProperty(styleString,propertyName){if(!styleString||!propertyName)return null;for(var parts=styleString.split(";"),target=(""+propertyName).trim().toLowerCase(),i=0;i<parts.length;i++){var seg=parts[i];if(seg){var kv=seg.split(":");if(!(kv.length<2))if(kv[0].trim().toLowerCase()===target)return kv.slice(1).join(":").trim()}}return null}function mergeInlineStyleIntoAttrs(openingTag){var styleAttr=extractAttribute(openingTag,"style"),merged={};if(!styleAttr)return merged;for(var parts=styleAttr.split(";"),i=0;i<parts.length;i++){var seg=parts[i];if(seg){var kv=seg.split(":");if(!(kv.length<2)){var key=kv[0].trim(),val=kv.slice(1).join(":").trim();merged[key]=val}}}return merged}function decodeEntitiesForName(str){if(!str)return str;var out=str;return out=(out=(out=out.replace(/&#x([0-9a-fA-F]+);/g,function(_,hex){try{return String.fromCodePoint(parseInt(hex,16))}catch(e){return _}})).replace(/((?:&#\d+;)+)/g,function(group){for(var m,nums=[],rx=/&#(\d+);/g;null!==(m=rx.exec(group));)nums.push(parseInt(m[1],10));if(0===nums.length)return group;try{var perc=nums.map(function(n){var h=n.toString(16).toUpperCase();return h.length<2&&(h="0"+h),"%"+h}).join("");return decodeURIComponent(perc)}catch(e){return nums.map(function(n){try{return String.fromCodePoint(n)}catch(e2){return""}}).join("")}})).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"').replace(/&apos;/g,"'")}function extractUrlRefId(value){if(!value)return null;var m=/url\(#([^\)]+)\)/.exec(value);return m?m[1]:null}ui.addCallbackObject(selectionCallbackObj),ui.onClose=function(){try{if(void 0!==Quiver&&"function"==typeof Quiver.cleanup&&Quiver.cleanup(),settingsWindow){try{settingsWindow.close()}catch(e){}settingsWindow=null}}catch(e){}},ui.show();var __svgGradientMap={},__svgGradientCache={},__createdPathLayers=[],__svgViewBox=null,__svgFilterMap={},__filterNodesCache={},__groupDirectChildren={},__imageImportCache={},__svgPatternMap={},__patternImageShaderCache={},__lastPatternOrImageName="img",__imageNamingContext={},__imageCounter=0,__groupCounter=0,__deferredBackgroundBlurs=[];function setPatternContext(map){__svgPatternMap=map||{},__patternImageShaderCache={}}function _hasAttr(id,attr){try{if(api.hasAttribute)return!!api.hasAttribute(id,attr)}catch(e){}try{api.get(id,attr);return!0}catch(e2){return!1}}function _sanitizeFileComponent(name){try{var s=(null==name?"":""+name).trim();return(s=(s=(s=(s=decodeEntitiesForName(s)).replace(/[\\/:*?"<>|\x00-\x1F\x7F]+/g,"_")).replace(/\s+/g,"_")).replace(/^_+|_+$/g,""))||(s="img"),s.length>40&&(s=s.slice(0,40)),s}catch(e){return"img"}}function _setFirstSupported(id,candidates,value){for(var i=0;i<candidates.length;i++){var a=candidates[i];if(_hasAttr(id,a))try{var obj={};return obj[a]=value,api.set(id,obj),a}catch(eSet){}}return null}function connectShaderToShape(shaderId,shapeId,svgShapeCenter,fillAlpha,shapeScaleY,shapeRotationDeg){var isFlippedY=void 0!==shapeScaleY&&shapeScaleY<0;try{api.setFill(shapeId,!0)}catch(e){}try{api.set(shapeId,{"material.materialColor.a":0})}catch(eA){}try{api.set(shapeId,{"material.alpha":100})}catch(eMA){}try{if(api.connect(shaderId,"id",shapeId,"material.colorShaders"),"number"==typeof fillAlpha&&fillAlpha<1){var shaderAlphaPct=Math.round(100*fillAlpha);try{api.set(shaderId,{alpha:shaderAlphaPct})}catch(eShaderAlpha){}}try{api.set(shaderId,{hidden:!1})}catch(eVis){}try{var gradientData=null;if(__svgGradientMap&&__svgGradientCache)for(var gid in __svgGradientCache)if(__svgGradientCache[gid]===shaderId){gradientData=__svgGradientMap[gid];break}if(gradientData&&"radial"===gradientData.type&&void 0!==gradientData._absoluteCenterX&&void 0!==gradientData._absoluteCenterY){var absX=parseFloat(gradientData._absoluteCenterX),absY=parseFloat(gradientData._absoluteCenterY);if(!isNaN(absX)&&!isNaN(absY)){var shapeSvgCenterX=null,shapeSvgCenterY=null;if(svgShapeCenter&&void 0!==svgShapeCenter.x&&void 0!==svgShapeCenter.y&&(shapeSvgCenterX=svgShapeCenter.x,shapeSvgCenterY=svgShapeCenter.y),null!==shapeSvgCenterX&&null!==shapeSvgCenterY){var relativeOffsetX=absX-shapeSvgCenterX,relativeOffsetY=-(absY-shapeSvgCenterY);try{isNaN(relativeOffsetX)||isNaN(relativeOffsetY)||api.set(shaderId,{"generator.offset.x":relativeOffsetX,"generator.offset.y":relativeOffsetY})}catch(eOffset){console.warn("[RADIAL GRADIENT] Could not set offset: "+eOffset.message)}}}}}catch(eCalcOffset){console.warn("[RADIAL GRADIENT] Error calculating offset: "+eCalcOffset.message)}try{var gradientDataRR=null;if(__svgGradientMap&&__svgGradientCache)for(var gidRR in __svgGradientCache)if(__svgGradientCache[gidRR]===shaderId){gradientDataRR=__svgGradientMap[gidRR];break}if(gradientDataRR&&"radial"===gradientDataRR.type&&gradientDataRR.transform){var shapeBbox=api.getBoundingBox(shapeId,!1);if(shapeBbox&&shapeBbox.width>0&&shapeBbox.height>0){var shapeWidth=shapeBbox.width,shapeHeight=shapeBbox.height,matrixRR=parseTransformMatrixList(gradientDataRR.transform),a=matrixRR.a,b=matrixRR.b,c=matrixRR.c,d=matrixRR.d,e=matrixRR.e||0,f=matrixRR.f||0;if((Math.abs(a)>2||Math.abs(b)>2||Math.abs(c)>2||Math.abs(d)>2||Math.abs(e)>2||Math.abs(f)>2)&&"userSpaceOnUse"===gradientDataRR.gradientUnits){var colXLength=Math.sqrt(a*a+b*b),colYLength=Math.sqrt(c*c+d*d),scaleX=colXLength/(shapeWidth/2)*100,scaleY=colYLength/(shapeHeight/2)*100;try{api.set(shaderId,{"generator.radiusRatio":1})}catch(eRR){}try{api.set(shaderId,{"generator.scale.x":scaleX,"generator.scale.y":scaleY})}catch(eScale){console.warn("[RADIAL GRADIENT] Could not set scale: "+eScale.message)}try{var rotationDeg=180*-Math.atan2(b,a)/Math.PI;api.set(shaderId,{"generator.rotation":rotationDeg})}catch(eRot){console.warn("[RADIAL GRADIENT] Could not set rotation: "+eRot.message)}}else{var centerX=.5*a+.5*c+e,centerY=.5*b+.5*d+f,dx1=(1*a+.5*c+e-centerX)*shapeWidth,dy1=(1*b+.5*d+f-centerY)*shapeHeight,dx2=(.5*a+1*c+e-centerX)*shapeWidth,dy2=(.5*b+1*d+f-centerY)*shapeHeight,dist1=Math.sqrt(dx1*dx1+dy1*dy1),dist2=Math.sqrt(dx2*dx2+dy2*dy2),radiusRatioNew=1;dist1>1e-4&&dist2>1e-4&&(radiusRatioNew=Math.max(dist1,dist2)/Math.min(dist1,dist2)),radiusRatioNew=Math.max(.01,Math.min(100,radiusRatioNew)),api.set(shaderId,{"generator.radiusRatio":radiusRatioNew})}}}}catch(eRadiusRatio){console.warn("[RADIAL GRADIENT] Error calculating scale: "+eRadiusRatio.message)}try{var gradientDataL=null;if(__svgGradientMap&&__svgGradientCache)for(var gidL in __svgGradientCache)if(__svgGradientCache[gidL]===shaderId){gradientDataL=__svgGradientMap[gidL];break}if(gradientDataL&&"linear"===gradientDataL.type&&"userSpaceOnUse"===gradientDataL.gradientUnits){var shapeBboxL=api.getBoundingBox(shapeId,!1);if(shapeBboxL&&shapeBboxL.width>0&&shapeBboxL.height>0){var shapeWidthL=shapeBboxL.width,shapeHeightL=shapeBboxL.height,x1=gradientDataL.x1||0,y1=gradientDataL.y1||0,x2=gradientDataL.x2||0,y2=gradientDataL.y2||0,dx=x2-x1,dy=y2-y1,gradientLength=Math.sqrt(dx*dx+dy*dy),gradCenterX=(x1+x2)/2,gradCenterY=(y1+y2)/2,shapeSvgCenterXL=null,shapeSvgCenterYL=null;if(svgShapeCenter&&void 0!==svgShapeCenter.x&&void 0!==svgShapeCenter.y)shapeSvgCenterXL=svgShapeCenter.x,shapeSvgCenterYL=svgShapeCenter.y;else try{var shapeBboxWorld=api.getBoundingBox(shapeId,!0),viewBoxWidth=1080,viewBoxHeight=1080;if(void 0!==__svgViewBox&&__svgViewBox&&(viewBoxWidth=__svgViewBox.width||viewBoxWidth,viewBoxHeight=__svgViewBox.height||viewBoxHeight),shapeBboxWorld&&shapeBboxWorld.width>0&&shapeBboxWorld.height>0){var worldCenterX=shapeBboxWorld.x+shapeBboxWorld.width/2,worldCenterY=shapeBboxWorld.y+shapeBboxWorld.height/2;shapeSvgCenterXL=viewBoxWidth/2+worldCenterX,shapeSvgCenterYL=viewBoxHeight/2-worldCenterY}}catch(eEstimate){}if(null!==shapeSvgCenterXL&&null!==shapeSvgCenterYL){var offsetSvgYL=gradCenterY-shapeSvgCenterYL,offsetCavXL=gradCenterX-shapeSvgCenterXL,offsetCavYL=isFlippedY?offsetSvgYL:-offsetSvgYL;try{api.set(shaderId,{"generator.offset.x":offsetCavXL,"generator.offset.y":offsetCavYL})}catch(eOffL){console.warn("[LINEAR GRADIENT] Could not set offset: "+eOffL.message)}}var angleRad=Math.atan2(dy,dx),scaleL=gradientLength/Math.max(shapeWidthL,shapeHeightL);Math.PI;try{api.set(shaderId,{"generator.scale":scaleL})}catch(eScaleL){console.warn("[LINEAR GRADIENT] Could not set scale: "+eScaleL.message)}if(isFlippedY)try{var currentRotation=0;try{currentRotation=api.get(shaderId,"generator.rotation")||0}catch(eGetRot){currentRotation=0}var newRotation=-currentRotation;newRotation=(newRotation%360+360)%360,Math.abs(newRotation-currentRotation)>.01&&api.set(shaderId,{"generator.rotation":newRotation})}catch(eRotL){console.warn("[LINEAR GRADIENT] Could not set rotation: "+eRotL.message)}}}}catch(eLinear){console.warn("[LINEAR GRADIENT] Error calculating properties: "+eLinear.message)}try{var currentParent=null;try{currentParent=api.getParent(shaderId)}catch(ePar){currentParent=null}currentParent||api.parent(shaderId,shapeId)}catch(ePar2){}return!0}catch(e1){}return!1}function connectShaderToStroke(shaderId,shapeId,svgShapeCenter){try{api.setStroke(shapeId,!0)}catch(e){}try{api.set(shapeId,{"stroke.strokeColor.a":0})}catch(eA){}try{api.connect(shaderId,"id",shapeId,"stroke.colorShaders");try{var gradientDataL=null;if(__svgGradientMap&&__svgGradientCache)for(var gidL in __svgGradientCache)if(__svgGradientCache[gidL]===shaderId){gradientDataL=__svgGradientMap[gidL];break}if(gradientDataL&&"linear"===gradientDataL.type&&"userSpaceOnUse"===gradientDataL.gradientUnits){var shapeBboxL=api.getBoundingBox(shapeId,!1);if(shapeBboxL&&shapeBboxL.width>0&&shapeBboxL.height>0){var shapeWidthL=shapeBboxL.width,shapeHeightL=shapeBboxL.height,x1=gradientDataL.x1||0,y1=gradientDataL.y1||0,x2=gradientDataL.x2||0,y2=gradientDataL.y2||0,dx=x2-x1,dy=y2-y1,gradientLength=Math.sqrt(dx*dx+dy*dy),gradCenterX=(x1+x2)/2,gradCenterY=(y1+y2)/2,shapeSvgCenterXL=null,shapeSvgCenterYL=null;if(svgShapeCenter&&void 0!==svgShapeCenter.x&&void 0!==svgShapeCenter.y)shapeSvgCenterXL=svgShapeCenter.x,shapeSvgCenterYL=svgShapeCenter.y;else try{var shapeBboxWorldS=api.getBoundingBox(shapeId,!0),viewBoxWidth=__svgViewBox&&__svgViewBox.width||1080,viewBoxHeight=__svgViewBox&&__svgViewBox.height||1080;if(shapeBboxWorldS&&shapeBboxWorldS.width>0&&shapeBboxWorldS.height>0){var worldCenterXS=shapeBboxWorldS.x+shapeBboxWorldS.width/2,worldCenterYS=shapeBboxWorldS.y+shapeBboxWorldS.height/2;shapeSvgCenterXL=viewBoxWidth/2+worldCenterXS,shapeSvgCenterYL=viewBoxHeight/2-worldCenterYS}}catch(eEstimate){}if(null!==shapeSvgCenterXL&&null!==shapeSvgCenterYL){var offsetCavXL=gradCenterX-shapeSvgCenterXL,offsetCavYL=-(gradCenterY-shapeSvgCenterYL);try{api.set(shaderId,{"generator.offset.x":offsetCavXL,"generator.offset.y":offsetCavYL})}catch(eOffL){}}var scaleL=gradientLength/Math.max(shapeWidthL,shapeHeightL);try{api.set(shaderId,{"generator.scale":scaleL})}catch(eScaleL){}}}}catch(eLinearStroke){console.warn("[LINEAR GRADIENT STROKE] Error: "+eLinearStroke.message)}try{var gradientDataR=null;if(__svgGradientMap&&__svgGradientCache)for(var gidR in __svgGradientCache)if(__svgGradientCache[gidR]===shaderId){gradientDataR=__svgGradientMap[gidR];break}if(gradientDataR&&"radial"===gradientDataR.type&&gradientDataR.transform){var shapeBboxR=api.getBoundingBox(shapeId,!1);if(shapeBboxR&&shapeBboxR.width>0&&shapeBboxR.height>0){var shapeWidthR=shapeBboxR.width,shapeHeightR=shapeBboxR.height,matrixR=parseTransformMatrixList(gradientDataR.transform),aR=matrixR.a,bR=matrixR.b,cR=matrixR.c,dR=matrixR.d,eR=matrixR.e||0,fR=matrixR.f||0;if((Math.abs(aR)>2||Math.abs(bR)>2||Math.abs(cR)>2||Math.abs(dR)>2||Math.abs(eR)>2||Math.abs(fR)>2)&&"userSpaceOnUse"===gradientDataR.gradientUnits){var colXLengthR=Math.sqrt(aR*aR+bR*bR),colYLengthR=Math.sqrt(cR*cR+dR*dR),scaleXR=colXLengthR/(shapeWidthR/2)*100,scaleYR=colYLengthR/(shapeHeightR/2)*100;try{api.set(shaderId,{"generator.radiusRatio":1})}catch(eRRR){}try{api.set(shaderId,{"generator.scale.x":scaleXR,"generator.scale.y":scaleYR})}catch(eScaleR){}var rotationDegR=-Math.atan2(bR,aR)*(180/Math.PI);try{api.set(shaderId,{"generator.rotation":rotationDegR})}catch(eRotR){}var gradCenterXR=eR,gradCenterYR=fR,shapeSvgCenterXR=null,shapeSvgCenterYR=null;if(svgShapeCenter&&void 0!==svgShapeCenter.x&&void 0!==svgShapeCenter.y)shapeSvgCenterXR=svgShapeCenter.x,shapeSvgCenterYR=svgShapeCenter.y;else try{var shapeBboxWorldR=api.getBoundingBox(shapeId,!0),viewBoxWidthR=__svgViewBox&&__svgViewBox.width||1080,viewBoxHeightR=__svgViewBox&&__svgViewBox.height||1080;if(shapeBboxWorldR&&shapeBboxWorldR.width>0&&shapeBboxWorldR.height>0){var worldCenterXR=shapeBboxWorldR.x+shapeBboxWorldR.width/2,worldCenterYR=shapeBboxWorldR.y+shapeBboxWorldR.height/2;shapeSvgCenterXR=viewBoxWidthR/2+worldCenterXR,shapeSvgCenterYR=viewBoxHeightR/2-worldCenterYR}}catch(eEstR){}if(null!==shapeSvgCenterXR&&null!==shapeSvgCenterYR){var offsetCavXR=gradCenterXR-shapeSvgCenterXR,offsetCavYR=-(gradCenterYR-shapeSvgCenterYR);try{api.set(shaderId,{"generator.offset.x":offsetCavXR,"generator.offset.y":offsetCavYR})}catch(eOffR){}}}}}}catch(eRadialStroke){console.warn("[RADIAL GRADIENT STROKE] Error: "+eRadialStroke.message)}try{var currentParent=null;try{currentParent=api.getParent(shaderId)}catch(ePar){currentParent=null}currentParent||api.parent(shaderId,shapeId)}catch(ePar2){}return!0}catch(e1){}return!1}
// quiver_utilities_blendmode.js
var BLEND_MODE_MAP=[["normal",0],["multiply",24],["screen",14],["overlay",15],["darken",16],["lighten",17],["color-dodge",18],["color-burn",19],["hard-light",20],["soft-light",21],["difference",22],["exclusion",23],["hue",25],["saturation",26],["color",27],["luminosity",28],["plus-lighter",12],["plus",12],["alpha-add",30],["plus-darker",32]];function svgBlendModeToCavalryEnum(svgMode){if(!svgMode)return null;for(var normalized=(""+svgMode).toLowerCase().trim(),i=0;i<BLEND_MODE_MAP.length;i++)if(BLEND_MODE_MAP[i][0]===normalized)return BLEND_MODE_MAP[i][1];return null}function applyBlendMode(layerId,attrs){if(layerId&&attrs)try{var blendMode=attrs["mix-blend-mode"]||attrs.style&&extractStyleProperty(attrs.style,"mix-blend-mode");if(!blendMode||"normal"===blendMode)return;var enumValue=svgBlendModeToCavalryEnum(blendMode);if(null!==enumValue&&0!==enumValue)try{api.set(layerId,{blendMode:enumValue})}catch(eSet){}}catch(e){}}
// quiver_utilities_gradient.js
function setGradientContext(map){__svgGradientMap=map||{},__svgGradientCache={}}function getGradientShader(gradientId){if(!gradientId)return null;if(__svgGradientCache[gradientId])return __svgGradientCache[gradientId];var data=__svgGradientMap[gradientId];if(!data)return null;try{void 0!==data._absoluteCenterX||data._absoluteCenterY}catch(e){}var sh=createGradientShader(data);return sh&&(__svgGradientCache[gradientId]=sh),sh}function _gradGetAttr(element,name){var match=new RegExp(name+"\\s*=\\s*[\"']([^\"']*)[\"']").exec(element);return match?match[1]:null}function colorWithOpacity(hexColor,opacity){var baseColor=hexColor;baseColor&&"#"===baseColor[0]||(baseColor="#000000");var h=baseColor.replace("#","");3===h.length?h=h[0]+h[0]+h[1]+h[1]+h[2]+h[2]:8===h.length&&6!==(h=h.slice(2)).length&&(h=h.slice(0,6)),6!==h.length&&(h="000000");var opVal="number"!=typeof opacity||isNaN(opacity)?1:opacity,a=Math.max(0,Math.min(1,opVal));return"#"+Math.round(255*a).toString(16).padStart(2,"0").toUpperCase()+h.toUpperCase()}function parseGradientStops(gradientElement){for(var match,stops=[],stopRegex=/<stop[^>]*>/g;null!==(match=stopRegex.exec(gradientElement));){var stopElement=match[0],offset=_gradGetAttr(stopElement,"offset"),stopColor=_gradGetAttr(stopElement,"stop-color"),stopOpacity=_gradGetAttr(stopElement,"stop-opacity");if(!stopColor||!stopOpacity){var styleAttr=_gradGetAttr(stopElement,"style");styleAttr&&(stopColor||(stopColor=extractStyleProperty(styleAttr,"stop-color")),stopOpacity||(stopOpacity=extractStyleProperty(styleAttr,"stop-opacity")))}var offsetNum=0;offset&&(offsetNum=-1!==offset.indexOf("%")?parseFloat(offset)/100:parseFloat(offset),isNaN(offsetNum)&&(offsetNum=0));var opacity=stopOpacity?parseFloat(stopOpacity):1;isNaN(opacity)&&(opacity=1),stops.push({offset:Math.max(0,Math.min(1,offsetNum)),color:parseColor(stopColor),opacity:opacity})}return stops.sort(function(a,b){return a.offset-b.offset}),stops}function extractGradients(svgCode){for(var m,gradients=[],linearRegex=/<linearGradient[^>]*>[\s\S]*?<\/linearGradient>/g;null!==(m=linearRegex.exec(svgCode));){var el=m[0],id=_gradGetAttr(el,"id"),gradientUnits=_gradGetAttr(el,"gradientUnits")||"objectBoundingBox",x1=parseFloat(_gradGetAttr(el,"x1")||"0"),y1=parseFloat(_gradGetAttr(el,"y1")||"0"),x2=parseFloat(_gradGetAttr(el,"x2")||"1"),y2=parseFloat(_gradGetAttr(el,"y2")||"0"),transform=_gradGetAttr(el,"gradientTransform"),stops=parseGradientStops(el);if(stops.length>0){var grad={type:"linear",id:id||"linear_"+gradients.length,x1:x1,y1:y1,x2:x2,y2:y2,stops:stops,gradientUnits:gradientUnits};transform&&(grad.transform=transform),"userSpaceOnUse"===gradientUnits&&(grad._absoluteCenterX=(x1+x2)/2,grad._absoluteCenterY=(y1+y2)/2,grad._isAbsoluteCoords=!0),gradients.push(grad)}}for(var radialRegex=/<radialGradient[^>]*>[\s\S]*?<\/radialGradient>/g;null!==(m=radialRegex.exec(svgCode));){var el2=m[0],id2=_gradGetAttr(el2,"id"),defaultVal="userSpaceOnUse"===(gradientUnits=_gradGetAttr(el2,"gradientUnits")||"objectBoundingBox")?"0":"0.5",cx=parseFloat(_gradGetAttr(el2,"cx")||defaultVal),cy=parseFloat(_gradGetAttr(el2,"cy")||defaultVal),r=parseFloat(_gradGetAttr(el2,"r")||defaultVal),fx=_gradGetAttr(el2,"fx"),fy=_gradGetAttr(el2,"fy");fx=null!==fx?parseFloat(fx):cx,fy=null!==fy?parseFloat(fy):cy;var transform2=_gradGetAttr(el2,"gradientTransform"),stops2=parseGradientStops(el2);if(stops2.length>0){var grad2={type:"radial",id:id2||"radial_"+gradients.length,cx:cx,cy:cy,r:r,fx:fx,fy:fy,stops:stops2,gradientUnits:gradientUnits};transform2&&(grad2.transform=transform2),gradients.push(grad2)}}return gradients}function createGradientShader(gradientData){try{if(!importGradientsEnabled)return null;var gradTypeName="radial"===gradientData.type?"Radial":"Linear",firstStop=gradientData.stops&&gradientData.stops[0],lastStop=gradientData.stops&&gradientData.stops[gradientData.stops.length-1],gradientName=gradTypeName+" "+(firstStop&&firstStop.color?firstStop.color.toUpperCase():"")+" ‚Üí "+(lastStop&&lastStop.color?lastStop.color.toUpperCase():""),shaderId=api.create("gradientShader",gradientName);if("radial"===gradientData.type)try{api.setGenerator(shaderId,"generator","radialGradientShader")}catch(e){}else try{api.setGenerator(shaderId,"generator","linearGradientShader")}catch(e){}if("radial"===gradientData.type){try{api.set(shaderId,{"generator.radiusMode":1})}catch(eRM){console.warn("[RADIAL GRADIENT] Could not set radiusMode: "+eRM.message)}if(gradientData.transform)try{var a=(matrix=parseTransformMatrixList(gradientData.transform)).a,b=matrix.b,c=matrix.c,d=matrix.d,norm1Sq=a*a+b*b,norm2Sq=c*c+d*d,dotProd=a*c+b*d,sum=norm1Sq+norm2Sq,diff=norm1Sq-norm2Sq,discriminant=Math.sqrt(diff*diff+4*dotProd*dotProd),sigma1Sq=(sum+discriminant)/2,sigma2Sq=(sum-discriminant)/2,sigma1=Math.sqrt(Math.max(0,sigma1Sq)),sigma2=Math.sqrt(Math.max(0,sigma2Sq)),isAbsoluteCoords=Math.abs(a)>2||Math.abs(b)>2||Math.abs(c)>2||Math.abs(d)>2;if(isAbsoluteCoords&&"userSpaceOnUse"===gradientData.gradientUnits)api.set(shaderId,{"generator.radiusRatio":1});else{var radiusRatio=1;sigma2>1e-4&&(radiusRatio=sigma1/sigma2),radiusRatio=Math.max(.01,Math.min(100,radiusRatio)),api.set(shaderId,{"generator.radiusRatio":radiusRatio})}__svgGradientMap&&__svgGradientMap[gradientData.id]&&(__svgGradientMap[gradientData.id]._svdSigma1=sigma1,__svgGradientMap[gradientData.id]._svdSigma2=sigma2,__svgGradientMap[gradientData.id]._isAbsoluteCoords=isAbsoluteCoords)}catch(eRR){console.warn("[RADIAL GRADIENT] Could not process transform: "+eRR.message)}var calculatedRadius=null;if(void 0!==gradientData.r&&"userSpaceOnUse"===gradientData.gradientUnits)if(gradientData.transform)try{var decomposed=decomposeMatrix(matrix=parseTransformMatrixList(gradientData.transform)),avgScale=((scaleX=Math.abs(decomposed.scaleX))+(scaleY=Math.abs(decomposed.scaleY)))/2;calculatedRadius=gradientData.r*avgScale}catch(eT){calculatedRadius=gradientData.r}else calculatedRadius=gradientData.r;if("radial"===gradientData.type){try{void 0!==gradientData._absoluteCenterX||gradientData._absoluteCenterY}catch(e0){}try{var offsetX,offsetY;if("userSpaceOnUse"===gradientData.gradientUnits){if(offsetX=void 0!==gradientData.cx?parseFloat(gradientData.cx):0,offsetY=void 0!==gradientData.cy?parseFloat(gradientData.cy):0,gradientData.transform)try{decomposed=decomposeMatrix(matrix=parseTransformMatrixList(gradientData.transform));var translateX=parseFloat(decomposed.translateX)||0,translateY=parseFloat(decomposed.translateY)||0;offsetX+=translateX,offsetY+=translateY}catch(eT){}if(__svgGradientMap&&__svgGradientMap[gradientData.id]){var absX=parseFloat(offsetX),absY=parseFloat(offsetY);isNaN(absX)||isNaN(absY)||(__svgGradientMap[gradientData.id]._absoluteCenterX=absX,__svgGradientMap[gradientData.id]._absoluteCenterY=absY,__svgGradientMap[gradientData.id]._gradientUnits=gradientData.gradientUnits,gradientData._absoluteCenterX=absX,gradientData._absoluteCenterY=absY)}offsetX=0,offsetY=0}else offsetX=2*(gradientData.cx-.5),offsetY=2*(gradientData.cy-.5),offsetX=Math.max(-2,Math.min(2,offsetX)),offsetY=Math.max(-2,Math.min(2,offsetY));try{api.set(shaderId,{"generator.offset.x":offsetX,"generator.offset.y":offsetY});try{api.get(shaderId,"generator.offset.x"),api.get(shaderId,"generator.offset.y")}catch(eGet){}}catch(eXY){try{api.set(shaderId,{"generator.offset":[offsetX,offsetY]})}catch(eArr){}}try{var currentRadius=api.get(shaderId,"generator.radius");api.set(shaderId,{"generator.radius":currentRadius})}catch(eUpdate){}}catch(eOff){}}if(void 0!==gradientData.r)try{if("userSpaceOnUse"===gradientData.gradientUnits){var radius=calculatedRadius||gradientData.r;try{api.set(shaderId,{"generator.radius":radius})}catch(eRad){}try{api.set(shaderId,{"generator.scale.x":100,"generator.scale.y":100})}catch(eResetScale){}if(gradientData.transform)try{decomposed=decomposeMatrix(matrix=parseTransformMatrixList(gradientData.transform));var scaleX=Math.abs(decomposed.scaleX),scaleY=Math.abs(decomposed.scaleY);Math.abs(scaleX-scaleY)}catch(eT){}}else{var scale=gradientData.r/.5;if(scale>5&&(scale=2),scale=parseFloat(scale.toFixed(2)),Math.abs(scale-1)>.01)try{api.set(shaderId,{"generator.scale.x":scale,"generator.scale.y":scale})}catch(eXY){try{api.set(shaderId,{"generator.scale":[scale,scale]})}catch(eArr){try{api.set(shaderId,{"generator.scale":scale})}catch(eSingle){}}}}}catch(eScale){}}var angle=0;if("linear"===gradientData.type){var dx=gradientData.x2-gradientData.x1,dy=gradientData.y2-gradientData.y1;angle=(180*Math.atan2(-dy,dx)/Math.PI%360+360)%360,api.set(shaderId,{"generator.rotation":angle})}if(gradientData.transform)try{var matrix;decomposed=decomposeMatrix(matrix=parseTransformMatrixList(gradientData.transform));if(Math.abs(decomposed.rotationDeg)>1e-4){var cavalryRotation=-decomposed.rotationDeg;api.set(shaderId,{"generator.rotation":cavalryRotation})}if(Math.abs(decomposed.scaleX-1)>1e-4||Math.abs(decomposed.scaleY-1)>1e-4){scaleX=decomposed.scaleX,scaleY=decomposed.scaleY;if("userSpaceOnUse"===gradientData.gradientUnits&&"radial"===gradientData.type);else if("userSpaceOnUse"===gradientData.gradientUnits);else{(avgScale=(scaleX+scaleY)/2)>5&&(avgScale=5),avgScale=parseFloat(avgScale.toFixed(2));try{api.set(shaderId,{"generator.scale":[scaleX,scaleY]})}catch(eArr){try{api.set(shaderId,{"generator.scale.x":scaleX,"generator.scale.y":scaleY})}catch(eXY){try{api.set(shaderId,{"generator.scale":avgScale})}catch(eSingle){}}}}}}catch(e){}var colors=gradientData.stops.map(function(stop){return stop.color||"#000000"});1===colors.length&&colors.push(colors[0]),api.setGradientFromColors(shaderId,"generator.gradient",colors);for(var i=0;i<gradientData.stops.length;i++){var stop=gradientData.stops[i];try{var posAttr={};posAttr["generator.gradient."+i+".position"]=stop.offset,api.set(shaderId,posAttr)}catch(ePos){}try{var colorWithAlpha=colorWithOpacity(stop.color,stop.opacity),colAttr={};colAttr["generator.gradient."+i+".color"]=colorWithAlpha,api.set(shaderId,colAttr)}catch(eCol){}}return shaderId}catch(e){return null}}function createSweepGradientFromFigma(figmaGradData,layerId,attrs){try{if(void 0!==importGradientsEnabled&&!importGradientsEnabled)return null;var stops=figmaGradData.stops||figmaGradData.stopsVar||[];if(0===stops.length)return console.warn("[SWEEP GRADIENT] No stops found in Figma gradient data"),null;var firstStop=stops[0],lastStop=stops[stops.length-1],gradientName="Sweep "+figmaRgbaToHex(firstStop.color)+" ‚Üí "+figmaRgbaToHex(lastStop.color),shaderId=api.create("gradientShader",gradientName);try{api.setGenerator(shaderId,"generator","sweepGradientShader")}catch(eGen){console.warn("[SWEEP GRADIENT] Could not set sweepGradientShader: "+eGen.message)}try{api.set(shaderId,{"generator.wrapUVs":!0})}catch(eWrap){console.warn("[SWEEP GRADIENT] Could not set wrapUVs: "+eWrap.message)}for(var invertedStops=[],i=0;i<stops.length;i++){var stop=stops[i],invertedPos=0===stop.position?0:1-stop.position;invertedStops.push({position:invertedPos,color:stop.color})}invertedStops.sort(function(a,b){return a.position-b.position});var startColor=invertedStops[0].color;invertedStops.push({position:1,color:startColor});for(var colors=[],ic=0;ic<invertedStops.length;ic++)colors.push(figmaRgbaToHex(invertedStops[ic].color));1===colors.length&&colors.push(colors[0]),api.setGradientFromColors(shaderId,"generator.gradient",colors);for(var si=0;si<invertedStops.length;si++){var stopData=invertedStops[si];invertedStops.length;try{var posAttr={};posAttr["generator.gradient."+si+".position"]=stopData.position,api.set(shaderId,posAttr)}catch(ePos){}try{var colorWithAlphaValue=figmaRgbaToHexWithAlpha(stopData.color),colAttr={};colAttr["generator.gradient."+si+".color"]=colorWithAlphaValue,api.set(shaderId,colAttr)}catch(eCol){}}if(figmaGradData.transform)try{var t=figmaGradData.transform,gradientRotationDeg=Math.atan2(t.m10,t.m00)*(180/Math.PI),shapeRotationDeg=0;attrs&&(void 0!==attrs._rotationDeg?shapeRotationDeg=attrs._rotationDeg:attrs.transform&&(shapeRotationDeg=getRotationDegFromTransform(attrs.transform)));var cavalryRotation=-(gradientRotationDeg-shapeRotationDeg)-90;cavalryRotation=(cavalryRotation%360+360)%360,api.set(shaderId,{"generator.rotation":cavalryRotation})}catch(eRot){console.warn("[SWEEP GRADIENT] Error applying rotation: "+eRot.message)}if(void 0!==figmaGradData.opacity&&figmaGradData.opacity<1){var alphaPercent=Math.round(100*figmaGradData.opacity);try{api.set(shaderId,{alpha:alphaPercent})}catch(eAlpha){}}try{api.setFill(layerId,!0),api.set(layerId,{"material.materialColor.a":0}),api.set(layerId,{"material.alpha":100}),api.connect(shaderId,"id",layerId,"material.colorShaders");try{api.parent(shaderId,layerId)}catch(ePar){}}catch(eConnect){console.error("[SWEEP GRADIENT] Failed to connect shader: "+eConnect.message)}return shaderId}catch(e){return console.error("[SWEEP GRADIENT] Error creating sweep gradient: "+e.message),null}}function createDiamondGradientFromFigma(figmaGradData,layerId,attrs){try{if(void 0!==importGradientsEnabled&&!importGradientsEnabled)return null;var stops=figmaGradData.stops||figmaGradData.stopsVar||[];if(0===stops.length)return console.warn("[DIAMOND GRADIENT] No stops found in Figma gradient data"),null;var firstStop=stops[0],lastStop=stops[stops.length-1],gradientName="Diamond "+figmaRgbaToHex(firstStop.color)+" ‚Üí "+figmaRgbaToHex(lastStop.color),shaderId=api.create("gradientShader",gradientName);try{api.setGenerator(shaderId,"generator","shapeGradientShader")}catch(eGen){console.warn("[DIAMOND GRADIENT] Could not set shapeGradientShader: "+eGen.message);try{api.setGenerator(shaderId,"generator","radialGradientShader")}catch(eFallback){console.warn("[DIAMOND GRADIENT] Could not set radial fallback: "+eFallback.message)}}try{api.set(shaderId,{"generator.sides":4})}catch(eSides){console.warn("[DIAMOND GRADIENT] Could not set sides: "+eSides.message)}try{api.set(shaderId,{"generator.rotation":45})}catch(eInitRot){console.warn("[DIAMOND GRADIENT] Could not set initial rotation: "+eInitRot.message)}for(var colors=[],ic=0;ic<stops.length;ic++)colors.push(figmaRgbaToHex(stops[ic].color));1===colors.length&&colors.push(colors[0]),api.setGradientFromColors(shaderId,"generator.gradient",colors);for(var si=0;si<stops.length;si++){var stopData=stops[si];try{var posAttr={};posAttr["generator.gradient."+si+".position"]=stopData.position,api.set(shaderId,posAttr)}catch(ePos){}try{var colorWithAlphaValue=figmaRgbaToHexWithAlpha(stopData.color),colAttr={};colAttr["generator.gradient."+si+".color"]=colorWithAlphaValue,api.set(shaderId,colAttr)}catch(eCol){}}if(figmaGradData.transform)try{var t=figmaGradData.transform,gradientRotationDeg=Math.atan2(t.m10,t.m00)*(180/Math.PI),shapeRotationDeg=0;attrs&&(void 0!==attrs._rotationDeg?shapeRotationDeg=attrs._rotationDeg:attrs.transform&&(shapeRotationDeg=getRotationDegFromTransform(attrs.transform)));var cavalryRotation=45-(gradientRotationDeg-shapeRotationDeg);cavalryRotation=(cavalryRotation%360+360)%360,api.set(shaderId,{"generator.rotation":cavalryRotation})}catch(eRot){console.warn("[DIAMOND GRADIENT] Error applying rotation: "+eRot.message)}try{api.set(shaderId,{tiling:2})}catch(eTiling){console.warn("[DIAMOND GRADIENT] Could not set tiling: "+eTiling.message)}if(void 0!==figmaGradData.opacity&&figmaGradData.opacity<1){var alphaPercent=Math.round(100*figmaGradData.opacity);try{api.set(shaderId,{alpha:alphaPercent})}catch(eAlpha){}}try{api.setFill(layerId,!0),api.set(layerId,{"material.materialColor.a":0}),api.set(layerId,{"material.alpha":100}),api.connect(shaderId,"id",layerId,"material.colorShaders");try{api.parent(shaderId,layerId)}catch(ePar){}}catch(eConnect){console.error("[DIAMOND GRADIENT] Failed to connect shader: "+eConnect.message)}return shaderId}catch(e){return console.error("[DIAMOND GRADIENT] Error creating diamond gradient: "+e.message),null}}function figmaRgbaToHex(color){if(!color)return"#000000";var r=Math.round(255*(color.r||0)).toString(16).padStart(2,"0"),g=Math.round(255*(color.g||0)).toString(16).padStart(2,"0"),b=Math.round(255*(color.b||0)).toString(16).padStart(2,"0");return"#"+r.toUpperCase()+g.toUpperCase()+b.toUpperCase()}function figmaRgbaToHexWithAlpha(color){if(!color)return"#FF000000";var a=Math.round(255*(void 0!==color.a?color.a:1)).toString(16).padStart(2,"0"),r=Math.round(255*(color.r||0)).toString(16).padStart(2,"0"),g=Math.round(255*(color.g||0)).toString(16).padStart(2,"0"),b=Math.round(255*(color.b||0)).toString(16).padStart(2,"0");return"#"+a.toUpperCase()+r.toUpperCase()+g.toUpperCase()+b.toUpperCase()}
// quiver_utilities_patterns.js
function parseMatrixTransform(transformStr){if(!transformStr)return null;var matrixMatch=/matrix\s*\(\s*([^,\s]+)[\s,]+([^,\s]+)[\s,]+([^,\s]+)[\s,]+([^,\s]+)[\s,]+([^,\s]+)[\s,]+([^,\s]+)\s*\)/.exec(transformStr);if(matrixMatch)return{a:parseFloat(matrixMatch[1])||0,b:parseFloat(matrixMatch[2])||0,c:parseFloat(matrixMatch[3])||0,d:parseFloat(matrixMatch[4])||0,e:parseFloat(matrixMatch[5])||0,f:parseFloat(matrixMatch[6])||0};var scaleMatch=/scale\s*\(\s*([^,\s\)]+)(?:[\s,]+([^,\s\)]+))?\s*\)/.exec(transformStr);if(scaleMatch){var sx=parseFloat(scaleMatch[1])||1;return{a:sx,b:0,c:0,d:scaleMatch[2]?parseFloat(scaleMatch[2]):sx,e:0,f:0}}return null}function extractPatterns(svgCode){var patterns={};try{for(var m,re=/<pattern[^>]*id=["']([^"']+)["'][^>]*>([\s\S]*?)<\/pattern>/g;null!==(m=re.exec(svgCode));){for(var pid=m[1],body=m[2]||"",open=m[0].slice(0,m[0].indexOf(">")+1),attrs={},keys=["x","y","width","height","patternUnits","patternContentUnits","patternTransform"],i=0;i<keys.length;i++){var kk=keys[i],vv=extractAttribute(open,kk);null!==vv&&(attrs[kk]=vv)}var im=/<image[^>]*>/i.exec(body),image=null,useTransform=null;if(im){var imgOpen=im[0],href=extractAttribute(imgOpen,"href")||extractAttribute(imgOpen,"xlink:href"),ix=extractAttribute(imgOpen,"x"),iy=extractAttribute(imgOpen,"y"),iw=extractAttribute(imgOpen,"width"),ih=extractAttribute(imgOpen,"height"),imgTransform=extractAttribute(imgOpen,"transform");image={href:href||"",x:ix||"0",y:iy||"0",width:iw||attrs.width||"0",height:ih||attrs.height||"0"},imgTransform&&(useTransform=parseMatrixTransform(imgTransform))}if(!image){var useMatch=/<use[^>]*>/gi.exec(body);if(useMatch){var useOpen=useMatch[0],hrefUse=extractAttribute(useOpen,"href")||extractAttribute(useOpen,"xlink:href"),useTransformStr=extractAttribute(useOpen,"transform");if(useTransformStr&&(useTransform=parseMatrixTransform(useTransformStr)),hrefUse&&"#"===hrefUse.charAt(0)){var refId=hrefUse.slice(1);try{var esc=refId.replace(/[.*+?^${}()|[\]\\]/g,"\\$&"),mImg=new RegExp("<image[^>]*id=[\"']"+esc+"[\"'][^>]*>","i").exec(svgCode);if(mImg){var imgOpen2=mImg[0],href2=extractAttribute(imgOpen2,"href")||extractAttribute(imgOpen2,"xlink:href"),iw2=extractAttribute(imgOpen2,"width"),ih2=extractAttribute(imgOpen2,"height");image={href:href2||"",x:"0",y:"0",width:iw2||attrs.width||"0",height:ih2||attrs.height||"0"}}}catch(eFind){}}}}patterns[pid]={attrs:attrs,image:image,useTransform:useTransform}}}catch(e){}return patterns}
// quiver_utilities_images.js
var __quiverAssetGroupId=null;// Cache for the Quiver asset group in Assets Window
function _ensureQuiverAssetGroup(){try{
// Check if we already have the Quiver asset group
if(__quiverAssetGroupId&&api.layerExists&&api.layerExists(__quiverAssetGroupId))return __quiverAssetGroupId;
// Try to find existing Quiver asset group by checking all assets
var assetLayers=[];try{assetLayers=api.getAssetWindowLayers&&api.getAssetWindowLayers(!1)||[]}catch(e){}for(var i=0;i<assetLayers.length;i++){var assetId=assetLayers[i],assetName="";try{assetName=api.getNiceName(assetId)||""}catch(e){}if("Quiver"===assetName)return __quiverAssetGroupId=assetId}try{return api.createAssetGroup?__quiverAssetGroupId=api.createAssetGroup("Quiver"):null}catch(eCreate){return null}}catch(e){
// Error ensuring Quiver asset group
return null}}function _ensureAssetsQuiverFolder(){try{if(__imageImportCache.__quiverDir)return __imageImportCache.__quiverDir;var assetsPath=null;try{assetsPath=api.getAssetPath&&api.getAssetPath()||null}catch(eAP){assetsPath=null}if(assetsPath){var quiverInAssets=assetsPath+"/Quiver",finalAssets=assetsPath,folderExists=!1;try{folderExists=api.filePathExists&&api.filePathExists(quiverInAssets)}catch(e){}if(folderExists)finalAssets=quiverInAssets;else{var folderCreated=!1;try{api.ensureDirectory?(api.ensureDirectory(quiverInAssets,!1,!0),finalAssets=quiverInAssets,folderCreated=!0):api.makeFolder?(api.makeFolder(quiverInAssets),finalAssets=quiverInAssets,folderCreated=!0):api.createDirectory&&(api.createDirectory(quiverInAssets),finalAssets=quiverInAssets,folderCreated=!0)}catch(eMkFA){-1!==(eMkFA+"").indexOf("already exists")&&(finalAssets=quiverInAssets)}}if(!folderCreated&&api.runProcess)try{api.getPlatform&&"Windows"===api.getPlatform()?api.runProcess("cmd",["/c","mkdir",quiverInAssets.replace(/\//g,"\\")]):api.runProcess("mkdir",["-p",quiverInAssets]),finalAssets=quiverInAssets,folderCreated=!0}catch(eCmd){
// Could not create Quiver folder with system command
}return __imageImportCache.__quiverDir=finalAssets,__imageImportCache.__quiverDir}var projPath=null;try{projPath=api.getProjectFilePath&&api.getProjectFilePath()||projPath}catch(eProj){}try{projPath=projPath||api.getProjectPath&&api.getProjectPath()}catch(eProj2){}try{projPath=projPath||api.projectPath&&api.projectPath()}catch(eProj3){}try{projPath=projPath||api.getProjectDirectory&&api.getProjectDirectory()}catch(eProj4){}try{projPath=projPath||api.projectDirectory&&api.projectDirectory()}catch(eProj5){}var baseDir=null;if(projPath&&-1!==(projPath+"").indexOf("/")){var pstr=projPath+"";baseDir=/\.cv$/i.test(pstr)?pstr.substring(0,pstr.lastIndexOf("/")):pstr}if(!baseDir)try{baseDir=ui.selectDirectory&&ui.selectDirectory("Select your Cavalry Project folder (to create Assets/Quiver)")}catch(eSel){baseDir=null}if(!baseDir)return null;var assetsDir=baseDir+"/Assets",quiverDir=assetsDir+"/Quiver",finalDir=null;try{api.ensureDirectory?(api.ensureDirectory(assetsDir),finalDir=assetsDir):api.makeFolder?(api.makeFolder(assetsDir),finalDir=assetsDir):api.createDirectory&&(api.createDirectory(assetsDir),finalDir=assetsDir)}catch(eMkA){finalDir=null}
// Try Quiver subfolder; if it fails, keep using Assets root
folderExists=!1;try{folderExists=api.filePathExists&&api.filePathExists(quiverDir)}catch(e){}if(folderExists)finalDir=quiverDir;else{folderCreated=!1;try{api.ensureDirectory?(api.ensureDirectory(quiverDir,!1,!0),finalDir=quiverDir,folderCreated=!0):api.makeFolder?(api.makeFolder(quiverDir),finalDir=quiverDir,folderCreated=!0):api.createDirectory&&(api.createDirectory(quiverDir),finalDir=quiverDir,folderCreated=!0)}catch(eMkF){-1!==(eMkF+"").indexOf("already exists")&&(finalDir=quiverDir)}}if(!folderCreated&&api.runProcess)try{api.getPlatform&&"Windows"===api.getPlatform()?api.runProcess("cmd",["/c","mkdir",quiverDir.replace(/\//g,"\\")]):api.runProcess("mkdir",["-p",quiverDir]),finalDir=quiverDir,folderCreated=!0}catch(eCmd){
// Could not create Quiver folder with system command
}return __imageImportCache.__quiverDir=finalDir||assetsDir,__imageImportCache.__quiverDir}catch(e){return null}}function _hashString(s){for(var h=2166136261,i=0;i<s.length;i++)h=(h^=s.charCodeAt(i))+((h<<1)+(h<<4)+(h<<7)+(h<<8)+(h<<24))>>>0;return("00000000"+h.toString(16)).slice(-8)}function _saveDataUriToQuiverFolder(dataUri,contextNode){try{if(__imageImportCache[dataUri])return __imageImportCache[dataUri];var m=/^data:([^;]+);base64,(.*)$/i.exec(dataUri);if(!m)return null;var mime=m[1].toLowerCase(),b64=m[2],ext="bin";-1!==mime.indexOf("png")?ext="png":-1!==mime.indexOf("jpeg")||-1!==mime.indexOf("jpg")?ext="jpg":-1!==mime.indexOf("svg")?ext="svg":-1!==mime.indexOf("webp")&&(ext="webp");var dir=_ensureAssetsQuiverFolder();if(!dir){try{var suggest="img_"+_hashString(dataUri.slice(0,120)+"|"+dataUri.length)+"."+ext,saveFn=ui.saveFile||ui.saveFileDialog||ui.selectSaveFile;if(saveFn){var picked=saveFn("Save embedded image as...",suggest);if(picked){var wroteP=!1;try{api.writeEncodedToBinaryFile&&(wroteP=!!api.writeEncodedToBinaryFile(picked,b64))}catch(eW0){wroteP=!1}if(!wroteP)try{api.writeFile&&(api.writeFile(picked,b64,{encoding:"base64"}),wroteP=!0)}catch(eW1){wroteP=!1}if(wroteP)return __imageImportCache[dataUri]=picked,picked}}}catch(eDlg){}
// No Assets/Quiver dir available and user did not pick a path
return null}_hashString(dataUri.slice(0,120)+"|"+dataUri.length);__imageCounter++;var baseName=__lastPatternOrImageName||"img";contextNode&&contextNode.attrs&&contextNode.attrs.id&&(baseName=contextNode.attrs.id);var base=_sanitizeFileComponent(baseName),uniqueName=base;/_\d+$/.test(base)||(uniqueName=base+"_"+__imageCounter);var outPath=dir+"/"+uniqueName+"."+ext,wrote=!1;try{api.writeEncodedToBinaryFile&&(wrote=!!api.writeEncodedToBinaryFile(outPath,b64))}catch(eEnc){wrote=!1}if(!wrote)try{api.writeFile&&(api.writeFile(outPath,b64,{encoding:"base64"}),wrote=!0)}catch(eWF){wrote=!1}return wrote?(__imageImportCache[dataUri]=outPath,outPath):null}catch(e){return null}}function _copyExternalToQuiverFolder(srcPath){try{if(__imageImportCache[srcPath])return __imageImportCache[srcPath];var dir=_ensureAssetsQuiverFolder();if(!dir)return null;var dest=dir+"/"+srcPath.substring(srcPath.lastIndexOf("/")+1);try{api.copyFile&&api.copyFile(srcPath,dest)}catch(eC){return null}return __imageImportCache[srcPath]=dest,dest}catch(e){return null}}function _resolveImageHrefToAsset(href,contextNode){return href&&importImageryEnabled?/^data:/i.test(href)?_saveDataUriToQuiverFolder(href,contextNode):/^file:\/\//i.test(href)?_copyExternalToQuiverFolder(href.replace(/^file:\/\//i,"")):"/"===href[0]?_copyExternalToQuiverFolder(href):null:null}function createImage(node,parentId,vb){if(!importImageryEnabled)return null;var name=node.name||"image",parentName="";if(parentId)try{parentName=api.getNiceName(parentId)||"",__imageNamingContext.parentId=parentId,__imageNamingContext.parentName=parentName}catch(e){}var contextualName=parentName?parentName+"_image":name;try{__lastPatternOrImageName=contextualName}catch(eNm2){}for(var href=node.attrs&&(node.attrs.href||node.attrs["xlink:href"]),savedPath=_resolveImageHrefToAsset(href,node),x=parseFloat(node.attrs.x||"0"),y=parseFloat(node.attrs.y||"0"),w=parseFloat(node.attrs.width||"0"),h=parseFloat(node.attrs.height||"0"),centre=svgToCavalryPosition(x+w/2,y+h/2,vb),id=null,types=["image","bitmap","footage","imageShape","footageShape","imageLayer"],ti=0;ti<types.length&&!id;ti++)try{id=api.create(types[ti],name)}catch(eCT){id=null}var isPlaceholder=!1;id||(id=api.primitive("rectangle",name),isPlaceholder=!0),parentId&&api.parent(id,parentId);try{if(isPlaceholder)try{api.set(id,{"generator.dimensions":[w,h],"position.x":centre.x,"position.y":centre.y})}catch(eR){}else{try{api.set(id,{"position.x":centre.x,"position.y":centre.y})}catch(eP){}var sizeSet=!1;try{api.set(id,{dimensions:[w,h]}),sizeSet=!0}catch(eD0){}if(!sizeSet)try{api.set(id,{"generator.dimensions":[w,h]}),sizeSet=!0}catch(eD1){}}}catch(eSz){}try{if(!isPlaceholder){var setOk=!1,targetVal=savedPath||href||null,assetId=null;if(savedPath&&api.loadAsset)try{assetId=api.loadAsset(savedPath,!1)}catch(eLoad){assetId=null}if(!assetId&&savedPath&&api.importAsset)try{assetId=api.importAsset(savedPath)}catch(eImp){assetId=null}if(assetId){try{api.connect(assetId,"id",id,"image"),setOk=!0}catch(eConImg){setOk=!1}
// Parent the asset under the Quiver group in Assets Window
var quiverGroup=_ensureQuiverAssetGroup();if(quiverGroup&&api.parent)try{api.parent(assetId,quiverGroup)}catch(eParent){
// Could not parent asset to Quiver group
}}if(!setOk&&targetVal)setOk=!!_setFirstSupported(id,"string"==typeof targetVal&&0===targetVal.indexOf("data:")?["uri","image.uri","path","image.path","source","file"]:["path","image.path","source","file","uri","image.uri"],targetVal)}}catch(eLink){}try{var oNum=parseOpacityValue(node.attrs.opacity||node.attrs.style&&extractStyleProperty(node.attrs.style,"opacity"));null===oNum&&(oNum=1),api.set(id,{"material.alpha":Math.round(100*oNum)})}catch(eO){}return applyBlendMode(id,node.attrs),id}
// quiver_utilities_filters.js
var __targetToFilter={};function getFiltersForTarget(targetLayerId){return __targetToFilter[targetLayerId]||[]}function addFilterForTarget(targetLayerId,filterLayerId){__targetToFilter[targetLayerId]||(__targetToFilter[targetLayerId]=[]),-1===__targetToFilter[targetLayerId].indexOf(filterLayerId)&&__targetToFilter[targetLayerId].push(filterLayerId)}function resetFilterCache(){__targetToFilter={}}function extractFilters(svgCode){for(var m,filters={},re=/<filter[^>]*id=["']([^"']+)["'][^>]*>([\s\S]*?)<\/filter>/g;null!==(m=re.exec(svgCode));)filters[m[1]]=m[2];return filters}function detectBlurAmount(filterContent){if(!filterContent)return null;for(var floodMatch,hasDropShadow=/<feDropShadow[^>]*>/i.test(filterContent),hasOffset=/<feOffset[^>]*>/i.test(filterContent),hasColorMatrix=/<feColorMatrix[^>]*>/i.test(filterContent),hasMorphology=/<feMorphology[^>]*>/i.test(filterContent),hasVisibleFlood=!1,floodRe=/<feFlood[^>]*>/g;null!==(floodMatch=floodRe.exec(filterContent));){var floodOpacity=_gradGetAttr(floodMatch[0],"flood-opacity");if(!floodOpacity||parseFloat(floodOpacity)>0){hasVisibleFlood=!0;break}}if(hasDropShadow||hasOffset&&hasColorMatrix||hasMorphology||hasVisibleFlood)return null;var match=/<feGaussianBlur[^>]*stdDeviation\s*=\s*["']([^"']+)["'][^>]*>/g.exec(filterContent);if(match&&match[1]){if((filterContent.match(/<fe\w+[^>]*>/g)||[]).length>4)return null;var stdDev=parseFloat(match[1]);if(!isNaN(stdDev)&&stdDev>0)return 2*stdDev/3}return null}function createAndAttachBlur(shapeId,amount){try{if(!importEffectsEnabled)return null;var blurId=null;try{blurId=api.create("blurFilter","Blur")}catch(e0){try{blurId=api.create("blur","Blur")}catch(e00){}}if(!blurId)return null;try{api.set(blurId,{amount:[amount,amount]})}catch(eAmtV){try{api.set(blurId,{"amount.x":amount}),api.set(blurId,{"amount.y":amount})}catch(eAxy){}}try{api.connect(blurId,"id",shapeId,"filters"),addFilterForTarget(shapeId,blurId)}catch(eC){try{api.connect(blurId,"id",shapeId,"deformers")}catch(eC2){}}try{api.getParent(blurId)||api.parent(blurId,shapeId)}catch(eP){}return blurId}catch(e){return null}}function detectShadowPasses(filterContent){if(!filterContent)return[];for(var ds,passes=[],dropRe=/<feDropShadow[^>]*>/g;null!==(ds=dropRe.exec(filterContent));){var el=ds[0],dx=parseFloat(_gradGetAttr(el,"dx")||"0"),dy=parseFloat(_gradGetAttr(el,"dy")||"0"),stdDev=parseFloat(_gradGetAttr(el,"stdDeviation")||"4"),col=_gradGetAttr(el,"flood-color")||"#000000",a=parseFloat(_gradGetAttr(el,"flood-opacity")||"0.5"),passObj={dx:dx,dy:dy,blur:2*stdDev/3,color:parseColor(col)||"#000000",alpha:isNaN(a)?.5:a,spread:0};passes.push(passObj)}if(passes.length)return passes;for(var mMatch,morphRe=/<feMorphology[^>]*>/g,morphs=[];null!==(mMatch=morphRe.exec(filterContent));)morphs.push({idx:mMatch.index,el:mMatch[0]});function parseValuesFromSegment(seg){for(var cmMatch,off=/<feOffset[^>]*>/g.exec(seg),blu=/<feGaussianBlur[^>]*>/g.exec(seg),cmRe=/<feColorMatrix[^>]*values\s*=\s*"([^"]+)"[^>]*>/g,cm=null;null!==(cmMatch=cmRe.exec(seg));)if(!/in\s*=\s*"SourceAlpha"/i.test(cmMatch[0])){cm=cmMatch;break}var dx=0,dy=0,blur=8/3,alpha=.35,colorHex=null;(off&&(dx=parseFloat(_gradGetAttr(off[0],"dx")||"0"),dy=parseFloat(_gradGetAttr(off[0],"dy")||"0")),blu)&&(blur=2*parseFloat(_gradGetAttr(blu[0],"stdDeviation")||"4")/3);if(cm&&cm[1]){var vals=cm[1].trim().split(/\s+/).map(parseFloat);if(vals&&vals.length>=20){var rAdd=vals[4],gAdd=vals[9],bAdd=vals[14];function clamp01n(v){return Math.max(0,Math.min(1,isNaN(v)?0:v))}if(!isNaN(rAdd)||!isNaN(gAdd)||!isNaN(bAdd)){var r=Math.round(255*clamp01n(rAdd)),g=Math.round(255*clamp01n(gAdd)),b=Math.round(255*clamp01n(bAdd));colorHex="#"+r.toString(16).padStart(2,"0")+g.toString(16).padStart(2,"0")+b.toString(16).padStart(2,"0")}var aMul=vals[18],aOff=vals[19],aPick=!isNaN(aMul)&&aMul>0?aMul:isNaN(aOff)?alpha:aOff;isNaN(aPick)||(alpha=Math.max(0,Math.min(1,aPick)))}}return{dx:dx,dy:dy,blur:blur,alpha:alpha,color:colorHex}}for(var effectMatch,effectBlendRe=/<feBlend[^>]*result\s*=\s*"(effect\d+_dropShadow[^"]*)"[^>]*>/gi,effectBlends=[];null!==(effectMatch=effectBlendRe.exec(filterContent));)effectBlends.push({idx:effectMatch.index,result:effectMatch[1]});if(effectBlends.length>0)for(var ei=0;ei<effectBlends.length;ei++){var blendIdx=effectBlends[ei].idx,passStart=0;ei>0&&(passStart=effectBlends[ei-1].idx+50);var passSeg=filterContent.slice(passStart,blendIdx+100),morphInPass=/<feMorphology[^>]*>/i.exec(passSeg),spread=0;if(morphInPass){var op=(_gradGetAttr(morphInPass[0],"operator")||"").toLowerCase(),r=parseFloat(_gradGetAttr(morphInPass[0],"radius")||"0");"dilate"===op?spread=+Math.max(0,r):"erode"===op&&(spread=-Math.max(0,r))}if((vals=parseValuesFromSegment(passSeg)).color||0!==vals.dx||0!==vals.dy||vals.blur!==8/3||0!==spread){passObj={dx:vals.dx,dy:vals.dy,blur:vals.blur,color:vals.color||"#000000",alpha:vals.alpha,spread:spread};passes.push(passObj)}}else if(morphs.length>0)for(var i=0;i<morphs.length;i++){if("erode"!==(op=(_gradGetAttr(morphs[i].el,"operator")||"").toLowerCase())){var start=morphs[i].idx+morphs[i].el.length,end=i+1<morphs.length?morphs[i+1].idx:filterContent.length,seg=filterContent.slice(start,end);r=parseFloat(_gradGetAttr(morphs[i].el,"radius")||"0"),spread=+Math.max(0,r),passObj={dx:(vals=parseValuesFromSegment(seg)).dx,dy:vals.dy,blur:vals.blur,color:vals.color||"#000000",alpha:vals.alpha,spread:spread};passes.push(passObj)}}else{for(var offsetMatch,offsetRe=/<feOffset[^>]*>/g,offsetMatches=[];null!==(offsetMatch=offsetRe.exec(filterContent));)offsetMatches.push({idx:offsetMatch.index,el:offsetMatch[0]});if(offsetMatches.length>0)for(var oi=0;oi<offsetMatches.length;oi++){start=offsetMatches[oi].idx,end=filterContent.length;var blendRe=/<feBlend[^>]*result\s*=\s*"[^"]*(?:dropShadow|effect)[^"]*"[^>]*>/gi;blendRe.lastIndex=start;var vals,blendMatch=blendRe.exec(filterContent);if(blendMatch&&(end=blendMatch.index+blendMatch[0].length),(vals=parseValuesFromSegment(seg=filterContent.slice(start,end))).color||0!==vals.dx||0!==vals.dy||vals.blur!==8/3||vals.alpha&&.5!==vals.alpha){passObj={dx:vals.dx,dy:vals.dy,blur:vals.blur,color:vals.color||"#000000",alpha:vals.alpha,spread:0};passes.push(passObj)}}else{var hasOffset=/<feOffset[^>]*>/g.test(filterContent),hasColorMatrix=/<feColorMatrix[^>]*>/g.test(filterContent)&&!/<feColorMatrix[^>]*in\s*=\s*"SourceAlpha"/gi.test(filterContent);if(hasOffset||hasColorMatrix){var approx=parseValuesFromSegment(filterContent);if(0!==approx.dx||0!==approx.dy||hasColorMatrix&&approx.color){passObj={dx:approx.dx,dy:approx.dy,blur:approx.blur,color:approx.color||"#000000",alpha:approx.alpha,spread:0};passes.push(passObj)}}}}var hasInnerShadowMarker=/feComposite[^>]*operator\s*=\s*["']arithmetic["'][^>]*k2\s*=\s*["']-1["']/i.test(filterContent)||/result\s*=\s*["'][^"']*innerShadow[^"']*["']/i.test(filterContent);if(0===passes.length&&!hasInnerShadowMarker)try{for(var mAll,cmAll=[],cmReAll=/<feColorMatrix[^>]*type\s*=\s*"matrix"[^>]*values\s*=\s*"([^"]+)"[^>]*>/g;null!==(mAll=cmReAll.exec(filterContent));){var cmTag=mAll[0];/in\s*=\s*"SourceAlpha"/i.test(cmTag)||cmAll.push({idx:mAll.index,values:mAll[1],tag:cmTag})}for(var cmi=0;cmi<cmAll.length;cmi++){for(var o,cmBlock=cmAll[cmi],before=filterContent.slice(0,cmBlock.idx),offMatch=null,blurMatch=null,offRe=/<feOffset[^>]*>/g;null!==(o=offRe.exec(before));)offMatch=o;for(var b,blRe=/<feGaussianBlur[^>]*>/g;null!==(b=blRe.exec(before));)blurMatch=b;var dxF=0,dyF=0,blurF=8/3;if(offMatch&&(dxF=parseFloat(_gradGetAttr(offMatch[0],"dx")||"0"),dyF=parseFloat(_gradGetAttr(offMatch[0],"dy")||"0")),blurMatch)blurF=2*parseFloat(_gradGetAttr(blurMatch[0],"stdDeviation")||"4")/3;var valsArr=cmBlock.values.trim().split(/\s+/).map(parseFloat),rAddF=valsArr[4],gAddF=valsArr[9],bAddF=valsArr[14];function c01(v){return Math.max(0,Math.min(1,isNaN(v)?0:v))}var colF="#"+Math.round(255*c01(rAddF)).toString(16).padStart(2,"0")+Math.round(255*c01(gAddF)).toString(16).padStart(2,"0")+Math.round(255*c01(bAddF)).toString(16).padStart(2,"0"),aMulF=valsArr[18],aOffF=valsArr[19];passObj={dx:dxF,dy:dyF,blur:blurF,color:colF,alpha:!isNaN(aMulF)&&aMulF>0?aMulF:isNaN(aOffF)?.35:aOffF,spread:0};passes.push(passObj)}}catch(eFB){}return passes}function detectInnerShadowPasses(filterContent){if(!filterContent)return[];for(var innerMatch,passes=[],innerBlendRe=/<feBlend[^>]*result\s*=\s*"(effect\d+_innerShadow[^"]*)"[^>]*>/gi,innerBlends=[];null!==(innerMatch=innerBlendRe.exec(filterContent));)innerBlends.push({idx:innerMatch.index,result:innerMatch[1]});if(innerBlends.length>0)for(var ei=0;ei<innerBlends.length;ei++){var blendIdx=innerBlends[ei].idx,passStart=0;if(ei>0)passStart=innerBlends[ei-1].idx+50;else{var shapeBlend=filterContent.indexOf('result="shape"');shapeBlend>0&&(passStart=shapeBlend+20)}var passSeg=filterContent.slice(passStart,blendIdx+100),morphInPass=/<feMorphology[^>]*>/i.exec(passSeg),inset=0;if(morphInPass){var op=(_gradGetAttr(morphInPass[0],"operator")||"").toLowerCase(),r=parseFloat(_gradGetAttr(morphInPass[0],"radius")||"0");"erode"===op&&(inset=Math.max(0,r))}var offsetMatch=/<feOffset[^>]*>/i.exec(passSeg),dx=0,dy=0;offsetMatch&&(dx=parseFloat(_gradGetAttr(offsetMatch[0],"dx")||"0"),dy=parseFloat(_gradGetAttr(offsetMatch[0],"dy")||"0"));var blurMatch=/<feGaussianBlur[^>]*stdDeviation\s*=\s*["']([^"']+)["'][^>]*>/i.exec(passSeg),blur=0;blurMatch&&blurMatch[1]&&(blur=parseFloat(blurMatch[1]));for(var cmMatch,color="#000000",alpha=1,cmRe=/<feColorMatrix[^>]*type\s*=\s*"matrix"[^>]*values\s*=\s*"([^"]+)"[^>]*>/gi;null!==(cmMatch=cmRe.exec(passSeg));){var cmTag=cmMatch[0];if(!/result\s*=\s*"hardAlpha"/i.test(cmTag)){var vals=cmMatch[1].split(/\s+/).map(parseFloat);if(vals.length>=20){r=Math.round(255*Math.max(0,Math.min(1,vals[4])));var g=Math.round(255*Math.max(0,Math.min(1,vals[9]))),b=Math.round(255*Math.max(0,Math.min(1,vals[14])));color="#"+r.toString(16).padStart(2,"0")+g.toString(16).padStart(2,"0")+b.toString(16).padStart(2,"0"),alpha=vals[18]||1}}}var passObj={dx:dx,dy:dy,blur:blur,color:color,alpha:alpha,inset:inset};passes.push(passObj)}return passes}function createSingleInnerShadowNode(shapeId,blur,offsetX,offsetY,colorHex,alpha,nameSuffix){var nodeId=null,name="Inner Shadow"+(nameSuffix||"");try{nodeId=api.create("innerShadowFilter",name)}catch(e0){}if(!nodeId)try{nodeId=api.create("innerShadow",name)}catch(e00){}if(!nodeId)return console.error("[Inner Shadow] Failed to create innerShadowFilter"),null;var blurAmt=Math.max(0,blur||0),blurSet=!1;try{api.set(nodeId,{amount:[blurAmt,blurAmt]}),blurSet=!0}catch(eBlur){}if(!blurSet){try{api.set(nodeId,{"amount.x":blurAmt})}catch(eBlurX){}try{api.set(nodeId,{"amount.y":blurAmt})}catch(eBlurY){}}try{api.set(nodeId,{offset:[offsetX,-offsetY]})}catch(eOff){}var r=parseInt(colorHex.substring(1,3),16),g=parseInt(colorHex.substring(3,5),16),b=parseInt(colorHex.substring(5,7),16),a=Math.round(255*alpha);try{api.set(nodeId,{shadowColor:colorHex})}catch(eCol1){}try{api.set(nodeId,{"shadowColor.r":r}),api.set(nodeId,{"shadowColor.g":g}),api.set(nodeId,{"shadowColor.b":b}),api.set(nodeId,{"shadowColor.a":a})}catch(eCol2){}try{api.set(nodeId,{color:colorHex}),api.set(nodeId,{"color.r":r}),api.set(nodeId,{"color.g":g}),api.set(nodeId,{"color.b":b}),api.set(nodeId,{"color.a":a})}catch(eCol3){}try{api.connect(nodeId,"id",shapeId,"filters"),addFilterForTarget(shapeId,nodeId)}catch(eC){try{api.connect(nodeId,"id",shapeId,"deformers")}catch(eC2){}}try{api.getParent(nodeId)||api.parent(nodeId,shapeId)}catch(eP){}return console.info("[Inner Shadow] Created"+(nameSuffix||"")+": blur="+blurAmt+", offset=["+offsetX+","+-offsetY+"], color="+colorHex),nodeId}function createAndAttachInnerShadow(shapeId,pass,passIndex,totalPasses){try{if(!importEffectsEnabled)return null;passIndex="number"==typeof passIndex?passIndex:0,totalPasses="number"==typeof totalPasses?totalPasses:1;var blur=pass.blur||0,colorHex=pass.color||"#000000",alpha=void 0!==pass.alpha?pass.alpha:1,baseDx=pass.dx||0,baseDy=pass.dy||0,inset=pass.inset||0;if(1===totalPasses&&inset>0){console.info("[Inner Shadow] Single pass with spread ("+inset+"), creating dual shadows to simulate");var id1=createSingleInnerShadowNode(shapeId,blur,baseDx-inset,baseDy-inset,colorHex,alpha,"");createSingleInnerShadowNode(shapeId,blur,baseDx+inset,baseDy+inset,colorHex,alpha," [Background]");return id1}return totalPasses>1&&inset>0&&console.info("[Inner Shadow] Pass "+passIndex+": Multiple inner shadows detected, ignoring spread to avoid Cavalry 3+ bug"),createSingleInnerShadowNode(shapeId,blur,baseDx,baseDy,colorHex,alpha,"")}catch(e){return console.error("[Inner Shadow] Error: "+e.message),null}}function createAndAttachDropShadow(shapeId,pass){try{if(!importEffectsEnabled)return null;var nodeId=null;try{nodeId=api.create("dropShadowFilter","Drop Shadow")}catch(e0){}if(!nodeId)try{nodeId=api.create("dropShadow","Drop Shadow")}catch(e00){}if(!nodeId)return null;try{api.set(nodeId,{offset:[pass.dx||0,-(pass.dy||0)]})}catch(e2){}var blurAmt=Math.max(0,pass.blur||0),okAmount=!1;try{api.set(nodeId,{amount:[blurAmt,blurAmt]}),okAmount=!0}catch(eAmtV){}if(!okAmount){try{api.set(nodeId,{"amount.x":blurAmt})}catch(eAx){}try{api.set(nodeId,{"amount.y":blurAmt})}catch(eAy){}}var baseCol=parseColor(pass.color||"#000000")||"#000000",colorSet=(Math.max(0,Math.min(100,Math.round(100*("number"==typeof pass.alpha?pass.alpha:.5)))),colorWithOpacity(baseCol,pass.alpha||.5),!1);try{api.set(nodeId,{shadowColor:baseCol}),colorSet=!0}catch(eCol1){}try{var r=parseInt(baseCol.substring(1,3),16),g=parseInt(baseCol.substring(3,5),16),b=parseInt(baseCol.substring(5,7),16),a=Math.round(255*(pass.alpha||.5));api.set(nodeId,{"shadowColor.r":r}),api.set(nodeId,{"shadowColor.g":g}),api.set(nodeId,{"shadowColor.b":b}),api.set(nodeId,{"shadowColor.a":a})}catch(eComponents){}if(!colorSet)try{var rNorm=parseInt(baseCol.substring(1,3),16)/255,gNorm=parseInt(baseCol.substring(3,5),16)/255,bNorm=parseInt(baseCol.substring(5,7),16)/255;api.set(nodeId,{"shadowColor.r":rNorm}),api.set(nodeId,{"shadowColor.g":gNorm}),api.set(nodeId,{"shadowColor.b":bNorm}),api.set(nodeId,{"shadowColor.a":pass.alpha||.5})}catch(eNorm){}try{api.connect(nodeId,"id",shapeId,"filters"),addFilterForTarget(shapeId,nodeId)}catch(eC){try{api.connect(nodeId,"id",shapeId,"deformers")}catch(eC2){}}try{api.getParent(nodeId)||api.parent(nodeId,shapeId)}catch(eP){}return nodeId}catch(e){return null}}var __blurOverlayShapes={};function queueBackgroundBlur(overlayShapeId,amount,parentId){importEffectsEnabled&&(__blurOverlayShapes[overlayShapeId]=!0,__deferredBackgroundBlurs.push({overlayShapeId:overlayShapeId,amount:amount,parentId:parentId}))}function boundingBoxesOverlap(bbox1,bbox2){if(!bbox1||!bbox2)return!1;var left1=bbox1.left,right1=bbox1.right,top1=bbox1.top,bottom1=bbox1.bottom,left2=bbox2.left,right2=bbox2.right,top2=bbox2.top,bottom2=bbox2.bottom;return void 0!==left1&&void 0!==right1&&void 0!==top1&&void 0!==bottom1&&(void 0!==left2&&void 0!==right2&&void 0!==top2&&void 0!==bottom2&&(!(right1<left2)&&(!(left1>right2)&&(!(top1<bottom2)&&!(bottom1>top2)))))}function processDeferredBackgroundBlurs(){if(0!==__deferredBackgroundBlurs.length){for(var i=0;i<__deferredBackgroundBlurs.length;i++){var blurRequest=__deferredBackgroundBlurs[i],overlayShapeId=blurRequest.overlayShapeId,amount=blurRequest.amount,parentId=blurRequest.parentId;try{var overlayBBox=null;try{overlayBBox=api.getBoundingBox(overlayShapeId,!0)}catch(eBB){console.warn("[Background Blur] Could not get bounding box for overlay: "+eBB.message);continue}if(!overlayBBox){console.warn('[Background Blur] No bounding box for overlay "'+api.getNiceName(overlayShapeId)+'"');continue}for(var siblings=__groupDirectChildren[parentId]||[],overlayIndex=-1,si=0;si<siblings.length;si++)if(siblings[si]===overlayShapeId){overlayIndex=si;break}if(overlayIndex<=0&&parentId)try{var grandparentId=api.getParent(parentId);if(grandparentId){for(var grandparentChildren=__groupDirectChildren[grandparentId]||[],parentIndexInGrandparent=-1,gci=0;gci<grandparentChildren.length;gci++)if(grandparentChildren[gci]===parentId){parentIndexInGrandparent=gci;break}parentIndexInGrandparent>0&&(siblings=grandparentChildren,overlayIndex=parentIndexInGrandparent)}}catch(eGP){}if(overlayIndex<=0)continue;for(var underlyingSiblings=siblings.slice(0,overlayIndex),blurAmount=Math.max(0,(amount||0)/2),overlappingSiblings=[],j=0;j<underlyingSiblings.length;j++){var siblingId=underlyingSiblings[j];if(!__blurOverlayShapes[siblingId])try{var siblingBBox=api.getBoundingBox(siblingId,!0),overlaps=boundingBoxesOverlap(overlayBBox,siblingBBox);siblingBBox&&overlaps&&overlappingSiblings.push(siblingId)}catch(eSibling){}}if(0===overlappingSiblings.length)continue;var blurFilterId=null;try{blurFilterId=api.create("backgroundBlurFilter","Background Blur")}catch(eCreate){console.warn("[Background Blur] Could not create filter: "+eCreate.message);continue}if(!blurFilterId)continue;try{api.set(blurFilterId,{"amount.x":blurAmount}),api.set(blurFilterId,{"amount.y":blurAmount})}catch(eAmt){console.warn("[Background Blur] Could not set amount: "+eAmt.message)}try{api.connect(overlayShapeId,"id",blurFilterId,"inputShape")}catch(eInput){console.warn("[Background Blur] Could not connect inputShape: "+eInput.message)}for(var connectedCount=0,k=0;k<overlappingSiblings.length;k++){var targetId=overlappingSiblings[k];try{api.connect(blurFilterId,"id",targetId,"filters"),addFilterForTarget(targetId,blurFilterId),connectedCount++}catch(eConnect){console.warn('[Background Blur] Could not connect filter to "'+api.getNiceName(targetId)+'": '+eConnect.message)}}try{api.parent(blurFilterId,overlayShapeId)}catch(eParent){}console.info('[Background Blur] Created 1 filter for overlay "'+api.getNiceName(overlayShapeId)+'" connected to '+connectedCount+" layer(s)")}catch(eProcess){console.error("[Background Blur] Error processing blur: "+eProcess.message)}}__deferredBackgroundBlurs=[]}}function clearDeferredBackgroundBlurs(){__deferredBackgroundBlurs=[],__blurOverlayShapes={},resetFilterCache()}function _registerChild(parentId,childId){try{if(null==parentId)return;__groupDirectChildren[parentId]||(__groupDirectChildren[parentId]=[]),__groupDirectChildren[parentId].push(childId)}catch(e){}}
// quiver_utilities_masks.js
var __svgMaskMap={},__createdMaskShapes={},__targetToMaskShape={},__shapesUsedAsMattes={};function setMaskContext(maskMap){__svgMaskMap=maskMap||{}}function resetMaskShapeCache(){__createdMaskShapes={},__targetToMaskShape={},__shapesUsedAsMattes={}}
// Uses: parseTransformMatrixList, decomposeMatrix, parseTranslate from quiver_utilities_transform.js
function _preprocessMaskChildTransform(maskChild){var clone=JSON.parse(JSON.stringify(maskChild)),transformStr=clone.attrs&&clone.attrs.transform;if(!transformStr||"string"!=typeof transformStr)return clone;var hasMatrix=-1!==transformStr.indexOf("matrix"),hasRotate=-1!==transformStr.indexOf("rotate"),hasScale=-1!==transformStr.indexOf("scale"),hasSkew=-1!==transformStr.indexOf("skew");if(!(hasMatrix||hasRotate||hasScale||hasSkew))return clone;var fullMatrix=parseTransformMatrixList(transformStr),rotationDeg=decomposeMatrix(fullMatrix).rotationDeg||0;if("rect"===clone.type){var x=parseFloat(clone.attrs.x||"0"),y=parseFloat(clone.attrs.y||"0"),w=parseFloat(clone.attrs.width||"0"),h=parseFloat(clone.attrs.height||"0"),centerX=x+w/2,centerY=y+h/2,transformedCenterX=fullMatrix.a*centerX+fullMatrix.c*centerY+fullMatrix.e,transformedCenterY=fullMatrix.b*centerX+fullMatrix.d*centerY+fullMatrix.f;clone.attrs._rotationDeg=rotationDeg,clone.attrs._transformedCenterX=transformedCenterX,clone.attrs._transformedCenterY=transformedCenterY,clone.attrs._localCenterX=centerX,clone.attrs._localCenterY=centerY,clone.attrs.x=(transformedCenterX-w/2).toString(),clone.attrs.y=(transformedCenterY-h/2).toString()}else if("circle"===clone.type||"ellipse"===clone.type){var cx=parseFloat(clone.attrs.cx||"0"),cy=parseFloat(clone.attrs.cy||"0"),transformedCx=fullMatrix.a*cx+fullMatrix.c*cy+fullMatrix.e,transformedCy=fullMatrix.b*cx+fullMatrix.d*cy+fullMatrix.f;clone.attrs._rotationDeg=rotationDeg,clone.attrs.cx=transformedCx.toString(),clone.attrs.cy=transformedCy.toString()}return delete clone.attrs.transform,clone}function doesSvgGeometryMatchClipPath(svgGeometry,maskDef){try{if(!svgGeometry)return!1;if(!maskDef||!maskDef.children||1!==maskDef.children.length)return!1;var clipChild=maskDef.children[0];if("rect"===clipChild.type&&void 0!==svgGeometry.width){var clipX=parseFloat(clipChild.attrs.x||"0"),clipY=parseFloat(clipChild.attrs.y||"0"),clipW=parseFloat(clipChild.attrs.width||"0"),clipH=parseFloat(clipChild.attrs.height||"0"),targetX=svgGeometry.x,targetY=svgGeometry.y,targetW=svgGeometry.width,targetH=svgGeometry.height,tolerance=1,dimMatch=Math.abs(targetW-clipW)<tolerance&&Math.abs(targetH-clipH)<tolerance,posMatch=Math.abs(targetX-clipX)<tolerance&&Math.abs(targetY-clipY)<tolerance;return dimMatch&&posMatch}if("path"===clipChild.type&&void 0!==svgGeometry.d){var clipD=clipChild.attrs.d||"",targetD=svgGeometry.d||"",normalizePathData=function(d){return d.replace(/\s+/g," ").trim()};return normalizePathData(clipD)===normalizePathData(targetD)}if("circle"===clipChild.type&&void 0!==svgGeometry.cx){var clipCx=parseFloat(clipChild.attrs.cx||"0"),clipCy=parseFloat(clipChild.attrs.cy||"0"),clipR=parseFloat(clipChild.attrs.r||"0"),targetCx=svgGeometry.cx,targetCy=svgGeometry.cy,targetR=svgGeometry.r;tolerance=1;return Math.abs(targetCx-clipCx)<tolerance&&Math.abs(targetCy-clipCy)<tolerance&&Math.abs(targetR-clipR)<tolerance}if("ellipse"===clipChild.type&&void 0!==svgGeometry.cx&&void 0!==svgGeometry.rx){var clipExCx=parseFloat(clipChild.attrs.cx||"0"),clipExCy=parseFloat(clipChild.attrs.cy||"0"),clipRx=parseFloat(clipChild.attrs.rx||"0"),clipRy=parseFloat(clipChild.attrs.ry||"0"),targetExCx=svgGeometry.cx,targetExCy=svgGeometry.cy,targetRx=svgGeometry.rx,targetRy=svgGeometry.ry;tolerance=1;return Math.abs(targetExCx-clipExCx)<tolerance&&Math.abs(targetExCy-clipExCy)<tolerance&&Math.abs(targetRx-clipRx)<tolerance&&Math.abs(targetRy-clipRy)<tolerance}return!1}catch(e){return!1}}function getMaskShapesForTarget(targetLayerId){return __targetToMaskShape[targetLayerId]||[]}function getMaskShapeForTarget(targetLayerId){var masks=__targetToMaskShape[targetLayerId];return masks&&masks.length>0?masks[0]:null}function addMaskShapeForTarget(targetLayerId,maskShapeId){__targetToMaskShape[targetLayerId]||(__targetToMaskShape[targetLayerId]=[]),-1===__targetToMaskShape[targetLayerId].indexOf(maskShapeId)&&__targetToMaskShape[targetLayerId].push(maskShapeId)}function getMaskDefinition(maskId){return __svgMaskMap[maskId]||null}function createMaskShapeForTarget(maskId,targetShapeId,parentId,vb,model,svgGeometry){try{var maskDef=getMaskDefinition(maskId);if(!maskDef)return console.warn("[Quiver] Mask definition not found: "+maskId),null;maskDef.type;if(__createdMaskShapes[maskId]){var existingShapeId=__createdMaskShapes[maskId];if(existingShapeId===targetShapeId)return existingShapeId;try{if(api.connect(existingShapeId,"id",targetShapeId,"masks"),addMaskShapeForTarget(targetShapeId,existingShapeId),__shapesUsedAsMattes[existingShapeId])try{api.set(existingShapeId,{hidden:!1})}catch(eVis){}}catch(eReuse){console.warn("[MASK]   ‚úó FAILED to connect: "+eReuse.message)}return existingShapeId}if("clip"===maskDef.type&&svgGeometry&&doesSvgGeometryMatchClipPath(svgGeometry,maskDef)){__createdMaskShapes[maskId]=targetShapeId,__shapesUsedAsMattes[targetShapeId]=!0;try{api.set(targetShapeId,{hidden:!1})}catch(eVisible){}return targetShapeId}var maskChild=maskDef.children&&maskDef.children[0];if(!maskChild)return console.warn("[Quiver] Mask has no child elements: "+maskId),null;var processedMaskChild=_preprocessMaskChildTransform(maskChild),maskShapeId=null;if("rect"===processedMaskChild.type)maskShapeId=createRect(processedMaskChild,parentId,vb);else if("circle"===processedMaskChild.type)maskShapeId=createCircle(processedMaskChild,parentId,vb);else if("ellipse"===processedMaskChild.type)maskShapeId=createEllipse(processedMaskChild,parentId,vb);else{if("path"!==maskChild.type)return console.warn("[Quiver] Unsupported mask shape type: "+maskChild.type),null;maskShapeId=createEditableFromPathSegments(parsePathDataToAbsolute(maskChild.attrs.d||""),maskChild.name||("clip"===maskDef.type?"Clip Path":"Mask Path"),parentId,vb,{x:0,y:0},maskChild.attrs)}if(!maskShapeId)return console.warn("[Quiver] Failed to create mask shape"),null;__createdMaskShapes[maskId]=maskShapeId;try{api.set(maskShapeId,{hidden:!0})}catch(eHidden){console.warn("[Quiver] Could not set mask shape as hidden")}if("luminance"===maskDef.type)try{var shiftChannelsId=api.create("shiftChannels","Shift Channels ["+maskChild.name+"]");if(shiftChannelsId){api.set(shiftChannelsId,{aSource:5});try{api.connect(shiftChannelsId,"id",maskShapeId,"filters")}catch(eConn){console.warn("[Quiver] Could not connect ShiftChannels to mask shape")}try{api.getParent(shiftChannelsId)||api.parent(shiftChannelsId,maskShapeId)}catch(eParent){}}}catch(eShift){console.warn("[Quiver] Could not create ShiftChannels filter for luminance mask")}try{api.connect(maskShapeId,"id",targetShapeId,"masks"),addMaskShapeForTarget(targetShapeId,maskShapeId)}catch(eClipMask){console.warn("[Quiver] Could not connect mask: "+eClipMask.message)}return maskShapeId}catch(e){return console.error("[Quiver] Error creating mask shape: "+(e.message||e)),null}}
// quiver_utilities_transform.js
function parseTranslate(transform){if(!transform)return{x:0,y:0};var m=transform.match(/translate\(([^\)]*)\)/);if(m){var parts=m[1].split(/[ ,]+/).map(function(s){return parseFloat(s)});return{x:parts.length>0&&!isNaN(parts[0])?parts[0]:0,y:parts.length>1&&!isNaN(parts[1])?parts[1]:0}}var matrixMatch=transform.match(/matrix\(([^\)]*)\)/);if(matrixMatch){var matrixParts=matrixMatch[1].split(/[ ,]+/).map(function(s){return parseFloat(s)});if(matrixParts.length>=6)return{x:isNaN(matrixParts[4])?0:matrixParts[4],y:isNaN(matrixParts[5])?0:matrixParts[5]}}return{x:0,y:0}}function applyMatrixToPoint(transform,x,y){if(!transform)return{x:x,y:y};var matrixMatch=transform.match(/matrix\(([^\)]*)\)/);if(!matrixMatch)return{x:x,y:y};var parts=matrixMatch[1].split(/[ ,]+/).map(function(s){return parseFloat(s)});if(parts.length<6)return{x:x,y:y};var a=parts[0],b=parts[1],c=parts[2],d=parts[3];return{x:a*x+c*y+parts[4],y:b*x+d*y+parts[5]}}function parseRotatePivot(transform){var out={angle:0,cx:null,cy:null};if(!transform||"string"!=typeof transform)return out;var m=/rotate\(\s*([-\d\.]+)(?:[ ,]+([-\d\.]+)[ ,]+([-\d\.]+))?\s*\)/.exec(transform);if(!m)return out;var ang=parseFloat(m[1]);if(isNaN(ang)||(out.angle=ang),void 0!==m[2]&&void 0!==m[3]){var cx=parseFloat(m[2]),cy=parseFloat(m[3]);isNaN(cx)||isNaN(cy)||(out.cx=cx,out.cy=cy)}return out}function rotatePointAround(x,y,angleDeg,cx,cy){var th=(angleDeg||0)*Math.PI/180,cos=Math.cos(th),sin=Math.sin(th),dx=x-cx,dy=y-cy;return{x:cx+dx*cos-dy*sin,y:cy+dx*sin+dy*cos}}function _matIdentity(){return{a:1,b:0,c:0,d:1,e:0,f:0}}function _matMultiply(m1,m2){return{a:m1.a*m2.a+m1.c*m2.b,b:m1.b*m2.a+m1.d*m2.b,c:m1.a*m2.c+m1.c*m2.d,d:m1.b*m2.c+m1.d*m2.d,e:m1.a*m2.e+m1.c*m2.f+m1.e,f:m1.b*m2.e+m1.d*m2.f+m1.f}}function _matTranslate(tx,ty){return{a:1,b:0,c:0,d:1,e:tx||0,f:ty||0}}function _matScale(sx,sy){return(void 0===sy||isNaN(sy))&&(sy=sx),{a:sx||1,b:0,c:0,d:sy||1,e:0,f:0}}function _matRotate(rad){var cos=Math.cos(rad),sin=Math.sin(rad);return{a:cos,b:sin,c:-sin,d:cos,e:0,f:0}}function _matSkewX(rad){return{a:1,b:0,c:Math.tan(rad),d:1,e:0,f:0}}function _matSkewY(rad){return{a:1,b:Math.tan(rad),c:0,d:1,e:0,f:0}}function _matFrom(a,b,c,d,e,f){return{a:a,b:b,c:c,d:d,e:e,f:f}}function parseTransformMatrixList(str){if(!str||"string"!=typeof str)return _matIdentity();for(var m,regex=/(matrix|translate|scale|rotate|skewX|skewY)\s*\(([^\)]*)\)/g,acc=_matIdentity();null!==(m=regex.exec(str));){var kind=m[1],args=m[2].split(/[ ,]+/).filter(function(s){return""!==s}).map(parseFloat),t=_matIdentity();if("matrix"===kind&&args.length>=6)t=_matFrom(args[0],args[1],args[2],args[3],args[4],args[5]);else if("translate"===kind){t=_matTranslate(args[0]||0,(args.length>1?args[1]:0)||0)}else if("scale"===kind){var sx=args[0]||1;t=_matScale(sx,args.length>1?args[1]:sx)}else if("rotate"===kind){var ang=(args[0]||0)*Math.PI/180;if(args.length>=3){var cx=args[1]||0,cy=args[2]||0;t=_matMultiply(_matMultiply(_matTranslate(cx,cy),_matRotate(ang)),_matTranslate(-cx,-cy))}else t=_matRotate(ang)}else"skewX"===kind?t=_matSkewX((args[0]||0)*Math.PI/180):"skewY"===kind&&(t=_matSkewY((args[0]||0)*Math.PI/180));acc=_matMultiply(acc,t)}return acc}function decomposeMatrix(m){var a=m.a,b=m.b,c=m.c,d=m.d,scaleX=Math.sqrt(a*a+b*b)||0,rot=0;0!==scaleX&&(rot=Math.atan2(b,a));var a2=a/(scaleX||1),b2=b/(scaleX||1),shear=a2*c+b2*d,c2=c-a2*shear,d2=d-b2*shear,scaleY=Math.sqrt(c2*c2+d2*d2)||0;a*d-b*c<0&&(scaleX<scaleY?scaleX=-scaleX:scaleY=-scaleY);var shearFactor=0!==scaleY?shear/scaleY:0,translateX=m.e||m.tx||0,translateY=m.f||m.ty||0;return{rotationDeg:180*rot/Math.PI,scaleX:scaleX,scaleY:scaleY,shear:shearFactor,translateX:translateX,translateY:translateY}}function getRotationDegFromTransform(tstr){return decomposeMatrix(parseTransformMatrixList(tstr||"")).rotationDeg||0}
// quiver_svgParser.js
function parseSVGStructure(svgCode){var uidCounter=0,idIndex={};function makeNode(base){return base._uid=++uidCounter,base.attrs&&base.attrs.id&&(idIndex[base.attrs.id]=base),base}for(var match,tree=makeNode({type:"root",name:"root",children:[],attrs:{},transformChain:[]}),stack=[tree],regex=/<(svg|g|rect|circle|ellipse|text|path|polygon|polyline|line|image|pattern|defs|clipPath|mask|use)([^>]*)>|<\/\s*(svg|g|text|defs|clipPath|mask|pattern)\s*>|<tspan([^>]*)>(.*?)<\/tspan>/g;null!==(match=regex.exec(svgCode));)if(match[1]){var tag=match[1],opening="<"+tag+(match[2]||"")+">";if("svg"===tag||"g"===tag||"text"===tag||"defs"===tag||"clipPath"===tag||"mask"===tag){var node=makeNode({type:tag,name:decodeEntitiesForName(extractAttribute(opening,"id")||tag),attrs:{},opening:opening,children:[],tspans:[],transformChain:[]});node.attrs.transform=extractAttribute(opening,"transform");for(var directAttrs=["id","fill","fill-opacity","stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","opacity","font-family","font-size","font-weight","font-style","letter-spacing","x","y","mask","clip-path","filter","mix-blend-mode","data-figma-bg-blur-radius","data-figma-gradient-fill","data-figma-skip-parse"],d=0;d<directAttrs.length;d++){var key=directAttrs[d],val=extractAttribute(opening,key);null!==val&&(node.attrs[key]=val)}var styleAttr=extractAttribute(opening,"style");styleAttr&&(node.attrs.style=styleAttr);var inline=mergeInlineStyleIntoAttrs(opening);for(var k in inline)node.attrs[k]=inline[k];if(stack[stack.length-1].children.push(node),stack.push(node),"text"===tag)try{var textEndPos=match.index+match[0].length,nextTagMatch=/<[^>]+>/.exec(svgCode.substring(textEndPos));if(nextTagMatch){var directTextContent=svgCode.substring(textEndPos,textEndPos+nextTagMatch.index).trim();if(directTextContent){directTextContent=(directTextContent=directTextContent.replace(/&#10;/g,"")).replace(/<a[^>]*>/g,"").replace(/<\/a>/g,"");try{directTextContent=decodeEntitiesForName(directTextContent)}catch(eDec){}directTextContent&&node.tspans.push({x:parseFloat(node.attrs.x||"0"),y:parseFloat(node.attrs.y||"0"),text:directTextContent})}}}catch(eDirectText){}}else if("rect"===tag||"circle"===tag||"ellipse"===tag){for(var leaf=makeNode({type:tag,name:decodeEntitiesForName(extractAttribute(opening,"id")||tag),attrs:{},opening:opening,children:[],transformChain:[]}),keys=["id","x","y","width","height","rx","ry","cx","cy","r","rx","ry","fill","fill-opacity","stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","opacity","transform","mask","clip-path","filter","mix-blend-mode","data-figma-bg-blur-radius","data-figma-gradient-fill"],j=0;j<keys.length;j++){var kk=keys[j],vv=extractAttribute(opening,kk);null!==vv&&(leaf.attrs[kk]=vv)}var inline2=mergeInlineStyleIntoAttrs(opening);for(var k2 in inline2)leaf.attrs[k2]=inline2[k2];stack[stack.length-1].children.push(leaf)}else if("image"===tag){var inode=makeNode({type:tag,name:decodeEntitiesForName(extractAttribute(opening,"id")||tag),attrs:{},opening:opening,children:[],transformChain:[]});null!==(href=extractAttribute(opening,"href")||extractAttribute(opening,"xlink:href"))&&(inode.attrs.href=href);for(var ikeys=["id","x","y","width","height","opacity","transform","preserveAspectRatio","mask","clip-path","filter","mix-blend-mode"],ij=0;ij<ikeys.length;ij++){var ikk=ikeys[ij],ivv=extractAttribute(opening,ikk);null!==ivv&&(inode.attrs[ikk]=ivv)}var inlineI=mergeInlineStyleIntoAttrs(opening);for(var kI in inlineI)inode.attrs[kI]=inlineI[kI];inode.attrs.id&&(idIndex[inode.attrs.id]=inode),stack[stack.length-1].children.push(inode)}else if("use"===tag){var href,unode=makeNode({type:tag,name:decodeEntitiesForName(extractAttribute(opening,"id")||tag),attrs:{},opening:opening,children:[],transformChain:[]});null!==(href=extractAttribute(opening,"href")||extractAttribute(opening,"xlink:href"))&&(unode.attrs.href=href);for(var ukeys=["id","x","y","width","height","opacity","transform","mask","clip-path","filter","mix-blend-mode"],uj=0;uj<ukeys.length;uj++){var ukk=ukeys[uj],uvv=extractAttribute(opening,ukk);null!==uvv&&(unode.attrs[ukk]=uvv)}var inlineU=mergeInlineStyleIntoAttrs(opening);for(var kU in inlineU)unode.attrs[kU]=inlineU[kU];stack[stack.length-1].children.push(unode)}else if("pattern"===tag){for(var pnode=makeNode({type:tag,name:decodeEntitiesForName(extractAttribute(opening,"id")||tag),attrs:{},opening:opening,children:[],transformChain:[]}),pkeys=["id","x","y","width","height","patternUnits","patternContentUnits","patternTransform"],pkj=0;pkj<pkeys.length;pkj++){var pkk=pkeys[pkj],pkv=extractAttribute(opening,pkk);null!==pkv&&(pnode.attrs[pkk]=pkv)}stack[stack.length-1].children.push(pnode),stack.push(pnode)}else if("path"===tag){pnode=makeNode({type:tag,name:decodeEntitiesForName(extractAttribute(opening,"id")||tag),attrs:{},opening:opening,children:[],transformChain:[]}),pkeys=["id","d","fill","fill-opacity","stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","opacity","transform","fill-rule","clip-rule","mask","clip-path","filter","mix-blend-mode","data-figma-bg-blur-radius","data-figma-gradient-fill"];for(var pj=0;pj<pkeys.length;pj++){var pk=pkeys[pj],pv=extractAttribute(opening,pk);null!==pv&&(pnode.attrs[pk]=pv)}var inline3=mergeInlineStyleIntoAttrs(opening);for(var k3 in inline3)pnode.attrs[k3]=inline3[k3];stack[stack.length-1].children.push(pnode)}else if("polygon"===tag||"polyline"===tag){for(var vnode=makeNode({type:tag,name:decodeEntitiesForName(extractAttribute(opening,"id")||tag),attrs:{},opening:opening,children:[],transformChain:[]}),vkeys=["id","points","fill","fill-opacity","stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","opacity","transform","mask","clip-path","filter","mix-blend-mode","data-figma-bg-blur-radius","data-figma-gradient-fill"],vj=0;vj<vkeys.length;vj++){var vk=vkeys[vj],vv2=extractAttribute(opening,vk);null!==vv2&&(vnode.attrs[vk]=vv2)}var inline4=mergeInlineStyleIntoAttrs(opening);for(var k4 in inline4)vnode.attrs[k4]=inline4[k4];stack[stack.length-1].children.push(vnode)}else if("line"===tag){for(var lnode=makeNode({type:tag,name:decodeEntitiesForName(extractAttribute(opening,"id")||tag),attrs:{},opening:opening,children:[],transformChain:[]}),lkeys=["id","x1","y1","x2","y2","fill","fill-opacity","stroke","stroke-width","stroke-opacity","stroke-dasharray","stroke-dashoffset","stroke-linecap","stroke-linejoin","opacity","transform","mask","clip-path","filter","mix-blend-mode","data-figma-bg-blur-radius","data-figma-gradient-fill"],lj=0;lj<lkeys.length;lj++){var lk=lkeys[lj],lv=extractAttribute(opening,lk);null!==lv&&(lnode.attrs[lk]=lv)}var inline5=mergeInlineStyleIntoAttrs(opening);for(var k5 in inline5)lnode.attrs[k5]=inline5[k5];stack[stack.length-1].children.push(lnode)}}else if(match[3]){for(var closingTag=match[3],s=stack.length-1;s>=0;s--)if(stack[s].type===closingTag){stack.splice(s,stack.length-s);break}}else if(void 0!==match[4]){var tspanOpen="<tspan"+(match[4]||"")+">",textContent=(match[5]||"").replace(/&#10;/g,"");textContent=textContent.replace(/<a[^>]*>/g,"").replace(/<\/a>/g,"");try{textContent=decodeEntitiesForName(textContent)}catch(eDec){}for(var target=null,si=stack.length-1;si>=0;si--)if("text"===stack[si].type){target=stack[si];break}target&&target.tspans.push({x:parseFloat(extractAttribute(tspanOpen,"x")||target.attrs.x||"0"),y:parseFloat(extractAttribute(tspanOpen,"y")||target.attrs.y||"0"),text:textContent})}return tree._idIndex=idIndex,tree}function extractMasks(svgCode){var masks={};function parseChildShapes(content){for(var childMatch,children=[],childRegex=/<(circle|ellipse|rect|path)([^>]*)\/?>(?:[\s\S]*?<\/\1>)?/g;null!==(childMatch=childRegex.exec(content));){var childType=childMatch[1],childOpening="<"+childType+childMatch[2]+">",childNode={type:childType,name:extractAttribute(childOpening,"id")||childType,attrs:{}},attrKeys=[];"circle"===childType?attrKeys=["id","cx","cy","r","fill","fill-opacity","stroke","stroke-width","opacity","transform"]:"ellipse"===childType?attrKeys=["id","cx","cy","rx","ry","fill","fill-opacity","stroke","stroke-width","opacity","transform"]:"rect"===childType?attrKeys=["id","x","y","width","height","rx","ry","fill","fill-opacity","stroke","stroke-width","opacity","transform"]:"path"===childType&&(attrKeys=["id","d","fill","fill-opacity","stroke","stroke-width","opacity","transform","fill-rule"]);for(var i=0;i<attrKeys.length;i++){var key=attrKeys[i],val=extractAttribute(childOpening,key);null!==val&&(childNode.attrs[key]=val)}children.push(childNode)}return children}for(var match,maskRegex=/<mask([^>]*)>([\s\S]*?)<\/mask>/g;null!==(match=maskRegex.exec(svgCode));){var maskAttrs=match[1],maskContent=match[2],idMatch=/id\s*=\s*["']([^"']+)["']/.exec(maskAttrs);if(idMatch){var maskId=idMatch[1],maskType="alpha",styleMatch=/style\s*=\s*["']([^"']+)["']/.exec(maskAttrs);if(styleMatch){var styleContent=styleMatch[1];/mask-type\s*:\s*luminance/i.test(styleContent)&&(maskType="luminance")}masks[maskId]={type:maskType,children:parseChildShapes(maskContent),attrs:{}}}}for(var clipMatch,clipPathRegex=/<clipPath([^>]*)>([\s\S]*?)<\/clipPath>/g;null!==(clipMatch=clipPathRegex.exec(svgCode));){var clipAttrs=clipMatch[1],clipContent=clipMatch[2],clipIdMatch=/id\s*=\s*["']([^"']+)["']/.exec(clipAttrs);if(clipIdMatch)masks[clipIdMatch[1]]={type:"clip",children:parseChildShapes(clipContent),attrs:{}}}return masks}function _geomKey(node){if(!node||!node.type)return null;var t=node.type,a=node.attrs||{},tr=a.transform||"";return"path"===t?"p:"+(a.d||"")+"|t:"+tr:"rect"===t?"r:"+[a.x||0,a.y||0,a.width||0,a.height||0,a.rx||0,a.ry||0].join(",")+"|t:"+tr:"circle"===t?"c:"+[a.cx||0,a.cy||0,a.r||0].join(",")+"|t:"+tr:"ellipse"===t?"e:"+[a.cx||0,a.cy||0,a.rx||0,a.ry||0].join(",")+"|t:"+tr:"polygon"===t||"polyline"===t?("polygon"===t?"g:":"l:")+(a.points||"")+"|t:"+tr:"line"===t?"line:"+[a.x1||0,a.y1||0,a.x2||0,a.y2||0].join(",")+"|t:"+tr:null}function _hasFillOnly(attrs){if(!attrs)return!1;var f=attrs.fill,s=attrs.stroke;return f&&"none"!==f&&!(s&&"none"!==s)}function _hasStrokeOnly(attrs){if(!attrs)return!1;var f=attrs.fill,s=attrs.stroke;return!(f&&"none"!==f)&&(s&&"none"!==s)}function mergeFillStrokePairs(node){if(node&&node.children&&node.children.length){for(var buckets={},i=0;i<node.children.length;i++){var ch=node.children[i];"g"!==ch.type&&"svg"!==ch.type&&"root"!==ch.type||mergeFillStrokePairs(ch);var key=_geomKey(ch);key&&(buckets[key]||(buckets[key]=[]),buckets[key].push(ch))}for(var k in buckets){var arr=buckets[k];if(arr&&!(arr.length<2)){for(var fillNode=null,strokeNode=null,j=0;j<arr.length;j++){var n=arr[j];!fillNode&&_hasFillOnly(n.attrs)&&(fillNode=n),!strokeNode&&_hasStrokeOnly(n.attrs)&&(strokeNode=n)}if(fillNode&&strokeNode){var base=fillNode,donor=strokeNode;base.attrs.stroke=donor.attrs.stroke,void 0!==donor.attrs["stroke-width"]&&(base.attrs["stroke-width"]=donor.attrs["stroke-width"]),void 0!==donor.attrs["stroke-opacity"]&&(base.attrs["stroke-opacity"]=donor.attrs["stroke-opacity"]),void 0!==donor.attrs["stroke-dasharray"]&&(base.attrs["stroke-dasharray"]=donor.attrs["stroke-dasharray"]),void 0!==donor.attrs["stroke-dashoffset"]&&(base.attrs["stroke-dashoffset"]=donor.attrs["stroke-dashoffset"]),donor.__remove=!0}}}for(var filtered=[],m=0;m<node.children.length;m++){var ch2=node.children[m];ch2.__remove||filtered.push(ch2)}node.children=filtered;var rectEntries=buildEntries("rect"),ellipseEntries=buildEntries("ellipse"),circleEntries=buildEntries("circle");mergeForTypeEntries(rectEntries,"rect"),mergeForTypeEntries(ellipseEntries,"ellipse"),mergeForTypeEntries(circleEntries,"circle"),mergeIdenticalFillShapes(rectEntries,function(a,b){var ax=parseFloat(a.attrs.x||0),ay=parseFloat(a.attrs.y||0),aw=parseFloat(a.attrs.width||0),ah=parseFloat(a.attrs.height||0),arx=parseFloat(a.attrs.rx||0),ary=parseFloat(a.attrs.ry||0),bx=parseFloat(b.attrs.x||0),by=parseFloat(b.attrs.y||0),bw=parseFloat(b.attrs.width||0),bh=parseFloat(b.attrs.height||0),brx=parseFloat(b.attrs.rx||0),bry=parseFloat(b.attrs.ry||0);return nearly(ax,bx)&&nearly(ay,by)&&nearly(aw,bw)&&nearly(ah,bh)&&nearly(arx,brx)&&nearly(ary,bry)}),mergeIdenticalFillShapes(ellipseEntries,function(a,b){var acx=parseFloat(a.attrs.cx||0),acy=parseFloat(a.attrs.cy||0),arx=parseFloat(a.attrs.rx||0),ary=parseFloat(a.attrs.ry||0),bcx=parseFloat(b.attrs.cx||0),bcy=parseFloat(b.attrs.cy||0),brx=parseFloat(b.attrs.rx||0),bry=parseFloat(b.attrs.ry||0);return nearly(acx,bcx)&&nearly(acy,bcy)&&nearly(arx,brx)&&nearly(ary,bry)}),mergeIdenticalFillShapes(buildEntries("path"),function(a,b){var aD=(a.attrs.d||"").trim(),bD=(b.attrs.d||"").trim(),aTransform=(a.attrs.transform||"").trim(),bTransform=(b.attrs.transform||"").trim();return aD===bD&&aTransform===bTransform}),mergeIdenticalFillShapes(circleEntries=buildEntries("circle"),function(a,b){var acx=parseFloat(a.attrs.cx||0),acy=parseFloat(a.attrs.cy||0),ar=parseFloat(a.attrs.r||0),bcx=parseFloat(b.attrs.cx||0),bcy=parseFloat(b.attrs.cy||0),br=parseFloat(b.attrs.r||0),aTransform=(a.attrs.transform||"").trim(),bTransform=(b.attrs.transform||"").trim();return nearly(acx,bcx)&&nearly(acy,bcy)&&nearly(ar,br)&&aTransform===bTransform}),mergeIdenticalFillShapes(buildEntries("polygon"),arePolygonsIdentical),mergeIdenticalFillShapes(buildEntries("polyline"),arePolygonsIdentical),mergeIdenticalFillShapes(buildEntries("line"),function(a,b){var ax1=parseFloat(a.attrs.x1||0),ay1=parseFloat(a.attrs.y1||0),ax2=parseFloat(a.attrs.x2||0),ay2=parseFloat(a.attrs.y2||0),bx1=parseFloat(b.attrs.x1||0),by1=parseFloat(b.attrs.y1||0),bx2=parseFloat(b.attrs.x2||0),by2=parseFloat(b.attrs.y2||0);return nearly(ax1,bx1)&&nearly(ay1,by1)&&nearly(ax2,bx2)&&nearly(ay2,by2)}),mergeIdenticalFillShapes(buildEntries("text"),function(a,b){var ax=parseFloat(a.attrs.x||0),ay=parseFloat(a.attrs.y||0),bx=parseFloat(b.attrs.x||0),by=parseFloat(b.attrs.y||0);if(!nearly(ax,bx)||!nearly(ay,by))return!1;if((a.attrs.transform||"").trim()!==(b.attrs.transform||"").trim())return!1;function getTextContent(node){if(node.tspans&&node.tspans.length>0){for(var content="",i=0;i<node.tspans.length;i++){var tspan=node.tspans[i];content+=(tspan.x||0)+","+(tspan.y||0)+":"+(tspan.text||"")+"|"}return content}if(node.children&&node.children.length>0){for(var contentFromChildren="",j=0;j<node.children.length;j++){var child=node.children[j];if("tspan"===child.type){var tspanX=child.attrs&&child.attrs.x||"",tspanY=child.attrs&&child.attrs.y||"",tspanText=child.text||"";if(!tspanText&&child.children)for(var ti=0;ti<child.children.length;ti++){var tc=child.children[ti];tc.text&&(tspanText+=tc.text)}contentFromChildren+=tspanX+","+tspanY+":"+tspanText+"|"}}if(contentFromChildren)return contentFromChildren}return node.text||""}var aContent=getTextContent(a),bContent=getTextContent(b);return(""!==aContent||""!==bContent)&&aContent===bContent}),function pruneRemovedRecursively(n){if(n&&n.children){for(var keep=[],ii=0;ii<n.children.length;ii++){var ch=n.children[ii];ch&&!ch.__remove&&keep.push(ch)}n.children=keep;for(var jj=0;jj<n.children.length;jj++)pruneRemovedRecursively(n.children[jj])}}(node)}function nearly(a,b){return Math.abs((parseFloat(a)||0)-(parseFloat(b)||0))<=1}function tryMergeRectPair(fillRect,strokeRect){var fx=parseFloat(fillRect.attrs.x||0),fy=parseFloat(fillRect.attrs.y||0),fw=parseFloat(fillRect.attrs.width||0),fh=parseFloat(fillRect.attrs.height||0),sx=parseFloat(strokeRect.attrs.x||0),sy=parseFloat(strokeRect.attrs.y||0),sw=parseFloat(strokeRect.attrs.width||0),sh=parseFloat(strokeRect.attrs.height||0),w=parseFloat(strokeRect.attrs["stroke-width"]||0);if(!(w>0))return!1;var inner=nearly(sx,fx+w/2)&&nearly(sy,fy+w/2)&&nearly(sw,fw-w)&&nearly(sh,fh-w),outer=nearly(sx,fx-w/2)&&nearly(sy,fy-w/2)&&nearly(sw,fw+w)&&nearly(sh,fh+w);return!(!inner&&!outer)&&(fillRect.attrs.stroke=strokeRect.attrs.stroke,void 0!==strokeRect.attrs["stroke-width"]&&(fillRect.attrs["stroke-width"]=strokeRect.attrs["stroke-width"]),void 0!==strokeRect.attrs["stroke-opacity"]&&(fillRect.attrs["stroke-opacity"]=strokeRect.attrs["stroke-opacity"]),fillRect.attrs._stroke_align=inner?"inner":"outer",strokeRect.__remove=!0,!0)}function tryMergeEllipsePair(fillEl,strokeEl){var fcx=parseFloat(fillEl.attrs.cx||0),fcy=parseFloat(fillEl.attrs.cy||0),frx=parseFloat(fillEl.attrs.rx||0),fry=parseFloat(fillEl.attrs.ry||0),scx=parseFloat(strokeEl.attrs.cx||0),scy=parseFloat(strokeEl.attrs.cy||0),srx=parseFloat(strokeEl.attrs.rx||0),sry=parseFloat(strokeEl.attrs.ry||0),w=parseFloat(strokeEl.attrs["stroke-width"]||0);if(!(w>0))return!1;var inner=nearly(scx,fcx)&&nearly(scy,fcy)&&nearly(srx,frx-w/2)&&nearly(sry,fry-w/2),outer=nearly(scx,fcx)&&nearly(scy,fcy)&&nearly(srx,frx+w/2)&&nearly(sry,fry+w/2);return!(!inner&&!outer)&&(fillEl.attrs.stroke=strokeEl.attrs.stroke,void 0!==strokeEl.attrs["stroke-width"]&&(fillEl.attrs["stroke-width"]=strokeEl.attrs["stroke-width"]),void 0!==strokeEl.attrs["stroke-opacity"]&&(fillEl.attrs["stroke-opacity"]=strokeEl.attrs["stroke-opacity"]),fillEl.attrs._stroke_align=inner?"inner":"outer",strokeEl.__remove=!0,!0)}function tryMergeCirclePair(fillEl,strokeEl){var fcx=parseFloat(fillEl.attrs.cx||0),fcy=parseFloat(fillEl.attrs.cy||0),fr=parseFloat(fillEl.attrs.r||0),scx=parseFloat(strokeEl.attrs.cx||0),scy=parseFloat(strokeEl.attrs.cy||0),sr=parseFloat(strokeEl.attrs.r||0),w=parseFloat(strokeEl.attrs["stroke-width"]||0);if(!(w>0))return!1;var inner=nearly(scx,fcx)&&nearly(scy,fcy)&&nearly(sr,fr-w/2),outer=nearly(scx,fcx)&&nearly(scy,fcy)&&nearly(sr,fr+w/2);return!(!inner&&!outer)&&(fillEl.attrs.stroke=strokeEl.attrs.stroke,void 0!==strokeEl.attrs["stroke-width"]&&(fillEl.attrs["stroke-width"]=strokeEl.attrs["stroke-width"]),void 0!==strokeEl.attrs["stroke-opacity"]&&(fillEl.attrs["stroke-opacity"]=strokeEl.attrs["stroke-opacity"]),fillEl.attrs._stroke_align=inner?"inner":"outer",strokeEl.__remove=!0,!0)}function buildEntries(kind){for(var out=[],ci=0;ci<node.children.length;ci++){var c=node.children[ci];if(c.type!==kind){if("g"===c.type)if(!(c.attrs&&c.attrs.transform||""))for(var cj=0;cj<c.children.length;cj++){var cc=c.children[cj];cc&&cc.type===kind&&out.push({node:cc,holder:c})}}else out.push({node:c,holder:node})}return out}function mergeForTypeEntries(entries,kind){for(var i=0;i<entries.length;i++){var aEnt=entries[i];if(aEnt&&aEnt.node&&!aEnt.node.__remove){var a=aEnt.node;if(_hasFillOnly(a.attrs))for(var j=0;j<entries.length;j++)if(i!==j){var bEnt=entries[j];if(bEnt&&bEnt.node&&!bEnt.node.__remove){var b=bEnt.node;if(_hasStrokeOnly(b.attrs)){if("rect"===kind?tryMergeRectPair(a,b):"circle"===kind?tryMergeCirclePair(a,b):tryMergeEllipsePair(a,b))break}}}}}}function arePolygonsIdentical(a,b){var aPoints=(a.attrs.points||"").trim(),bPoints=(b.attrs.points||"").trim(),aTransform=(a.attrs.transform||"").trim(),bTransform=(b.attrs.transform||"").trim();return aPoints===bPoints&&aTransform===bTransform}function hasMergeableFill(attrs){var fill=attrs.fill||"";return 0===fill.indexOf("url(")||(!(!fill||"none"===fill)||!!attrs["data-figma-gradient-fill"])}function mergeIdenticalFillShapes(entries,isIdenticalFn){for(var groups=[],used={},i=0;i<entries.length;i++)if(!used[i]){var aEnt=entries[i];if(aEnt&&aEnt.node&&!aEnt.node.__remove){var a=aEnt.node;if(hasMergeableFill(a.attrs)){var group=[{idx:i,node:a,holder:aEnt.holder}];used[i]=!0;for(var j=i+1;j<entries.length;j++)if(!used[j]){var bEnt=entries[j];if(bEnt&&bEnt.node&&!bEnt.node.__remove){var b=bEnt.node;hasMergeableFill(b.attrs)&&aEnt.holder===bEnt.holder&&isIdenticalFn(a,b)&&(group.push({idx:j,node:b,holder:bEnt.holder}),used[j]=!0)}}group.length>1&&groups.push(group)}}}function isGradientSimulationFill(fill){if(!fill||"string"!=typeof fill)return!1;var match=/url\(#([^)]+)\)/.exec(fill);if(!match)return!1;var gradId=match[1].toLowerCase();return-1!==gradId.indexOf("_diamond_")||-1!==gradId.indexOf("_angular_")}for(var gi=0;gi<groups.length;gi++){for(var g=groups[gi],primary=g[0].node,allAreGradientSimulation=!0,gsi=0;gsi<g.length;gsi++){var gNode=g[gsi].node;if(!isGradientSimulationFill(gNode.attrs&&gNode.attrs.fill)){allAreGradientSimulation=!1;break}}if(allAreGradientSimulation)for(var gri=0;gri<g.length;gri++)g[gri].node.__remove=!0;else{primary.attrs._additionalFills||(primary.attrs._additionalFills=[]);for(var si=1;si<g.length;si++){var secondaryEntry=g[si],secondary=secondaryEntry.node,secondaryHolder=secondaryEntry.holder,fillInfo={fill:secondary.attrs.fill,fillOpacity:secondary.attrs["fill-opacity"]||"1",opacity:secondary.attrs.opacity||"1"};secondary.attrs["data-figma-gradient-fill"]&&(fillInfo["data-figma-gradient-fill"]=secondary.attrs["data-figma-gradient-fill"]),primary.attrs._additionalFills.push(fillInfo),secondary.attrs._inheritedFilterId&&!primary.attrs._inheritedFilterId&&(primary.attrs._inheritedFilterId=secondary.attrs._inheritedFilterId),secondary.attrs.filter&&!primary.attrs.filter&&(primary.attrs.filter=secondary.attrs.filter),secondaryHolder&&secondaryHolder.attrs&&secondaryHolder.attrs.filter&&!primary.attrs.filter&&(primary.attrs.filter=secondaryHolder.attrs.filter),secondary.__remove=!0}}}}}function extractViewBox(svg){var m=svg.match(/<svg[^>]*>/);if(!m)return null;var open=m[0],vb=extractAttribute(open,"viewBox"),widthAttr=extractAttribute(open,"width"),heightAttr=extractAttribute(open,"height");if(vb){var vals=vb.split(/[ ,]+/);if(4===vals.length)return{x:parseFloat(vals[0]),y:parseFloat(vals[1]),width:parseFloat(vals[2]),height:parseFloat(vals[3])}}return{x:0,y:0,width:widthAttr?parseFloat((""+widthAttr).replace("px","")):1e3,height:heightAttr?parseFloat((""+heightAttr).replace("px","")):1e3}}function svgToCavalryPosition(xSvg,ySvg,vb){return{x:xSvg-(vb.x+vb.width/2),y:vb.y+vb.height/2-ySvg}}function applyFillAndStroke(layerId,attrs){try{var fill=attrs.fill||attrs.style&&extractStyleProperty(attrs.style,"fill"),fillOpacity=attrs["fill-opacity"]||extractStyleProperty(attrs.style,"fill-opacity"),opacity=attrs.opacity||extractStyleProperty(attrs.style,"opacity"),stroke=attrs.stroke||attrs.style&&extractStyleProperty(attrs.style,"stroke"),strokeWidth=attrs["stroke-width"]||attrs.style&&extractStyleProperty(attrs.style,"stroke-width"),strokeOpacity=attrs["stroke-opacity"]||attrs.style&&extractStyleProperty(attrs.style,"stroke-opacity"),strokeDashArray=attrs["stroke-dasharray"]||attrs.style&&extractStyleProperty(attrs.style,"stroke-dasharray"),strokeDashOffset=attrs["stroke-dashoffset"]||attrs.style&&extractStyleProperty(attrs.style,"stroke-dashoffset"),strokeLinecap=attrs["stroke-linecap"]||attrs.style&&extractStyleProperty(attrs.style,"stroke-linecap"),strokeLinejoin=attrs["stroke-linejoin"]||attrs.style&&extractStyleProperty(attrs.style,"stroke-linejoin"),inheritedOpacity=parseFloat(attrs._inheritedOpacity);isNaN(inheritedOpacity)&&(inheritedOpacity=1);var gradientId=extractUrlRefId(fill),strokeGradientId=extractUrlRefId(stroke),figmaGradientFill=attrs["data-figma-gradient-fill"];if(figmaGradientFill&&!gradientId)try{var decodedJson=figmaGradientFill.replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),figmaGradData=JSON.parse(decodedJson);if("GRADIENT_ANGULAR"===figmaGradData.type)createSweepGradientFromFigma(figmaGradData,layerId,attrs)&&(gradientId="__figma_angular__");if("GRADIENT_DIAMOND"===figmaGradData.type)createDiamondGradientFromFigma(figmaGradData,layerId,attrs)&&(gradientId="__figma_diamond__")}catch(eFigmaGrad){console.warn("[ANGULAR GRADIENT] Failed to parse Figma gradient data: "+eFigmaGrad.message)}if(fill&&"none"!==fill){api.setFill(layerId,!0);var fo=parseOpacityValue(fillOpacity);null===fo&&(fo=1);var o=parseOpacityValue(opacity);null===o&&(o=1);var shapeOpacity=clamp01(o*inheritedOpacity),fillAlpha=fo;if(shapeOpacity<.999){var shapeOpacityPercent=Math.round(100*shapeOpacity);try{api.set(layerId,{opacity:shapeOpacityPercent})}catch(eShapeOp){}}if(gradientId){try{api.set(layerId,{"material.materialColor.a":0})}catch(e0){}var svgShapeCenter=null;try{if(void 0!==attrs._localCenterX&&void 0!==attrs._localCenterY)svgShapeCenter={x:attrs._localCenterX,y:attrs._localCenterY};else if(void 0!==attrs._transformedCenterX&&void 0!==attrs._transformedCenterY)svgShapeCenter={x:attrs._transformedCenterX,y:attrs._transformedCenterY};else if(void 0!==attrs._pathSvgCenterX&&void 0!==attrs._pathSvgCenterY)svgShapeCenter={x:attrs._pathSvgCenterX,y:attrs._pathSvgCenterY};else if(void 0!==attrs.x&&void 0!==attrs.width){var rectX=parseFloat(attrs.x||"0"),rectY=parseFloat(attrs.y||"0");svgShapeCenter={x:rectX+parseFloat(attrs.width||"0")/2,y:rectY+parseFloat(attrs.height||"0")/2}}else void 0!==attrs.cx&&void 0!==attrs.cy?svgShapeCenter={x:parseFloat(attrs.cx),y:parseFloat(attrs.cy)}:void 0===attrs.r&&void 0===attrs.rx||(svgShapeCenter={x:parseFloat(attrs.cx||"0"),y:parseFloat(attrs.cy||"0")})}catch(eSvgCenter){}var shapeScaleY=void 0!==attrs._scaleY?attrs._scaleY:1,shapeRotationDeg=void 0!==attrs._rotationDeg?attrs._rotationDeg:0,shaderOk=!1;try{var sh=getGradientShader(gradientId);sh&&(shaderOk=connectShaderToShape(sh,layerId,svgShapeCenter,fillAlpha,shapeScaleY,shapeRotationDeg))}catch(eSh){}if(!shaderOk&&__svgPatternMap&&__svgPatternMap[gradientId])try{var pid=gradientId,shaderName="Image Shader";try{var shapeName=api.getNiceName(layerId)||"";if(shapeName&&"Shape"!==shapeName&&"Path"!==shapeName)shaderName=shapeName;else{var parentId=api.getParent(layerId);if(parentId){var parentName=api.getNiceName(parentId)||"";parentName&&(shaderName=parentName)}}shaderName=shaderName+"_"+ ++__imageCounter}catch(eGetName){shaderName="Image Shader "+pid}try{__lastPatternOrImageName=shaderName}catch(eNm){}if(importImageryEnabled){var shaderNode=__patternImageShaderCache[pid]||api.create("imageShader",shaderName);if(shaderNode){var meta=__svgPatternMap[pid]&&__svgPatternMap[pid].image,target=meta&&meta.href?meta.href:null,saved=target?_resolveImageHrefToAsset(target,{attrs:{id:shaderName}}):null,linkVal=saved||target;if(linkVal){var assetId=null;try{saved&&api.loadAsset&&(assetId=api.loadAsset(saved,!1))}catch(eLoad){assetId=null}if(!assetId)try{saved&&api.importAsset&&(assetId=api.importAsset(saved))}catch(eImp){assetId=null}var connected=!1;if(assetId){try{api.connect(assetId,"id",shaderNode,"image"),connected=!0}catch(eConA){connected=!1}try{connected||console.error("[Quiver] Failed to connect asset to imageShader.image")}catch(eLog1){}
// Parent the asset under the Quiver group in Assets Window
var quiverGroup=_ensureQuiverAssetGroup();if(quiverGroup&&api.parent)try{api.parent(assetId,quiverGroup)}catch(eParent){}}if(!connected)_setFirstSupported(shaderNode,["image","generator.image","file","path","source","uri","image.uri","image.path"],linkVal)}try{api.connect(shaderNode,"id",layerId,"material.colorShaders")}catch(eConn){}try{api.getParent(shaderNode)||api.parent(shaderNode,layerId)}catch(ePar){}try{var imgShaderAlpha=Math.round(100*fillAlpha);api.set(shaderNode,{alpha:imgShaderAlpha})}catch(eImgAlpha){}try{try{_hasAttr(shaderNode,"legacyGraph")&&api.set(shaderNode,{legacyGraph:!1})}catch(eLG){}var patternData=__svgPatternMap[pid],useTransform=patternData&&patternData.useTransform,isObjectBoundingBox=patternData&&patternData.attrs&&"objectBoundingBox"===patternData.attrs.patternContentUnits;if(useTransform&&isObjectBoundingBox){var smSet=!1;try{api.set(shaderNode,{scaleMode:0}),smSet=!0}catch(eSM0){smSet=!1}if(!smSet)try{api.set(shaderNode,{"generator.scaleMode":0})}catch(eSM0b){}var shapeW=100,shapeH=100;try{var bbox=api.getBoundingBox(layerId,!0);bbox&&(shapeW=bbox.width||100,shapeH=bbox.height||100)}catch(eBB){try{var dims=api.get(layerId,"generator.dimensions");dims&&dims.length>=2&&(shapeW=dims[0]||100,shapeH=dims[1]||100)}catch(eDims){}}var imgMeta=patternData.image,imgW=parseFloat(imgMeta&&imgMeta.width)||100,imgH=parseFloat(imgMeta&&imgMeta.height)||100;_setFirstSupported(shaderNode,["scale","generator.scale"],[useTransform.a*shapeW,useTransform.d*shapeH]);var visibleW=useTransform.a*imgW*shapeW,visibleH=useTransform.d*imgH*shapeH;_setFirstSupported(shaderNode,["offset","generator.offset"],[useTransform.e*shapeW+visibleW/2-shapeW/2,-(useTransform.f*shapeH+visibleH/2-shapeH/2)])}else{for(var modes=[4,3,2,1],setDone=!1,mi=0;mi<modes.length&&!setDone;mi++){try{api.set(shaderNode,{scaleMode:modes[mi]}),setDone=!0}catch(eSMA){setDone=!1}if(!setDone)try{api.set(shaderNode,{"generator.scaleMode":modes[mi]}),setDone=!0}catch(eSMB){setDone=!1}}_setFirstSupported(shaderNode,["offset","generator.offset"],[0,0])}try{api.set(shaderNode,{tilingX:3})}catch(eTX1){try{api.set(shaderNode,{"generator.tilingX":3})}catch(eTX2){}}try{api.set(shaderNode,{tilingY:3})}catch(eTY1){try{api.set(shaderNode,{"generator.tilingY":3})}catch(eTY2){}}var fqOk=!1;try{api.set(shaderNode,{filterQuality:imageFilterQuality}),fqOk=!0}catch(eFQ1){fqOk=!1}if(!fqOk)try{api.set(shaderNode,{"generator.filterQuality":imageFilterQuality})}catch(eFQ2){}}catch(eAlign){}__patternImageShaderCache[pid]=shaderNode}}else;}catch(eImgPat){}}else{var color=parseColor(fill)||"#000000";if(attrs._additionalFills&&attrs._additionalFills.length>0)try{var primaryColorShaderName="Fill 1 "+color.toUpperCase(),primaryColorShaderId=api.create("colorShader",primaryColorShaderName);if(primaryColorShaderId){var hexCleanP=color.replace("#",""),rValP=parseInt(hexCleanP.substring(0,2),16)||0,gValP=parseInt(hexCleanP.substring(2,4),16)||0,bValP=parseInt(hexCleanP.substring(4,6),16)||0,aValP=Math.round(255*fillAlpha);api.set(primaryColorShaderId,{"shaderColor.r":rValP,"shaderColor.g":gValP,"shaderColor.b":bValP,"shaderColor.a":aValP}),api.set(primaryColorShaderId,{alpha:Math.round(100*fillAlpha)}),api.connect(primaryColorShaderId,"id",layerId,"material.colorShaders");try{api.parent(primaryColorShaderId,layerId)}catch(eParP){}}}catch(ePrimaryShader){api.set(layerId,{"material.materialColor":color,"material.alpha":Math.round(100*fillAlpha)})}else api.set(layerId,{"material.materialColor":color,"material.alpha":Math.round(100*fillAlpha)})}}else"__figma_angular__"===gradientId||"__figma_diamond__"===gradientId||api.setFill(layerId,!1);if(attrs._additionalFills&&attrs._additionalFills.length>0){var svgShapeCenterMulti=null;try{if(void 0!==attrs._localCenterX&&void 0!==attrs._localCenterY)svgShapeCenterMulti={x:attrs._localCenterX,y:attrs._localCenterY};else if(void 0!==attrs._transformedCenterX&&void 0!==attrs._transformedCenterY)svgShapeCenterMulti={x:attrs._transformedCenterX,y:attrs._transformedCenterY};else if(void 0!==attrs._pathSvgCenterX&&void 0!==attrs._pathSvgCenterY)svgShapeCenterMulti={x:attrs._pathSvgCenterX,y:attrs._pathSvgCenterY};else if(void 0!==attrs.x&&void 0!==attrs.width){var rectXM=parseFloat(attrs.x||"0"),rectYM=parseFloat(attrs.y||"0");svgShapeCenterMulti={x:rectXM+parseFloat(attrs.width||"0")/2,y:rectYM+parseFloat(attrs.height||"0")/2}}else void 0!==attrs.cx&&void 0!==attrs.cy&&(svgShapeCenterMulti={x:parseFloat(attrs.cx),y:parseFloat(attrs.cy)})}catch(eSvgCenterM){}for(var afi=0;afi<attrs._additionalFills.length;afi++){var addFillInfo=attrs._additionalFills[afi],addFillValue="object"==typeof addFillInfo?addFillInfo.fill:addFillInfo,addFillOpacity="object"==typeof addFillInfo?parseFloat(addFillInfo.fillOpacity||"1"):1,addEffectiveOpacity=clamp01(addFillOpacity*("object"==typeof addFillInfo?parseFloat(addFillInfo.opacity||"1"):1)),addFigmaGradFill="object"==typeof addFillInfo?addFillInfo["data-figma-gradient-fill"]:null;if(addFigmaGradFill)try{var decodedJsonAdd=addFigmaGradFill.replace(/&#34;/g,'"').replace(/&#39;/g,"'").replace(/&quot;/g,'"').replace(/&apos;/g,"'").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&"),figmaGradDataAdd=JSON.parse(decodedJsonAdd);if("GRADIENT_ANGULAR"===figmaGradDataAdd.type)createSweepGradientFromFigma(figmaGradDataAdd,layerId,attrs);if("GRADIENT_DIAMOND"===figmaGradDataAdd.type)createDiamondGradientFromFigma(figmaGradDataAdd,layerId,attrs);continue}catch(eFigmaGradAdd){}var addFillId=extractUrlRefId(addFillValue);if(addFillId){var addShaderConnected=!1;try{var addGradShader=getGradientShader(addFillId);if(addGradShader){connectShaderToShape(addGradShader,layerId,svgShapeCenterMulti),addShaderConnected=!0;var gradAlphaPercent=Math.round(100*addFillOpacity);try{api.set(addGradShader,{alpha:gradAlphaPercent})}catch(eGradAlpha){}}}catch(eAddGrad){}if(!addShaderConnected&&__svgPatternMap&&__svgPatternMap[addFillId])try{var addPid=addFillId,addShaderName=api.getNiceName(layerId)+"_"+(afi+2);addShaderName=addShaderName+"_"+ ++__imageCounter;var addCached=__patternImageShaderCache[addPid],addShaderNode=addCached||api.create("imageShader",addShaderName);if(addShaderNode&&!addCached){var addMeta=__svgPatternMap[addPid]&&__svgPatternMap[addPid].image,addTarget=addMeta&&addMeta.href?addMeta.href:null,addSaved=addTarget?_resolveImageHrefToAsset(addTarget,{attrs:{id:addShaderName}}):null;if(addSaved||addTarget){var addAssetId=null;try{addSaved&&api.loadAsset&&(addAssetId=api.loadAsset(addSaved,!1))}catch(eLoad2){addAssetId=null}if(!addAssetId)try{addSaved&&api.importAsset&&(addAssetId=api.importAsset(addSaved))}catch(eImp2){addAssetId=null}if(addAssetId){try{api.connect(addAssetId,"id",addShaderNode,"image")}catch(eConA2){}var quiverGroup2=_ensureQuiverAssetGroup();if(quiverGroup2&&api.parent)try{api.parent(addAssetId,quiverGroup2)}catch(eParent2){}}}try{api.connect(addShaderNode,"id",layerId,"material.colorShaders")}catch(eConn2){}try{api.getParent(addShaderNode)||api.parent(addShaderNode,layerId)}catch(ePar2){}try{var addImgAlphaPercent=Math.round(100*addFillOpacity);api.set(addShaderNode,{alpha:addImgAlphaPercent})}catch(eAddImgAlpha){}try{try{_hasAttr(addShaderNode,"legacyGraph")&&api.set(addShaderNode,{legacyGraph:!1})}catch(eLG2){}var addPatternData=__svgPatternMap[addPid],addUseTransform=addPatternData&&addPatternData.useTransform,addIsObjectBoundingBox=addPatternData&&addPatternData.attrs&&"objectBoundingBox"===addPatternData.attrs.patternContentUnits;if(addUseTransform&&addIsObjectBoundingBox){var addSmSet=!1;try{api.set(addShaderNode,{scaleMode:0}),addSmSet=!0}catch(eSM02){addSmSet=!1}if(!addSmSet)try{api.set(addShaderNode,{"generator.scaleMode":0})}catch(eSM0b2){}var addShapeW=100,addShapeH=100;try{var addBbox=api.getBoundingBox(layerId,!0);addBbox&&(addShapeW=addBbox.width||100,addShapeH=addBbox.height||100)}catch(eBB2){try{var addDims=api.get(layerId,"generator.dimensions");addDims&&addDims.length>=2&&(addShapeW=addDims[0]||100,addShapeH=addDims[1]||100)}catch(eDims2){}}var addImgMeta=addPatternData.image,addImgW=parseFloat(addImgMeta&&addImgMeta.width)||100,addImgH=parseFloat(addImgMeta&&addImgMeta.height)||100;_setFirstSupported(addShaderNode,["scale","generator.scale"],[addUseTransform.a*addShapeW,addUseTransform.d*addShapeH]);var addVisibleW=addUseTransform.a*addImgW*addShapeW,addVisibleH=addUseTransform.d*addImgH*addShapeH;_setFirstSupported(addShaderNode,["offset","generator.offset"],[addUseTransform.e*addShapeW+addVisibleW/2-addShapeW/2,-(addUseTransform.f*addShapeH+addVisibleH/2-addShapeH/2)])}else{for(var addModes=[4,3,2,1],addSetDone=!1,ami=0;ami<addModes.length&&!addSetDone;ami++){try{api.set(addShaderNode,{scaleMode:addModes[ami]}),addSetDone=!0}catch(eSMA2){}if(!addSetDone)try{api.set(addShaderNode,{"generator.scaleMode":addModes[ami]}),addSetDone=!0}catch(eSMB2){}}_setFirstSupported(addShaderNode,["offset","generator.offset"],[0,0])}try{api.set(addShaderNode,{tilingX:3})}catch(eTX12){try{api.set(addShaderNode,{"generator.tilingX":3})}catch(eTX22){}}try{api.set(addShaderNode,{tilingY:3})}catch(eTY12){try{api.set(addShaderNode,{"generator.tilingY":3})}catch(eTY22){}}var addFqOk=!1;try{api.set(addShaderNode,{filterQuality:imageFilterQuality}),addFqOk=!0}catch(eFQ12){}if(!addFqOk)try{api.set(addShaderNode,{"generator.filterQuality":imageFilterQuality})}catch(eFQ22){}}catch(eAddAlign){}__patternImageShaderCache[addPid]=addShaderNode}else if(addCached)try{api.connect(addCached,"id",layerId,"material.colorShaders")}catch(eConnCached){}}catch(eAddPat){}}else if(addFillValue&&"none"!==addFillValue)try{var colorShaderName="Fill "+(afi+2)+" "+(parseColor(addFillValue)||"#000000").toUpperCase(),colorShaderId=api.create("colorShader",colorShaderName);if(colorShaderId){var hexClean=(parseColor(addFillValue)||"#000000").replace("#",""),rVal=parseInt(hexClean.substring(0,2),16)||0,gVal=parseInt(hexClean.substring(2,4),16)||0,bVal=parseInt(hexClean.substring(4,6),16)||0,aVal=Math.round(255*addEffectiveOpacity);try{api.set(colorShaderId,{"shaderColor.r":rVal,"shaderColor.g":gVal,"shaderColor.b":bVal,"shaderColor.a":aVal})}catch(eSetColor){}var alphaPercent=Math.round(100*addEffectiveOpacity);try{api.set(colorShaderId,{alpha:alphaPercent})}catch(eA1){}try{api.connect(colorShaderId,"id",layerId,"material.colorShaders")}catch(eConnColor){}try{api.parent(colorShaderId,layerId)}catch(eParColor){}}}catch(eColorShader){}}}if(stroke&&"none"!==stroke){api.setStroke(layerId,!0);var scolor=parseColor(stroke)||"#000000",sw=parseFloat((""+(strokeWidth||"1")).replace("px",""));isNaN(sw)&&(sw=1);var so=parseOpacityValue(strokeOpacity);null===so&&(so=1);var o2=parseOpacityValue(opacity);null===o2&&(o2=1);var effA=clamp01(so*o2*inheritedOpacity);if(strokeGradientId){api.set(layerId,{"stroke.strokeColor":scolor,"stroke.strokeColor.a":0,"stroke.width":sw,"stroke.alpha":Math.round(100*effA)});var shStroke=getGradientShader(strokeGradientId);if(shStroke){var svgShapeCenterStroke=null;try{if(void 0!==attrs._localCenterX&&void 0!==attrs._localCenterY)svgShapeCenterStroke={x:attrs._localCenterX,y:attrs._localCenterY};else if(void 0!==attrs._transformedCenterX&&void 0!==attrs._transformedCenterY)svgShapeCenterStroke={x:attrs._transformedCenterX,y:attrs._transformedCenterY};else if(void 0!==attrs._pathSvgCenterX&&void 0!==attrs._pathSvgCenterY)svgShapeCenterStroke={x:attrs._pathSvgCenterX,y:attrs._pathSvgCenterY};else if(void 0!==attrs.x&&void 0!==attrs.width){var rectXS=parseFloat(attrs.x||"0"),rectYS=parseFloat(attrs.y||"0");svgShapeCenterStroke={x:rectXS+parseFloat(attrs.width||"0")/2,y:rectYS+parseFloat(attrs.height||"0")/2}}else void 0!==attrs.cx&&void 0!==attrs.cy&&(svgShapeCenterStroke={x:parseFloat(attrs.cx),y:parseFloat(attrs.cy)})}catch(eSvgCenterS){}connectShaderToStroke(shStroke,layerId,svgShapeCenterStroke)}}else api.set(layerId,{"stroke.strokeColor":scolor,"stroke.width":sw,"stroke.alpha":Math.round(100*effA)});if(strokeLinecap){var capStyle=-1;switch(strokeLinecap.toLowerCase()){case"butt":capStyle=0;break;case"round":capStyle=1;break;case"square":capStyle=2}if(capStyle>=0)try{api.set(layerId,{"stroke.capStyle":capStyle})}catch(eCap){}}if(strokeLinejoin){var joinStyle=-1;switch(strokeLinejoin.toLowerCase()){case"miter":joinStyle=0;break;case"round":joinStyle=1;break;case"bevel":joinStyle=2}if(joinStyle>=0)try{api.set(layerId,{"stroke.joinStyle":joinStyle})}catch(eJoin){}}try{api.set(layerId,{"stroke.dashPatternMode":0})}catch(eDM2){}var csv=normalizeDashArrayToCsv(strokeDashArray);if(csv){try{api.set(layerId,{"stroke.dashPattern":csv})}catch(eDPs){try{api.get(layerId,"stroke.dashPattern")}catch(eGetDP){}try{api.set(layerId,{"stroke.dashPattern":csv})}catch(eDPs2){}}var doff=parseFloat((""+(strokeDashOffset||"0")).replace("px",""));if(!isNaN(doff))try{api.set(layerId,{"stroke.dashOffset":doff})}catch(eDO){}}if(attrs&&attrs._stroke_align){var align=attrs._stroke_align;try{var enumVal=0;"inner"===align?enumVal=1:"outer"===align&&(enumVal=2),api.set(layerId,{"stroke.align":enumVal})}catch(eAlign1){try{var label="inner"===align?"Inner":"outer"===align?"Outer":"Centre";api.set(layerId,{"stroke.align":label})}catch(eAlign2){}}}}else api.setStroke(layerId,!1)}catch(e){}}var __importedGroupIds=[];function resetImportedGroupIds(){__importedGroupIds=[]}function getImportedGroupIds(){return __importedGroupIds}function createGroup(name,parentId){var id=api.create("group",name);return parentId&&api.parent(id,parentId),__importedGroupIds.push(id),id}function _readNumber(tokens,idxObj){var v=parseFloat(tokens[idxObj.i++]);return isNaN(v)&&(v=0),v}function _tokenizePathData(d){if(!d)return[];var norm=d.replace(/,/g," ").replace(/([MmLlHhVvCcSsQqTtAaZz])/g," $1 ").trim();return(norm=norm.replace(/\s+/g," ")).split(" ")}function parsePathDataToAbsolute(d){var tokens=_tokenizePathData(d),iObj={i:0},segments=[],cmd=null,cx=0,cy=0,subx=0,suby=0,prevCpx=null,prevCpy=null,lastCmd=null;function readPoint(rel){var x=_readNumber(tokens,iObj),y=_readNumber(tokens,iObj);return rel&&(x+=cx,y+=cy),{x:x,y:y}}function reflect(px,py,cx0,cy0){return{x:2*cx0-px,y:2*cy0-py}}for(;iObj.i<tokens.length;){var t=tokens[iObj.i++];if(!t)break;if(/^[A-Za-z]$/.test(t)?cmd=t:iObj.i--,!cmd)break;var isRel=cmd===cmd.toLowerCase();switch(cmd.toUpperCase()){case"M":var p=readPoint(isRel);for(segments.push({cmd:"M",x:p.x,y:p.y}),cx=p.x,cy=p.y,subx=p.x,suby=p.y;iObj.i<tokens.length&&!/^[A-Za-z]$/.test(tokens[iObj.i]);){var p2=readPoint(isRel);segments.push({cmd:"L",x:p2.x,y:p2.y}),cx=p2.x,cy=p2.y}prevCpx=prevCpy=null,lastCmd="M";break;case"L":for(;iObj.i<tokens.length&&!/^[A-Za-z]$/.test(tokens[iObj.i]);){p=readPoint(isRel);segments.push({cmd:"L",x:p.x,y:p.y}),cx=p.x,cy=p.y}prevCpx=prevCpy=null,lastCmd="L";break;case"H":for(;iObj.i<tokens.length&&!/^[A-Za-z]$/.test(tokens[iObj.i]);){var x=_readNumber(tokens,iObj);isRel&&(x+=cx),segments.push({cmd:"L",x:x,y:cy}),cx=x}prevCpx=prevCpy=null,lastCmd="H";break;case"V":for(;iObj.i<tokens.length&&!/^[A-Za-z]$/.test(tokens[iObj.i]);){var y=_readNumber(tokens,iObj);isRel&&(y+=cy),segments.push({cmd:"L",x:cx,y:y}),cy=y}prevCpx=prevCpy=null,lastCmd="V";break;case"C":for(;iObj.i<tokens.length&&!/^[A-Za-z]$/.test(tokens[iObj.i]);){var cp1=readPoint(isRel),cp2=readPoint(isRel);p=readPoint(isRel);segments.push({cmd:"C",cp1x:cp1.x,cp1y:cp1.y,cp2x:cp2.x,cp2y:cp2.y,x:p.x,y:p.y}),prevCpx=cp2.x,prevCpy=cp2.y,cx=p.x,cy=p.y}lastCmd="C";break;case"S":for(;iObj.i<tokens.length&&!/^[A-Za-z]$/.test(tokens[iObj.i]);){var cp1x,cp1y;if("C"===lastCmd||"S"===lastCmd){var refl=reflect(null==prevCpx?cx:prevCpx,null==prevCpy?cy:prevCpy,cx,cy);cp1x=refl.x,cp1y=refl.y}else cp1x=cx,cp1y=cy;cp2=readPoint(isRel),p=readPoint(isRel);segments.push({cmd:"C",cp1x:cp1x,cp1y:cp1y,cp2x:cp2.x,cp2y:cp2.y,x:p.x,y:p.y}),prevCpx=cp2.x,prevCpy=cp2.y,cx=p.x,cy=p.y}lastCmd="S";break;case"Q":for(;iObj.i<tokens.length&&!/^[A-Za-z]$/.test(tokens[iObj.i]);){var cp=readPoint(isRel);p=readPoint(isRel);segments.push({cmd:"Q",cpx:cp.x,cpy:cp.y,x:p.x,y:p.y}),prevCpx=cp.x,prevCpy=cp.y,cx=p.x,cy=p.y}lastCmd="Q";break;case"T":for(;iObj.i<tokens.length&&!/^[A-Za-z]$/.test(tokens[iObj.i]);){var cpxT,cpyT;if("Q"===lastCmd||"T"===lastCmd){var r=reflect(null==prevCpx?cx:prevCpx,null==prevCpy?cy:prevCpy,cx,cy);cpxT=r.x,cpyT=r.y}else cpxT=cx,cpyT=cy;p=readPoint(isRel);segments.push({cmd:"Q",cpx:cpxT,cpy:cpyT,x:p.x,y:p.y}),prevCpx=cpxT,prevCpy=cpyT,cx=p.x,cy=p.y}lastCmd="T";break;case"A":for(;iObj.i<tokens.length&&!/^[A-Za-z]$/.test(tokens[iObj.i]);){var rx=_readNumber(tokens,iObj),ry=_readNumber(tokens,iObj),xAxisRot=_readNumber(tokens,iObj),largeArc=_readNumber(tokens,iObj),sweep=_readNumber(tokens,iObj);x=_readNumber(tokens,iObj),y=_readNumber(tokens,iObj);isRel&&(x+=cx,y+=cy),segments.push({cmd:"A",rx:rx,ry:ry,phi:xAxisRot,large:!!largeArc,sweep:!!sweep,x:x,y:y}),cx=x,cy=y}prevCpx=prevCpy=null,lastCmd="A";break;case"Z":segments.push({cmd:"Z"}),cx=subx,cy=suby,prevCpx=prevCpy=null,lastCmd="Z";break;default:iObj.i=tokens.length}}return segments}function createEditableFromPathSegments(segments,nodeName,parentId,vb,translate,attrs){var path=new cavalry.Path;function cvt(pt){return svgToCavalryPosition(pt.x+(translate?translate.x:0),pt.y+(translate?translate.y:0),vb)}function arcToCubics(cx0,cy0,rx,ry,phiDeg,largeArc,sweep,x1,y1){var phi=(phiDeg||0)*Math.PI/180,cosPhi=Math.cos(phi),sinPhi=Math.sin(phi),dx2=(cx0-x1)/2,dy2=(cy0-y1)/2,x1p=cosPhi*dx2+sinPhi*dy2,y1p=-sinPhi*dx2+cosPhi*dy2,lam=x1p*x1p/((rx=Math.abs(rx))*rx)+y1p*y1p/((ry=Math.abs(ry))*ry);if(lam>1){var s=Math.sqrt(lam);rx*=s,ry*=s}var rx2=rx*rx,ry2=ry*ry,num=rx2*ry2-rx2*y1p*y1p-ry2*x1p*x1p,den=rx2*y1p*y1p+ry2*x1p*x1p,coef=0===den?0:(largeArc===sweep?-1:1)*Math.sqrt(Math.max(0,num/den)),cxp=coef*(rx*y1p)/ry,cyp=coef*(-ry*x1p)/rx,cx=cosPhi*cxp-sinPhi*cyp+(cx0+x1)/2,cy=sinPhi*cxp+cosPhi*cyp+(cy0+y1)/2;function angle(u,v){var dot=u.x*v.x+u.y*v.y,len=Math.sqrt(u.x*u.x+u.y*u.y)*Math.sqrt(v.x*v.x+v.y*v.y),ang=Math.acos(Math.max(-1,Math.min(1,dot/len)));return u.x*v.y-u.y*v.x<0&&(ang=-ang),ang}var v1={x:(x1p-cxp)/rx,y:(y1p-cyp)/ry},v2={x:(-x1p-cxp)/rx,y:(-y1p-cyp)/ry},theta1=angle({x:1,y:0},v1),delta=angle(v1,v2);!sweep&&delta>0&&(delta-=2*Math.PI),sweep&&delta<0&&(delta+=2*Math.PI);for(var segs=Math.ceil(Math.abs(delta)/(Math.PI/2)),deltaSeg=delta/segs,res=[],i=0;i<segs;i++){var t1=theta1+i*deltaSeg,t2=t1+deltaSeg,cosT1=Math.cos(t1),sinT1=Math.sin(t1),cosT2=Math.cos(t2),sinT2=Math.sin(t2),e1x=cx+(cosPhi*rx*cosT1-sinPhi*ry*sinT1),e1y=cy+(sinPhi*rx*cosT1+cosPhi*ry*sinT1),e2x=cx+(cosPhi*rx*cosT2-sinPhi*ry*sinT2),e2y=cy+(sinPhi*rx*cosT2+cosPhi*ry*sinT2),alpha=4/3*Math.tan((t2-t1)/4),c1x=e1x-alpha*(cosPhi*rx*sinT1+sinPhi*ry*cosT1),c1y=e1y-alpha*(sinPhi*rx*sinT1-cosPhi*ry*cosT1),c2x=e2x+alpha*(cosPhi*rx*sinT2+sinPhi*ry*cosT2),c2y=e2y+alpha*(sinPhi*rx*sinT2-cosPhi*ry*cosT2);res.push({c1x:c1x,c1y:c1y,c2x:c2x,c2y:c2y,ex:e2x,ey:e2y})}return res}for(var i=0;i<segments.length;i++){var s=segments[i];if("M"===s.cmd){var p0=cvt({x:s.x,y:s.y});path.moveTo(p0.x,p0.y)}else if("L"===s.cmd){var p1=cvt({x:s.x,y:s.y});path.lineTo(p1.x,p1.y)}else if("C"===s.cmd){var c1=cvt({x:s.cp1x,y:s.cp1y}),c2=cvt({x:s.cp2x,y:s.cp2y}),pe=cvt({x:s.x,y:s.y});path.cubicTo(c1.x,c1.y,c2.x,c2.y,pe.x,pe.y)}else if("Q"===s.cmd){var cq=cvt({x:s.cpx,y:s.cpy}),pe2=cvt({x:s.x,y:s.y});path.quadTo(cq.x,cq.y,pe2.x,pe2.y)}else if("A"===s.cmd){try{path.boundingBox()}catch(e){}for(var cxCur=null,cyCur=null,j=i-1;j>=0;j--){var pj=segments[j];if("M"===pj.cmd||"L"===pj.cmd||"C"===pj.cmd||"Q"===pj.cmd){cxCur=pj.x,cyCur=pj.y;break}}null===cxCur&&(cxCur=s.x,cyCur=s.y);for(var cubs=arcToCubics(cxCur,cyCur,s.rx,s.ry,s.phi,s.large,s.sweep,s.x,s.y),ci=0;ci<cubs.length;ci++){var cc1=cvt({x:cubs[ci].c1x,y:cubs[ci].c1y}),cc2=cvt({x:cubs[ci].c2x,y:cubs[ci].c2y}),ee=cvt({x:cubs[ci].ex,y:cubs[ci].ey});path.cubicTo(cc1.x,cc1.y,cc2.x,cc2.y,ee.x,ee.y)}}else"Z"===s.cmd&&path.close()}var centre=null;try{var bb=path.boundingBox();bb&&bb.centre&&(centre={x:bb.centre.x,y:bb.centre.y})}catch(eBB){}centre&&path.translate(-centre.x,-centre.y);var id=api.createEditable(path,nodeName||"Path");if(parentId&&api.parent(id,parentId),centre&&api.set(id,{"position.x":centre.x,"position.y":centre.y}),attrs&&segments&&segments.length>0){for(var minX=1/0,minY=1/0,maxX=-1/0,maxY=-1/0,si=0;si<segments.length;si++){var seg=segments[si];if(void 0!==seg.x&&void 0!==seg.y){var px=seg.x+(translate?translate.x:0),py=seg.y+(translate?translate.y:0);px<minX&&(minX=px),py<minY&&(minY=py),px>maxX&&(maxX=px),py>maxY&&(maxY=py)}if(void 0!==seg.cp1x&&void 0!==seg.cp1y){var cp1x=seg.cp1x+(translate?translate.x:0),cp1y=seg.cp1y+(translate?translate.y:0);cp1x<minX&&(minX=cp1x),cp1y<minY&&(minY=cp1y),cp1x>maxX&&(maxX=cp1x),cp1y>maxY&&(maxY=cp1y)}if(void 0!==seg.cp2x&&void 0!==seg.cp2y){var cp2x=seg.cp2x+(translate?translate.x:0),cp2y=seg.cp2y+(translate?translate.y:0);cp2x<minX&&(minX=cp2x),cp2y<minY&&(minY=cp2y),cp2x>maxX&&(maxX=cp2x),cp2y>maxY&&(maxY=cp2y)}if(void 0!==seg.cpx&&void 0!==seg.cpy){var cpx=seg.cpx+(translate?translate.x:0),cpy=seg.cpy+(translate?translate.y:0);cpx<minX&&(minX=cpx),cpy<minY&&(minY=cpy),cpx>maxX&&(maxX=cpx),cpy>maxY&&(maxY=cpy)}}minX!==1/0&&maxX!==-1/0&&(attrs._pathSvgCenterX=(minX+maxX)/2,attrs._pathSvgCenterY=(minY+maxY)/2)}attrs&&(applyFillAndStroke(id,attrs),applyBlendMode(id,attrs));try{__createdPathLayers.push({id:id,parent:parentId})}catch(eReg){}return id}function createSVGFallbackLayer(node,parentId,vb,translate){var pid=createGroup(node.name||node.type,parentId);if(translate&&(0!==translate.x||0!==translate.y)){var zero=svgToCavalryPosition(0,0,vb),moved=svgToCavalryPosition(translate.x,translate.y,vb);api.set(pid,{"position.x":moved.x-zero.x,"position.y":moved.y-zero.y})}return pid}
// quiver_utilities_shapes.js
function createRect(node,parentId,vb){var x=parseFloat(node.attrs.x||"0"),y=parseFloat(node.attrs.y||"0"),w=parseFloat(node.attrs.width||"0"),h=parseFloat(node.attrs.height||"0"),translateOffset=parseTranslate(node.attrs&&node.attrs.transform||"");x+=translateOffset.x,y+=translateOffset.y;var isBackgroundRect=!1;if(vb&&vb.width&&vb.height){var matchesViewBox=Math.abs(w-vb.width)<.1&&Math.abs(h-vb.height)<.1,atOrigin=Math.abs(x)<.1&&Math.abs(y)<.1,hasGenericName=!node.name||"rect"===node.name||"rectangle"===node.name;isBackgroundRect=matchesViewBox&&atOrigin&&hasGenericName}var name=node.name||"rectangle";isBackgroundRect&&(name="Background");var id=api.primitive("rectangle",name);parentId&&api.parent(id,parentId);var rx=node.attrs.rx?parseFloat(node.attrs.rx):0,ry=node.attrs.ry?parseFloat(node.attrs.ry):0,rxv=isNaN(rx)?0:rx,ryv=isNaN(ry)?0:ry,ryEff=void 0!==node.attrs.ry?ryv:rxv,halfW=w/2,halfH=h/2,ratioX=halfW>0?Math.min(rxv,halfW)/halfW:0,ratioY=halfH>0?Math.min(ryEff,halfH)/halfH:0;if(isFinite(ratioX)&&isFinite(ratioY)&&ratioX>=.95&&ratioY>=.95){try{api.deleteLayer(id)}catch(eDelRect){}var ellipseNode={name:name.replace(/^rect$/,"ellipse"),attrs:{}};ellipseNode.attrs.cx=x+halfW,ellipseNode.attrs.cy=y+halfH,ellipseNode.attrs.rx=halfW,ellipseNode.attrs.ry=halfH;for(var styleKeys=["fill","fill-opacity","stroke","stroke-width","stroke-opacity","opacity","transform","_stroke_align","mix-blend-mode","filter","_additionalFills","_inheritedFilterId","_inheritedMaskIds","data-figma-bg-blur-radius"],si=0;si<styleKeys.length;si++){var k=styleKeys[si];void 0!==node.attrs[k]&&(ellipseNode.attrs[k]=node.attrs[k])}return createEllipse(ellipseNode,parentId,vb)}var centre,rCorner=rxv&&ryv?Math.min(rxv,ryv):rxv||ryv||0,cr=Math.max(0,Math.min(rCorner,Math.min(w,h)/2));if(centre=void 0!==node.attrs._transformedCenterX&&void 0!==node.attrs._transformedCenterY?svgToCavalryPosition(node.attrs._transformedCenterX,node.attrs._transformedCenterY,vb):svgToCavalryPosition(x+w/2,y+h/2,vb),api.set(id,{"generator.dimensions":[w,h],"position.x":centre.x,"position.y":centre.y}),cr>0&&api.set(id,{"generator.cornerRadius":cr}),void 0!==node.attrs._rotationDeg&&0!==node.attrs._rotationDeg){var cavalryRotation=-node.attrs._rotationDeg;try{api.set(id,{rotation:cavalryRotation})}catch(eRot){}}applyFillAndStroke(id,node.attrs),applyBlendMode(id,node.attrs);try{var rotPivot=parseRotatePivot(node.attrs&&node.attrs.transform||"");if(rotPivot&&null!==rotPivot.cx&&null!==rotPivot.cy){var newCenterSvg=rotatePointAround(x+w/2,y+h/2,rotPivot.angle,rotPivot.cx,rotPivot.cy),newPos=svgToCavalryPosition(newCenterSvg.x,newCenterSvg.y,vb);api.set(id,{"position.x":newPos.x,"position.y":newPos.y})}}catch(eP){}return id}function createCircle(node,parentId,vb){var name=node.name||"circle",id=api.primitive("ellipse",name);parentId&&api.parent(id,parentId);var cx=parseFloat(node.attrs.cx||"0"),cy=parseFloat(node.attrs.cy||"0"),r=parseFloat(node.attrs.r||"0"),translateOffset=parseTranslate(node.attrs&&node.attrs.transform||"");cx+=translateOffset.x,cy+=translateOffset.y,api.set(id,{"generator.radius":[r,r]});var pos=svgToCavalryPosition(cx,cy,vb);api.set(id,{"position.x":pos.x,"position.y":pos.y}),applyFillAndStroke(id,node.attrs),applyBlendMode(id,node.attrs);try{var rotPivotC=parseRotatePivot(node.attrs&&node.attrs.transform||"");if(rotPivotC&&null!==rotPivotC.cx&&null!==rotPivotC.cy){var newCenterSvgC=rotatePointAround(cx,cy,rotPivotC.angle,rotPivotC.cx,rotPivotC.cy),newPosC=svgToCavalryPosition(newCenterSvgC.x,newCenterSvgC.y,vb);api.set(id,{"position.x":newPosC.x,"position.y":newPosC.y})}}catch(ePc){}return id}function createEllipse(node,parentId,vb){var name=node.name||"ellipse",id=api.primitive("ellipse",name);parentId&&api.parent(id,parentId);var cx=parseFloat(node.attrs.cx||"0"),cy=parseFloat(node.attrs.cy||"0"),rx=parseFloat(node.attrs.rx||"0"),ry=parseFloat(node.attrs.ry||"0"),translateOffset=parseTranslate(node.attrs&&node.attrs.transform||"");cx+=translateOffset.x,cy+=translateOffset.y,api.set(id,{"generator.radius":[rx,ry]});var pos=svgToCavalryPosition(cx,cy,vb);api.set(id,{"position.x":pos.x,"position.y":pos.y}),applyFillAndStroke(id,node.attrs),applyBlendMode(id,node.attrs);try{void 0!==node.attrs._rotationDeg&&Math.abs(node.attrs._rotationDeg)>1e-4&&api.set(id,{rotation:-node.attrs._rotationDeg})}catch(eRotE){}try{var rotPivotE=parseRotatePivot(node.attrs&&node.attrs.transform||"");if(rotPivotE&&null!==rotPivotE.cx&&null!==rotPivotE.cy){var newCenterSvgE=rotatePointAround(cx,cy,rotPivotE.angle,rotPivotE.cx,rotPivotE.cy),newPosE=svgToCavalryPosition(newCenterSvgE.x,newCenterSvgE.y,vb);api.set(id,{"position.x":newPosE.x,"position.y":newPosE.y})}}catch(ePe){}return id}function parsePoints(pointsStr){if(!pointsStr)return[];for(var pairs=pointsStr.trim().split(/\s+/),pts=[],i=0;i<pairs.length;i++){var pr=pairs[i].split(",");if(!(pr.length<2)){var x=parseFloat(pr[0]),y=parseFloat(pr[1]);isNaN(x)||isNaN(y)||pts.push({x:x,y:y})}}return pts}function computeCentroid(points){for(var sx=0,sy=0,i=0;i<points.length;i++)sx+=points[i].x,sy+=points[i].y;return{x:sx/points.length,y:sy/points.length}}function analyzePolygon(points){for(var c=computeCentroid(points),radii=[],angles=[],i=0;i<points.length;i++){var dx=points[i].x-c.x,dy=points[i].y-c.y,r=Math.hypot(dx,dy),a=Math.atan2(-dy,dx);radii.push(r),angles.push(a)}var idx=angles.map(function(a,i){return{i:i,a:(a%(2*Math.PI)+2*Math.PI)%(2*Math.PI)}});idx.sort(function(u,v){return u.a-v.a});var sortedR=idx.map(function(o){return radii[o.i]}),n=points.length;if(n<3)return{type:"unknown"};var mean=sortedR.reduce(function(a,b){return a+b},0)/n,dev=Math.sqrt(sortedR.reduce(function(a,b){return a+(b-mean)*(b-mean)},0)/n);if(dev/mean<.05)return{type:"regularPolygon",centroid:c,outerRadius:mean,sides:n};for(var even=[],odd=[],k=0;k<n;k++)(k%2==0?even:odd).push(sortedR[k]);if(even.length>0&&odd.length>0){var me=even.reduce(function(a,b){return a+b},0)/even.length,mo=odd.reduce(function(a,b){return a+b},0)/odd.length,devE=Math.sqrt(even.reduce(function(a,b){return a+(b-me)*(b-me)},0)/even.length),devO=Math.sqrt(odd.reduce(function(a,b){return a+(b-mo)*(b-mo)},0)/odd.length);if(Math.abs(me-mo)/mean>.2&&devE/me<.1&&devO/mo<.1)return{type:"star",centroid:c,outerRadius:Math.max(me,mo),innerRadius:Math.min(me,mo),points:n/2}}return{type:"unknown"}}function createRegularPolygonPrimitive(name,points,parentId,vb,translate,attrs){var analysis=analyzePolygon(points);if("unknown"===analysis.type)return null;if("regularPolygon"===analysis.type&&analysis.sides>=3){var id=api.primitive("polygon",name||"Polygon");parentId&&api.parent(id,parentId);try{api.set(id,{"generator.sides":analysis.sides})}catch(eSides){}try{api.set(id,{"generator.radius":analysis.outerRadius})}catch(eRad){try{api.set(id,{"generator.dimensions":[2*analysis.outerRadius,2*analysis.outerRadius]})}catch(eDim){}}var pos=svgToCavalryPosition(analysis.centroid.x+(translate?translate.x:0),analysis.centroid.y+(translate?translate.y:0),vb);return api.set(id,{"position.x":pos.x,"position.y":pos.y}),attrs&&applyFillAndStroke(id,attrs),id}if("star"===analysis.type&&analysis.points>=3){var id2=api.primitive("star",name||"Star");parentId&&api.parent(id2,parentId);try{api.set(id2,{"generator.points":Math.round(analysis.points)})}catch(ePts){}try{api.set(id2,{"generator.innerRadius":analysis.innerRadius})}catch(eIn){}try{api.set(id2,{"generator.outerRadius":analysis.outerRadius})}catch(eOut){}var pos2=svgToCavalryPosition(analysis.centroid.x+(translate?translate.x:0),analysis.centroid.y+(translate?translate.y:0),vb);return api.set(id2,{"position.x":pos2.x,"position.y":pos2.y}),attrs&&applyFillAndStroke(id2,attrs),id2}return null}
// quiver_utilities_text.js
function parseFontFamilyVariant(fontFamilyStr){if(!fontFamilyStr)return null;var cleaned=fontFamilyStr.replace(/["']/g,"").trim(),hyphenIndex=cleaned.lastIndexOf("-");if(-1===hyphenIndex)return null;var baseName=cleaned.substring(0,hyphenIndex),variant=cleaned.substring(hyphenIndex+1),mappedVariant={Thin:"Thin",UltraLight:"Thin",ExtraLight:"Light",Light:"Light",Regular:"Regular",Medium:"Medium",SemiBold:"SemiBold",Semibold:"SemiBold",DemiBold:"SemiBold",Bold:"Bold",ExtraBold:"ExtraBold",UltraBold:"ExtraBold",Black:"Black",Heavy:"Black",Italic:"Italic",ItalicMT:"Italic",It:"Italic",Oblique:"Italic",BoldItalic:"Bold Italic",BoldItalicMT:"Bold Italic",MediumItalic:"Medium Italic",SemiBoldItalic:"SemiBold Italic",LightItalic:"Light Italic",BlackItalic:"Black Italic"}[variant];return mappedVariant?{family:baseName.replace(/([a-z])([A-Z])/g,"$1 $2"),variant:mappedVariant}:"MT"===variant||variant.match(/^MT$/)?{family:baseName.replace(/([a-z])([A-Z])/g,"$1 $2"),variant:"Regular"}:null}function replaceEmojisWithPlaceholder(text){if(!text)return{text:text,indexMap:{},emojisStripped:!1,matches:[]};for(var match,emojisDisabled=void 0!==importEmojisEnabled&&!importEmojisEnabled,emojiPattern=/(?:\u{1F3F4}(?:\u{E0067}\u{E0062}(?:\u{E0065}\u{E006E}\u{E0067}|\u{E0073}\u{E0063}\u{E0074}|\u{E0077}\u{E006C}\u{E0073})\u{E007F})?|[\u{1F1E0}-\u{1F1FF}]{2}|[\u{1F300}-\u{1F5FF}]|[\u{1F600}-\u{1F64F}]|[\u{1F680}-\u{1F6FF}]|[\u{1F700}-\u{1F77F}]|[\u{1F780}-\u{1F7FF}]|[\u{1F800}-\u{1F8FF}]|[\u{1F900}-\u{1F9FF}]|[\u{1FA00}-\u{1FA6F}]|[\u{1FA70}-\u{1FAFF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}]|[\u{231A}-\u{231B}]|[\u{23E9}-\u{23F3}]|[\u{23F8}-\u{23FA}]|[\u{25AA}-\u{25AB}]|[\u{25B6}]|[\u{25C0}]|[\u{25FB}-\u{25FE}]|[\u{2614}-\u{2615}]|[\u{2648}-\u{2653}]|[\u{267F}]|[\u{2693}]|[\u{26A1}]|[\u{26AA}-\u{26AB}]|[\u{26BD}-\u{26BE}]|[\u{26C4}-\u{26C5}]|[\u{26CE}]|[\u{26D4}]|[\u{26EA}]|[\u{26F2}-\u{26F3}]|[\u{26F5}]|[\u{26FA}]|[\u{26FD}]|[\u{2702}]|[\u{2705}]|[\u{2708}-\u{270D}]|[\u{270F}]|[\u{2712}]|[\u{2714}]|[\u{2716}]|[\u{271D}]|[\u{2721}]|[\u{2728}]|[\u{2733}-\u{2734}]|[\u{2744}]|[\u{2747}]|[\u{274C}]|[\u{274E}]|[\u{2753}-\u{2755}]|[\u{2757}]|[\u{2763}-\u{2764}]|[\u{2795}-\u{2797}]|[\u{27A1}]|[\u{27B0}]|[\u{27BF}]|[\u{2934}-\u{2935}]|[\u{2B05}-\u{2B07}]|[\u{2B1B}-\u{2B1C}]|[\u{2B50}]|[\u{2B55}]|[\u{3030}]|[\u{303D}]|[\u{3297}]|[\u{3299}])(?:\u{FE0F})?(?:\u{200D}(?:\u{1F3F4}(?:\u{E0067}\u{E0062}(?:\u{E0065}\u{E006E}\u{E0067}|\u{E0073}\u{E0063}\u{E0074}|\u{E0077}\u{E006C}\u{E0073})\u{E007F})?|[\u{1F1E0}-\u{1F1FF}]{2}|[\u{1F300}-\u{1F5FF}]|[\u{1F600}-\u{1F64F}]|[\u{1F680}-\u{1F6FF}]|[\u{1F700}-\u{1F77F}]|[\u{1F780}-\u{1F7FF}]|[\u{1F800}-\u{1F8FF}]|[\u{1F900}-\u{1F9FF}]|[\u{1FA00}-\u{1FA6F}]|[\u{1FA70}-\u{1FAFF}]|[\u{2600}-\u{26FF}]|[\u{2700}-\u{27BF}])(?:\u{FE0F})?)*/gu,placeholder=emojisDisabled?"":void 0!==emojiPlaceholder&&3===emojiPlaceholder.length?emojiPlaceholder:"[e]",placeholderLength=placeholder.length,indexMap={},matches=[];null!==(match=emojiPattern.exec(text));)matches.push({originalIndex:match.index,originalLength:match[0].length,emoji:match[0]});if(emojisDisabled)for(i=0;i<matches.length;i++)matches[i].needsSpaceBefore=!1,matches[i].needsSpaceAfter=!1;else for(var i=0;i<matches.length;i++){(m=matches[i]).needsSpaceBefore=!1,m.needsSpaceAfter=!1;var prevEmoji=i>0?matches[i-1]:null,prevEmojiEnd=prevEmoji?prevEmoji.originalIndex+prevEmoji.originalLength:-1;if(m.originalIndex>0)if(prevEmoji&&prevEmojiEnd===m.originalIndex&&prevEmoji.needsSpaceAfter)m.needsSpaceBefore=!1;else{var charBefore=text.charAt(m.originalIndex-1);" "!==charBefore&&"\t"!==charBefore&&"\n"!==charBefore&&"\r"!==charBefore&&(m.needsSpaceBefore=!0)}var endIndex=m.originalIndex+m.originalLength;if(endIndex<text.length){var charAfter=text.charAt(endIndex);" "!==charAfter&&"\t"!==charAfter&&"\n"!==charAfter&&"\r"!==charAfter&&(m.needsSpaceAfter=!0)}}var netOffset=0;for(i=0;i<matches.length;i++){(m=matches[i]).needsSpaceBefore&&(netOffset+=1);var newIndex=m.originalIndex+netOffset;indexMap[m.originalIndex]=newIndex,netOffset-=m.originalLength-placeholderLength,m.needsSpaceAfter&&(netOffset+=1)}var modifiedText="",lastEnd=0;for(i=0;i<matches.length;i++){var m=matches[i];modifiedText+=text.substring(lastEnd,m.originalIndex),m.needsSpaceBefore&&(modifiedText+=" "),modifiedText+=placeholder,m.needsSpaceAfter&&(modifiedText+=" "),lastEnd=m.originalIndex+m.originalLength}if(modifiedText+=text.substring(lastEnd),emojisDisabled&&matches.length>0);else if(matches.length>0)matches.filter(function(m){return m.needsSpaceBefore}).length,matches.filter(function(m){return m.needsSpaceAfter}).length;return{text:modifiedText,indexMap:indexMap,matches:matches,emojisStripped:emojisDisabled}}var __emojiIndexMaps={};function adjustIndexForEmojiReplacements(originalIndex,matches,emojisStripped){if(!matches||0===matches.length)return originalIndex;for(var placeholderLength=emojisStripped?0:3,netOffset=0,i=0;i<matches.length;i++){var m=matches[i],emojiStart=m.originalIndex,emojiEnd=emojiStart+m.originalLength;if(!(emojiStart<originalIndex)){if(emojiStart===originalIndex){m.needsSpaceBefore&&!emojisStripped&&(netOffset+=1);break}break}m.needsSpaceBefore&&!emojisStripped&&(netOffset+=1),netOffset-=m.originalLength-placeholderLength,m.needsSpaceAfter&&!emojisStripped&&originalIndex>=emojiEnd&&(netOffset+=1)}return originalIndex+netOffset}function getStringEmojiIndex(textNodeName,originalIndex){var data=__emojiIndexMaps[textNodeName];return data&&data.indexMap&&data.indexMap.hasOwnProperty(originalIndex)?data.indexMap[originalIndex]:originalIndex}function countVisualChars(text){if(!text)return 0;for(var count=0,i=0;i<text.length;i++){var ch=text.charAt(i),code=text.charCodeAt(i);" "===ch||"\t"===ch||"\n"===ch||"\r"===ch||8203===code||8204===code||8205===code||8288===code||65279===code||173===code||65038===code||65039===code||count++}return count}function getWordIndexForEmoji(textNodeName,originalIndex){var data=__emojiIndexMaps[textNodeName];if(!data||!data.indexMap||!data.modifiedText)return{wordIndex:-1};var stringIndex=data.indexMap[originalIndex],text=data.modifiedText;if(void 0===stringIndex)return{wordIndex:-1};for(var wordIndex=0,inWord=!1,i=0;i<text.length;i++){var ch=text.charAt(i),isWhitespace=" "===ch||"\t"===ch||"\n"===ch||"\r"===ch;if(isWhitespace)inWord&&(inWord=!1);else if(inWord||(inWord=!0),i===stringIndex)return{wordIndex:wordIndex};if(!isWhitespace&&i+1<text.length){var nextCh=text.charAt(i+1);(" "===nextCh||"\t"===nextCh||"\n"===nextCh||"\r"===nextCh)&&wordIndex++}else!isWhitespace&&text.length}return{wordIndex:-1}}function setActualGlyphCount(textNodeName,actualGlyphCount){if(void 0!==__emojiIndexMaps&&__emojiIndexMaps[textNodeName]){var data=__emojiIndexMaps[textNodeName];data.actualGlyphCount=actualGlyphCount,data.modifiedText&&(data.totalVisualChars=countVisualChars(data.modifiedText),data.totalVisualChars>0&&(data.glyphScaleFactor=actualGlyphCount/data.totalVisualChars))}else console.warn('[Emoji Index] No emoji data for "'+textNodeName+'" to set glyph count')}function getAdjustedEmojiIndex(textNodeName,originalIndex){var data=__emojiIndexMaps[textNodeName];if(!data)return originalIndex;var indexMap=data.indexMap,modifiedText=data.modifiedText;if(!indexMap||!indexMap.hasOwnProperty(originalIndex))return originalIndex;var stringIndex=indexMap[originalIndex];if(!modifiedText)return stringIndex;for(var visualIndex=0,i=0;i<stringIndex&&i<modifiedText.length;i++){var ch=modifiedText.charAt(i),code=modifiedText.charCodeAt(i);" "===ch||"\t"===ch||"\n"===ch||"\r"===ch||8203===code||8204===code||8205===code||8288===code||65279===code||173===code||65038===code||65039===code?" "===ch?0:"\n"===ch||"\r"===ch?0:0:visualIndex++}var glyphIndex=visualIndex;return void 0!==data.glyphScaleFactor&&data.glyphScaleFactor>0&&(glyphIndex=Math.round(visualIndex*data.glyphScaleFactor)),glyphIndex}function clearEmojiIndexMaps(){__emojiIndexMaps={}}function createText(node,parentId,vb,inheritedScale){try{if(inheritedScale=inheritedScale||{x:1,y:1},!node.tspans||0===node.tspans.length)return null;if(!importLiveTextEnabled)return null;
// getFigmaTextData is defined in quiver_utilities_webserver.js and populated before SVG import
var figmaTextData=null;try{var textNodeName=node.name||"",textContentPreview="";if(node.tspans&&node.tspans.length>0)for(var tpi=0;tpi<node.tspans.length&&textContentPreview.length<50;tpi++)textContentPreview+=node.tspans[tpi].text.replace(/[\u2028\u2029]/g,"");var svgPosition=null;node.tspans&&node.tspans.length>0&&(svgPosition={x:node.tspans[0].x||0,y:node.tspans[0].y||0}),"function"==typeof getFigmaTextData&&(figmaTextData=getFigmaTextData(textNodeName,textContentPreview,svgPosition))}catch(eFTD){}for(var combined="",ti=0;ti<node.tspans.length;ti++){var tspanText=node.tspans[ti].text.replace(/[\u2028\u2029\n\r]/g,"");if(ti>0){var prevY=node.tspans[ti-1].y,currY=node.tspans[ti].y;Math.abs(currY-prevY)>1&&(combined=combined.replace(/[ \u2028\u2029]+$/,""),combined+="\n")}combined+=tspanText}combined=combined.replace(/^(\n)+/,"");try{combined=decodeEntitiesForName(combined)}catch(eDecAll){}var name=combined.split(/\s+/).slice(0,3).join(" ");name||(name=node.name||"text");var id=api.create("textShape",name);parentId&&api.parent(id,parentId);for(var first=node.tspans[0],tIdx=0;tIdx<node.tspans.length;tIdx++){var tspan=node.tspans[tIdx];if(tspan.text&&tspan.text.trim().length>0){first=tspan;break}}var pos=svgToCavalryPosition(first.x,first.y,vb),fontSize=(node.attrs.fill||extractStyleProperty(node.attrs.style,"fill"),parseFloat((node.attrs["font-size"]||extractStyleProperty(node.attrs.style,"font-size")||"16").toString().replace("px",""))*((inheritedScale.x+inheritedScale.y)/2)),familyFirst=(node.attrs["font-family"]||extractStyleProperty(node.attrs.style,"font-family")||"Arial").split(",")[0].trim().replace(/["']/g,""),parsed=parseFontFamilyVariant(familyFirst),family=familyFirst,variantFromName=null;parsed?(family=parsed.family,variantFromName=parsed.variant):familyFirst.match(/MT$/)&&(family=familyFirst.replace(/MT$/,""));var weight=node.attrs["font-weight"]||extractStyleProperty(node.attrs.style,"font-weight")||"400",fontStyle=node.attrs["font-style"]||extractStyleProperty(node.attrs.style,"font-style")||"";var finalStyle=variantFromName||(w=(""+weight).toLowerCase(),n=parseInt(w,10),weightStyle=isNaN(n)?"normal"===w?"Regular":"bold"===w?"Bold":w.charAt(0).toUpperCase()+w.slice(1):n<=250?"Thin":n<=350?"Light":n<=450?"Regular":n<=550?"Medium":n<=650?"SemiBold":n<=750?"Bold":n<=850?"ExtraBold":"Black",s=weightStyle||"Regular",-1===(fs=(""+fontStyle).toLowerCase()).indexOf("italic")&&-1===fs.indexOf("oblique")||-1!==s.toLowerCase().indexOf("italic")?s:s+" Italic"),lineSpacingOffset=0;try{var actualLineHeight=null;if(node.tspans&&node.tspans.length>1){for(var diffs=[],li=1;li<node.tspans.length;li++){var dy=node.tspans[li].y-node.tspans[li-1].y;isFinite(dy)&&Math.abs(dy)>1&&diffs.push(dy)}if(diffs.length>0){for(var sum=0,di=0;di<diffs.length;di++)sum+=diffs[di];actualLineHeight=sum/diffs.length}}if(null!==actualLineHeight){lineSpacingOffset=actualLineHeight-(cavalryDefaultLH=1.29*fontSize);if(figmaTextData&&figmaTextData.lineHeight)"PERCENT"===(lh=figmaTextData.lineHeight).unit?" (Figma: "+lh.value+"%)":"PIXELS"===lh.unit?" (Figma: "+lh.value+"px)":"AUTO"===lh.unit&&" (Figma: AUTO)"}else if(figmaTextData&&figmaTextData.lineHeight){var lh;if("AUTO"===(lh=figmaTextData.lineHeight).unit)lineSpacingOffset=0;else if("PIXELS"===lh.unit&&"number"==typeof lh.value){var cavalryDefaultLH=1.29*fontSize;lineSpacingOffset=lh.value-cavalryDefaultLH}else if("PERCENT"===lh.unit&&"number"==typeof lh.value){lineSpacingOffset=fontSize*(lh.value/100)-(cavalryDefaultLH=1.29*fontSize)}}}catch(eLS){lineSpacingOffset=0}var horizontalAlignment=0;if(figmaTextData&&figmaTextData.textAlignHorizontal){var alignH=figmaTextData.textAlignHorizontal.toUpperCase();"CENTER"===alignH?horizontalAlignment=1:"RIGHT"===alignH?horizontalAlignment=2:"JUSTIFIED"===alignH&&(horizontalAlignment=3)}var finalPosX=pos.x,finalPosY=pos.y;if(figmaTextData){var figmaWidth=(figmaTextData.width||0)*inheritedScale.x;if(1===horizontalAlignment)finalPosX=svgToCavalryPosition(figmaTextData.relativeX,figmaTextData.relativeY,vb).x+figmaWidth/2;else if(2===horizontalAlignment){finalPosX=svgToCavalryPosition(figmaTextData.relativeX,figmaTextData.relativeY,vb).x+figmaWidth}}var textNodeNameForEmoji=node.name||name,emojiReplacement=replaceEmojisWithPlaceholder(combined);combined=emojiReplacement.text;var emojiMatchesSimple=emojiReplacement.matches||[],emojisStrippedSimple=emojiReplacement.emojisStripped||!1;if((Object.keys(emojiReplacement.indexMap).length>0||emojiMatchesSimple.length>0)&&(void 0!==__emojiIndexMaps&&(__emojiIndexMaps[textNodeNameForEmoji]={indexMap:emojiReplacement.indexMap,modifiedText:combined,matches:emojiMatchesSimple,emojisStripped:emojisStrippedSimple}),!emojisStrippedSimple))void 0!==emojiPlaceholder&&emojiPlaceholder.length;var textSettings={text:combined,fontSize:fontSize,"font.font":family,"font.style":finalStyle,autoWidth:!0,autoHeight:!0,"position.x":finalPosX,"position.y":finalPosY,horizontalAlignment:horizontalAlignment,verticalAlignment:3},lsNum=0,figmaLetterSpacingUsed=!1;if(figmaTextData&&figmaTextData.letterSpacing&&"number"==typeof figmaTextData.letterSpacing.value){var ls=figmaTextData.letterSpacing;"PIXELS"===ls.unit?((lsNum=ls.value)/fontSize,figmaLetterSpacingUsed=!0):"PERCENT"===ls.unit&&(lsNum=ls.value/100*fontSize,figmaLetterSpacingUsed=!0)}if(!figmaLetterSpacingUsed){var letterSpacingRaw=node.attrs["letter-spacing"]||extractStyleProperty(node.attrs.style,"letter-spacing");if(letterSpacingRaw&&"normal"!==(""+letterSpacingRaw).toLowerCase()){var lsStr=(""+letterSpacingRaw).trim();-1!==lsStr.indexOf("em")?lsNum=parseFloat(lsStr.replace("em",""))*fontSize:-1!==lsStr.indexOf("px")?(lsNum=parseFloat(lsStr.replace("px","")))/fontSize:(lsNum=parseFloat(lsStr),!isNaN(lsNum)&&Math.abs(lsNum)<10?lsNum*=fontSize:lsNum/fontSize)}}if(isNaN(lsNum)||0===lsNum||(textSettings.letterSpacing=lsNum),lineSpacingOffset&&node.tspans&&node.tspans.length>1)try{textSettings.lineSpacing=lineSpacingOffset}catch(eSetLS){}api.set(id,textSettings);try{var isVariableFont=!1;try{var axisCheck=api.getAttributeDefinition(id,"fontAxes.0");isVariableFont=null!=axisCheck}catch(eCheck){isVariableFont=!1}if(isVariableFont){console.log("[Variable Font] Processing text: "+name+" with font: "+family+" "+finalStyle);var numericWeightForAxis=null;if(figmaTextData&&figmaTextData.styledSegments&&figmaTextData.styledSegments.length>0)for(var fwti=0;fwti<figmaTextData.styledSegments.length;fwti++){var fwtSeg=figmaTextData.styledSegments[fwti];if(void 0!==fwtSeg.fontWeight&&"number"==typeof fwtSeg.fontWeight){numericWeightForAxis=fwtSeg.fontWeight,console.log("[Variable Font] Found fontWeight in Figma data: "+numericWeightForAxis);break}}if(null===numericWeightForAxis&&weight){var parsedWeight=parseInt(weight,10);!isNaN(parsedWeight)&&parsedWeight>=100&&parsedWeight<=900?(numericWeightForAxis=parsedWeight,console.log("[Variable Font] Parsed weight from SVG: "+numericWeightForAxis)):"bold"===(""+weight).toLowerCase()?numericWeightForAxis=700:"normal"===(""+weight).toLowerCase()&&(numericWeightForAxis=400)}if(null!==numericWeightForAxis)try{api.set(id,{"fontAxes.0":numericWeightForAxis}),console.log("[Variable Font] Set fontAxes.0 (weight) to "+numericWeightForAxis+" for "+family)}catch(eWght){}var slantValue=null,fontStyleRaw=fontStyle||"",fontStyleLowerCheck=fontStyleRaw.toLowerCase(),finalStyleLowerCheck=(finalStyle||"").toLowerCase(),obliqueMatch=fontStyleRaw.match(/oblique\s*(-?\d+(?:\.\d+)?)\s*deg/i);if(obliqueMatch&&obliqueMatch[1]?(slantValue=parseFloat(obliqueMatch[1]),console.log("[Variable Font] Parsed slant from font-style: "+slantValue+" degrees")):-1===fontStyleLowerCheck.indexOf("italic")&&-1===fontStyleLowerCheck.indexOf("oblique")&&-1===finalStyleLowerCheck.indexOf("italic")&&-1===finalStyleLowerCheck.indexOf("oblique")||(slantValue=-12,console.log("[Variable Font] Using default slant for italic/oblique: "+slantValue)),null!==slantValue)try{api.getAttributeDefinition(id,"fontAxes.1")&&(api.set(id,{"fontAxes.1":slantValue}),console.log("[Variable Font] Set fontAxes.1 (slant) to "+slantValue))}catch(eSlnt){}}else;}catch(eVarFont){}try{api.get(id,"horizontalAlignment"),api.get(id,"verticalAlignment")}catch(eVerify){}var attrsForTextStyle={};try{for(var kAT in node.attrs)Object.prototype.hasOwnProperty.call(node.attrs,kAT)&&(attrsForTextStyle[kAT]=node.attrs[kAT])}catch(eCopy){}var fillRawTxt=node.attrs&&(node.attrs.fill||node.attrs.style&&extractStyleProperty(node.attrs.style,"fill"))||null,strokeRawTxt=node.attrs&&(node.attrs.stroke||node.attrs.style&&extractStyleProperty(node.attrs.style,"stroke"))||null,hasStrokeTxt=!(!strokeRawTxt||"none"===(""+strokeRawTxt).toLowerCase()),hasStrokeGradTxt=!!extractUrlRefId(strokeRawTxt),hasStyleFill=!!(node.attrs&&node.attrs.style&&extractStyleProperty(node.attrs.style,"fill")),forceHideFillAlpha=!1;null!=fillRawTxt&&""!==fillRawTxt&&"none"!==(""+fillRawTxt).toLowerCase()||(hasStrokeTxt||hasStrokeGradTxt?(attrsForTextStyle.fill="none",forceHideFillAlpha=!0):hasStyleFill||(attrsForTextStyle.fill="#000000"));try{var srcFill=node.attrs.fill||node.attrs.style&&extractStyleProperty(node.attrs.style,"fill");if(srcFill&&/^rgba\(/i.test(srcFill)){var mA=srcFill.match(/rgba\((\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*,\s*([\d.]+)\)/i);if(mA&&void 0!==mA[4]){var aVal=clamp01(parseFloat(mA[4])),foNum=parseOpacityValue(node.attrs["fill-opacity"]||node.attrs.style&&extractStyleProperty(node.attrs.style,"fill-opacity"));null===foNum&&(foNum=1),attrsForTextStyle["fill-opacity"]=""+clamp01(foNum*aVal);var rr=parseInt(mA[1]).toString(16).padStart(2,"0"),gg=parseInt(mA[2]).toString(16).padStart(2,"0"),bb=parseInt(mA[3]).toString(16).padStart(2,"0");attrsForTextStyle.fill="#"+rr+gg+bb}}}catch(eRGBA){}if(applyFillAndStroke(id,attrsForTextStyle),applyBlendMode(id,attrsForTextStyle),forceHideFillAlpha)try{api.set(id,{"material.materialColor.a":0})}catch(eHide){}return"function"==typeof registerCreatedTextShape&&registerCreatedTextShape(node.name||name,id),id}catch(e){return null}var weightStyle,s,fs,w,n}function createTextFromFigmaData(figmaData,parentId,vb,inheritedScale,fills,svgTextChildren){try{if(inheritedScale=inheritedScale||{x:1,y:1},!figmaData||!figmaData.characters)return null;if(!importLiveTextEnabled)return null;var characters=figmaData.characters,name=figmaData.name||characters.split(/\s+/).slice(0,3).join(" ")||"Text",emojiReplacement=replaceEmojisWithPlaceholder(characters);characters=emojiReplacement.text;var emojiMatches=emojiReplacement.matches||[],emojisStripped=emojiReplacement.emojisStripped||!1;if((Object.keys(emojiReplacement.indexMap).length>0||emojiMatches.length>0)&&(__emojiIndexMaps[figmaData.name||name]={indexMap:emojiReplacement.indexMap,modifiedText:characters,matches:emojiMatches,emojisStripped:emojisStripped},!emojisStripped))void 0!==emojiPlaceholder&&emojiPlaceholder.length;var id=api.create("textShape",name);parentId&&api.parent(id,parentId);var figmaAnchorX,figmaBaselineY,figmaX=figmaData.relativeX||0,figmaY=figmaData.relativeY||0,figmaWidth=figmaData.width||100,vbWidth=(figmaData.height,vb.width||1920),vbHeight=vb.height||1080,scaleAvg=(inheritedScale.x+inheritedScale.y)/2,fontSize=(figmaData.fontSize||16)*scaleAvg,horizontalAlignment={LEFT:0,CENTER:1,RIGHT:2,JUSTIFIED:0}[figmaData.textAlignHorizontal]||0,textAutoResize=figmaData.textAutoResize||"WIDTH_AND_HEIGHT",isAutoWidth="WIDTH_AND_HEIGHT"===textAutoResize;figmaAnchorX=isAutoWidth?2===horizontalAlignment?figmaX+figmaWidth:1===horizontalAlignment?figmaX+figmaWidth/2:figmaX:figmaX;var textChildrenArray=[];if(svgTextChildren&&(textChildrenArray=Array.isArray(svgTextChildren)?svgTextChildren:[svgTextChildren]),textChildrenArray.length>1){function getTransformedTspanY(textChild){if(!textChild.tspans||0===textChild.tspans.length)return 0;var tspanY=textChild.tspans[0].y,tspanX=textChild.tspans[0].x;if(textChild.attrs&&textChild.attrs.transform){var matrix=parseTransformMatrixList(textChild.attrs.transform);tspanY=matrix.b*tspanX+matrix.d*tspanY+matrix.f}return tspanY}textChildrenArray.sort(function(a,b){return getTransformedTspanY(a)-getTransformedTspanY(b)}),textChildrenArray[0].tspans&&textChildrenArray[0].tspans.length}var firstTextChild=textChildrenArray.length>0?textChildrenArray[0]:null;if(firstTextChild&&firstTextChild.tspans&&firstTextChild.tspans.length>0){var tspanY=firstTextChild.tspans[0].y,tspanX=firstTextChild.tspans[0].x;if(firstTextChild.attrs&&firstTextChild.attrs.transform){var textTransformMatrix=parseTransformMatrixList(firstTextChild.attrs.transform);textTransformMatrix.a,textTransformMatrix.c,textTransformMatrix.e;tspanY=textTransformMatrix.b*tspanX+textTransformMatrix.d*tspanY+textTransformMatrix.f}figmaBaselineY=tspanY}else figmaBaselineY=figmaY+fontSize;var cavalryX=figmaAnchorX-vbWidth/2,cavalryY=vbHeight/2-figmaBaselineY,fontFamily=figmaData.fontFamily||"Arial",fontStyle=figmaData.fontStyle||"Regular";if(figmaData.styledSegments&&figmaData.styledSegments.length>1){for(var fontCoverage={},sci=0;sci<figmaData.styledSegments.length;sci++){var segFontFull=(segFontFamily=(seg=figmaData.styledSegments[sci]).fontFamily||fontFamily)+" "+(segFontStyle=seg.fontStyle||fontStyle),segCharCount=(seg.end||0)-(seg.start||0);fontCoverage[segFontFull]||(fontCoverage[segFontFull]={fontFamily:segFontFamily,fontStyle:segFontStyle,charCount:0}),fontCoverage[segFontFull].charCount+=segCharCount}for(var dominantFont=null,maxCoverage=0,coverageKeys=Object.keys(fontCoverage),ci=0;ci<coverageKeys.length;ci++){var coverage=fontCoverage[coverageKeys[ci]];coverage.charCount>maxCoverage&&(maxCoverage=coverage.charCount,dominantFont=coverage)}dominantFont&&(fontFamily=dominantFont.fontFamily,fontStyle=dominantFont.fontStyle)}var autoWidth=isAutoWidth,autoHeight=!0,textBoxWidth=(figmaData.width||100)*scaleAvg;figmaData.height;"NONE"===textAutoResize||"TRUNCATE"===textAutoResize?(autoWidth=!1,autoHeight=!1):"HEIGHT"===textAutoResize?(autoWidth=!1,autoHeight=!0):(autoWidth=!0,autoHeight=!0);var textSettings={text:characters,"position.x":cavalryX,"position.y":cavalryY,fontSize:fontSize,"font.font":fontFamily,"font.style":fontStyle,horizontalAlignment:horizontalAlignment,verticalAlignment:3,autoWidth:autoWidth,autoHeight:autoHeight};autoWidth||(textSettings["textBoxSize.x"]=textBoxWidth);var lineSpacingOffset=0,lineSpacingCalculated=!1;if(firstTextChild&&firstTextChild.tspans&&firstTextChild.tspans.length>1){for(var diffs=[],maxReasonableLineHeight=3*fontSize,li=1;li<firstTextChild.tspans.length;li++){var dy=firstTextChild.tspans[li].y-firstTextChild.tspans[li-1].y;isFinite(dy)&&dy>1&&dy<=maxReasonableLineHeight&&diffs.push(dy)}if(diffs.length>0){for(var minDiff=diffs[0],di=1;di<diffs.length;di++)diffs[di]<minDiff&&(minDiff=diffs[di]);lineSpacingOffset=minDiff*scaleAvg-1.29*fontSize,lineSpacingCalculated=!0;figmaData.lineHeight&&("PERCENT"===figmaData.lineHeight.unit?" (Figma: "+figmaData.lineHeight.value+"%)":"PIXELS"===figmaData.lineHeight.unit&&" (Figma: "+figmaData.lineHeight.value+"px)")}}if(!lineSpacingCalculated&&textChildrenArray.length>1){for(var yPositions=[],tci=0;tci<textChildrenArray.length;tci++){(tc=textChildrenArray[tci]).tspans&&tc.tspans.length>0&&yPositions.push(tc.tspans[0].y)}if(yPositions.sort(function(a,b){return a-b}),yPositions.length>1){diffs=[],maxReasonableLineHeight=3*fontSize;for(var yi=1;yi<yPositions.length;yi++){dy=yPositions[yi]-yPositions[yi-1];isFinite(dy)&&dy>1&&dy<=maxReasonableLineHeight&&diffs.push(dy)}if(diffs.length>0){for(minDiff=diffs[0],di=1;di<diffs.length;di++)diffs[di]<minDiff&&(minDiff=diffs[di]);lineSpacingOffset=minDiff*scaleAvg-1.29*fontSize,lineSpacingCalculated=!0;figmaData.lineHeight&&("PERCENT"===figmaData.lineHeight.unit?" (Figma: "+figmaData.lineHeight.value+"%)":"PIXELS"===figmaData.lineHeight.unit&&" (Figma: "+figmaData.lineHeight.value+"px)")}}}if(!lineSpacingCalculated&&figmaData.lineHeight)if("PIXELS"===figmaData.lineHeight.unit&&figmaData.lineHeight.value)lineSpacingOffset=figmaData.lineHeight.value*scaleAvg-1.29*fontSize;else if("PERCENT"===figmaData.lineHeight.unit&&figmaData.lineHeight.value){lineSpacingOffset=fontSize*(figmaData.lineHeight.value/100)-1.29*fontSize}0!==lineSpacingOffset&&(textSettings.lineSpacing=lineSpacingOffset),figmaData.letterSpacing&&("PIXELS"===figmaData.letterSpacing.unit&&void 0!==figmaData.letterSpacing.value?textSettings.letterSpacing=figmaData.letterSpacing.value*scaleAvg:"PERCENT"===figmaData.letterSpacing.unit&&void 0!==figmaData.letterSpacing.value&&(textSettings.letterSpacing=fontSize*figmaData.letterSpacing.value/100*scaleAvg)),api.set(id,textSettings);try{var isVariableFontFigma=!1;try{var axisCheckFigma=api.getAttributeDefinition(id,"fontAxes.0");isVariableFontFigma=null!=axisCheckFigma}catch(eCheckFigma){isVariableFontFigma=!1}if(isVariableFontFigma){console.log("[Variable Font] Processing Figma text: "+name+" with font: "+fontFamily+" "+fontStyle);var numericWeight=null;if(figmaData.styledSegments&&figmaData.styledSegments.length>0)for(var fwi=0;fwi<figmaData.styledSegments.length;fwi++){var fwSeg=figmaData.styledSegments[fwi];if(void 0!==fwSeg.fontWeight&&"number"==typeof fwSeg.fontWeight){numericWeight=fwSeg.fontWeight,console.log("[Variable Font] Found fontWeight in Figma styledSegments: "+numericWeight);break}}if(null!==numericWeight)try{api.set(id,{"fontAxes.0":numericWeight}),console.log("[Variable Font] Set fontAxes.0 (weight) to "+numericWeight+" for "+fontFamily)}catch(eWghtSet){}var slantVal=null,svgFontStyle=null;if(svgTextChildren){var textChildArr=Array.isArray(svgTextChildren)?svgTextChildren:[svgTextChildren];for(tci=0;tci<textChildArr.length;tci++){var tc;if((tc=textChildArr[tci]).attrs&&tc.attrs["font-style"]){svgFontStyle=tc.attrs["font-style"];break}}}if(svgFontStyle){var obliqueMatchFigma=svgFontStyle.match(/oblique\s*(-?\d+(?:\.\d+)?)\s*deg/i);obliqueMatchFigma&&obliqueMatchFigma[1]?(slantVal=parseFloat(obliqueMatchFigma[1]),console.log("[Variable Font] Parsed slant from SVG font-style: "+slantVal+" degrees")):-1===svgFontStyle.toLowerCase().indexOf("italic")&&-1===svgFontStyle.toLowerCase().indexOf("oblique")||(slantVal=-12,console.log("[Variable Font] Using default slant for italic/oblique: "+slantVal))}else{var fontStyleLowerCheckFigma=(fontStyle||"").toLowerCase();-1===fontStyleLowerCheckFigma.indexOf("italic")&&-1===fontStyleLowerCheckFigma.indexOf("oblique")||(slantVal=-12)}if(null!==slantVal)try{api.getAttributeDefinition(id,"fontAxes.1")&&(api.set(id,{"fontAxes.1":slantVal}),console.log("[Variable Font] Set fontAxes.1 (slant) to "+slantVal))}catch(eSlntSet){}}else;}catch(eVarFont){}if(figmaData.styledSegments&&figmaData.styledSegments.length>1){for(var baseFontFull=fontFamily+" "+fontStyle,fontGroups={},si=0;si<figmaData.styledSegments.length;si++){var seg,segFontFamily,segFontStyle;if((segFontFull=(segFontFamily=(seg=figmaData.styledSegments[si]).fontFamily||fontFamily)+" "+(segFontStyle=seg.fontStyle||fontStyle))!==baseFontFull){var rangeStr=adjustIndexForEmojiReplacements(seg.start,emojiMatches,emojisStripped)+":"+(adjustIndexForEmojiReplacements(seg.end,emojiMatches,emojisStripped)-1);emojiMatches.length,fontGroups[segFontFull]||(fontGroups[segFontFull]={fontFamily:segFontFamily,fontStyle:segFontStyle,fontWeight:seg.fontWeight,ranges:[]}),fontGroups[segFontFull].ranges.push(rangeStr)}}for(var fontKeys=Object.keys(fontGroups),fi=0;fi<fontKeys.length;fi++){var group=fontGroups[fontKeys[fi]];try{var styleName=group.fontStyle||"Style",applyTypefaceId=api.create("applyTypeface",styleName),indicesStr=group.ranges.join(", ");if(api.set(applyTypefaceId,{mode:1,indexMode:2,indices:indicesStr}),api.set(applyTypefaceId,{"font.font":group.fontFamily,"font.style":group.fontStyle}),void 0!==group.fontWeight&&"number"==typeof group.fontWeight)try{api.getAttributeDefinition(applyTypefaceId,"fontAxes.0")&&(api.set(applyTypefaceId,{"fontAxes.0":group.fontWeight}),console.log("[Variable Font] Apply Typeface: Set fontAxes.0 to "+group.fontWeight+" for "+group.fontStyle))}catch(eApplyAxis){}var applyTypefaceStyleLower=(group.fontStyle||"").toLowerCase();if(-1!==applyTypefaceStyleLower.indexOf("italic")||-1!==applyTypefaceStyleLower.indexOf("oblique"))try{api.getAttributeDefinition(applyTypefaceId,"fontAxes.1")&&(api.set(applyTypefaceId,{"fontAxes.1":-12}),console.log("[Variable Font] Apply Typeface: Set fontAxes.1 (slant) to -12 for "+group.fontStyle))}catch(eApplySlant){}api.connect(applyTypefaceId,"id",id,"styleBehaviours"),api.parent(applyTypefaceId,id)}catch(eApply){}}}
// This matches how other shapes handle multi-fill (see quiver_svgParser.js)
if((fills=fills||[]).length>0){var textScaleY=1;try{var svgTextArr=svgTextChildren||[];Array.isArray(svgTextArr)||(svgTextArr=[svgTextArr]);for(sci=0;sci<svgTextArr.length;sci++)if(svgTextArr[sci]&&svgTextArr[sci].attrs&&void 0!==svgTextArr[sci].attrs._scaleY){textScaleY=svgTextArr[sci].attrs._scaleY;break}}catch(eScaleY){}var useStackingMode=fills.length>1;for(fi=0;fi<fills.length;fi++)try{var fillInfo=fills[fi],fillColor=fillInfo.color||"#000000",fillOpacity=void 0!==fillInfo.opacity?fillInfo.opacity:1,gradientId=null;if(fillColor&&-1!==fillColor.indexOf("url(#")){var urlMatch=fillColor.match(/url\(#([^)]+)\)/);urlMatch&&urlMatch[1]&&(gradientId=urlMatch[1])}if(gradientId)
// getGradientShader and connectShaderToShape are from quiver_utilities_gradient.js
try{var gradShader=getGradientShader(gradientId);if(gradShader)connectShaderToShape(gradShader,id,null,fillOpacity,textScaleY)}catch(eGrad){}else{var hexClean=fillColor.replace("#",""),rVal=parseInt(hexClean.substring(0,2),16)||0,gVal=parseInt(hexClean.substring(2,4),16)||0,bVal=parseInt(hexClean.substring(4,6),16)||0,aVal=Math.round(255*fillOpacity);if(useStackingMode){var shaderName="Fill "+(fi+1)+" "+fillColor.toUpperCase(),shaderId=api.create("colorShader",shaderName);api.set(shaderId,{"shaderColor.r":rVal,"shaderColor.g":gVal,"shaderColor.b":bVal,"shaderColor.a":aVal}),api.set(shaderId,{alpha:Math.round(100*fillOpacity)}),api.connect(shaderId,"id",id,"material.colorShaders"),api.parent(shaderId,id)}else api.set(id,{"material.materialColor":fillColor}),fillOpacity<1&&api.set(id,{"material.alpha":100*fillOpacity})}}catch(eFillShader){}}else try{fillColor="#000000";if(figmaData.styledSegments&&figmaData.styledSegments[0]&&figmaData.styledSegments[0].fillColor){var fc=figmaData.styledSegments[0].fillColor;fillColor="#"+fc.r.toString(16).padStart(2,"0")+fc.g.toString(16).padStart(2,"0")+fc.b.toString(16).padStart(2,"0")}api.set(id,{"material.materialColor":fillColor})}catch(eFill){}return"function"==typeof registerCreatedTextShape&&registerCreatedTextShape(figmaData.name||name,id),id}catch(e){return null}}
// quiver_processAndImport.js
function importNode(node,parentId,vb,inheritedTranslate,stats,model,inHiddenDefs,inheritedScale,parentMatrix){inheritedTranslate=inheritedTranslate||{x:0,y:0},inheritedScale=inheritedScale||{x:1,y:1},parentMatrix=parentMatrix||null,inHiddenDefs=!!inHiddenDefs;var nodeT=parseTranslate(node.attrs&&node.attrs.transform);if("g"===node.type||"svg"===node.type||"root"===node.type){if("g"===node.type&&(!node.children||0===node.children.length))return null;if("g"===node.type&&node.attrs&&"true"===node.attrs["data-figma-skip-parse"])return null;var rawGroupName=decodeEntitiesForName(node.name||"group"),groupName=rawGroupName;"g"!==node.type||"g"!==rawGroupName&&"group"!==rawGroupName||(groupName="Group "+ ++__groupCounter);var groupScale={x:1,y:1},groupMatrix=null;if(node.attrs&&node.attrs.transform){var decomposed=decomposeMatrix(groupMatrix=parseTransformMatrixList(node.attrs.transform));groupScale.x=decomposed.scaleX,groupScale.y=decomposed.scaleY}var combinedScale={x:inheritedScale.x*groupScale.x,y:inheritedScale.y*groupScale.y},gid=parentId;if("g"===node.type){var tStrG=node.attrs&&node.attrs.transform||"",rotG=getRotationDegFromTransform(tStrG),tXYG=parseTranslate(tStrG),hasStyleG=!(!node.attrs||!(node.attrs.fill||node.attrs.stroke||node.attrs.opacity||node.attrs["fill-opacity"]||node.attrs["stroke-opacity"]||node.attrs.style)),isAnonG="g"===groupName,inheritedFilterForFlatten=function(){try{var fidLocal=extractUrlRefId(node.attrs&&node.attrs.filter);return!fidLocal&&node.attrs&&node.attrs._inheritedFilterId&&(fidLocal=node.attrs._inheritedFilterId),fidLocal||null}catch(e){return null}}();if(isAnonG&&Math.abs(rotG)<1e-4&&Math.abs(tXYG.x)<1e-4&&Math.abs(tXYG.y)<1e-4&&!hasStyleG){var chosenChildIndex=null;if(inheritedFilterForFlatten){for(var ci=0;ci<node.children.length;ci++){var tCh=node.children[ci].type;if("path"===tCh||"rect"===tCh||"circle"===tCh||"ellipse"===tCh||"text"===tCh||"polygon"===tCh||"polyline"===tCh||"line"===tCh){chosenChildIndex=ci;break}}if(null===chosenChildIndex)for(var cj=0;cj<node.children.length;cj++)if("g"===node.children[cj].type){chosenChildIndex=cj;break}}for(var fi=0;fi<node.children.length;fi++)inheritedFilterForFlatten&&fi===chosenChildIndex&&(node.children[fi].attrs||(node.children[fi].attrs={}),node.children[fi].attrs.filter||(node.children[fi].attrs._inheritedFilterId=inheritedFilterForFlatten)),importNode(node.children[fi],parentId,vb,{x:0,y:0},stats,model,!1,inheritedScale,parentMatrix);return parentId}}if("g"===node.type&&node.children&&1===node.children.length){var hasBlendMode=!1;if(node.attrs&&(hasBlendMode=!!(node.attrs["mix-blend-mode"]||node.attrs.style&&extractStyleProperty(node.attrs.style,"mix-blend-mode"))),hasBlendMode){var singleChild=node.children[0];if(singleChild.attrs||(singleChild.attrs={}),node.attrs["mix-blend-mode"]&&(singleChild.attrs["mix-blend-mode"]=node.attrs["mix-blend-mode"]),node.attrs.style){var blendModeFromStyle=extractStyleProperty(node.attrs.style,"mix-blend-mode");blendModeFromStyle&&(singleChild.attrs.style||(singleChild.attrs.style=""),singleChild.attrs["mix-blend-mode"]||extractStyleProperty(singleChild.attrs.style,"mix-blend-mode")||(singleChild.attrs.style=(singleChild.attrs.style?singleChild.attrs.style+"; ":"")+"mix-blend-mode: "+blendModeFromStyle))}node.attrs.opacity&&!singleChild.attrs.opacity&&(singleChild.attrs.opacity=node.attrs.opacity),node.attrs["data-figma-bg-blur-radius"]&&!singleChild.attrs["data-figma-bg-blur-radius"]&&(singleChild.attrs["data-figma-bg-blur-radius"]=node.attrs["data-figma-bg-blur-radius"]);var groupFilterId=extractUrlRefId(node.attrs.filter);!groupFilterId&&node.attrs._inheritedFilterId&&(groupFilterId=node.attrs._inheritedFilterId),!groupFilterId||singleChild.attrs.filter||singleChild.attrs._inheritedFilterId||(singleChild.attrs._inheritedFilterId=groupFilterId);var parentMasks=node.attrs._inheritedMaskIds||[],groupClipPath=extractUrlRefId(node.attrs.mask)||extractUrlRefId(node.attrs["clip-path"]),allMasks=parentMasks.slice();if(groupClipPath&&allMasks.push(groupClipPath),allMasks.length>0){singleChild.attrs._inheritedMaskIds||(singleChild.attrs._inheritedMaskIds=[]);for(var mIdx=0;mIdx<allMasks.length;mIdx++)-1===singleChild.attrs._inheritedMaskIds.indexOf(allMasks[mIdx])&&singleChild.attrs._inheritedMaskIds.push(allMasks[mIdx])}var childName=(singleChild.name||"").toLowerCase(),parentName=node.name||"";return-1!==["rect","circle","ellipse","path","polygon","polyline","line",""].indexOf(childName)&&!("g"===parentName||"group"===parentName||""===parentName)&&(singleChild.name=parentName),importNode(singleChild,parentId,vb,inheritedTranslate,stats,model,inHiddenDefs,inheritedScale,parentMatrix),parentId}}if("g"===node.type&&node.children&&node.children.length>0){for(var allChildrenAreText=!0,tci=0;tci<node.children.length;tci++)if("text"!==node.children[tci].type){allChildrenAreText=!1;break}if(allChildrenAreText&&"function"==typeof getFigmaTextData){var figmaTextForGroup=getFigmaTextData(rawGroupName);if(figmaTextForGroup&&figmaTextForGroup.characters){for(var textFills=[],seenFills={},fci=0;fci<node.children.length;fci++){var textChild=node.children[fci],childFill=textChild.attrs&&textChild.attrs.fill,childOpacity=parseFloat(textChild.attrs&&textChild.attrs["fill-opacity"])||1;if(childFill&&"none"!==childFill&&!seenFills[childFill]&&(seenFills[childFill]=!0,textFills.push({color:childFill,opacity:childOpacity})),textChild.attrs&&textChild.attrs._additionalFills)for(var addFills=textChild.attrs._additionalFills,afi=0;afi<addFills.length;afi++){var addFill=addFills[afi].fill,addOpacity=parseFloat(addFills[afi].fillOpacity)||1;addFill&&"none"!==addFill&&!seenFills[addFill]&&(seenFills[addFill]=!0,textFills.push({color:addFill,opacity:addOpacity}))}}for(var svgTextChildren=[],sti=0;sti<node.children.length;sti++)"text"===node.children[sti].type&&node.children[sti].tspans&&node.children[sti].tspans.length>0&&svgTextChildren.push(node.children[sti]);var styledTextId=createTextFromFigmaData(figmaTextForGroup,parentId,vb,inheritedScale,textFills,svgTextChildren);if(styledTextId){_registerChild(parentId,styledTextId);try{var styledMaskIds=node.attrs&&node.attrs._inheritedMaskIds||[],ownStyledMask=extractUrlRefId(node.attrs&&node.attrs.mask)||extractUrlRefId(node.attrs&&node.attrs["clip-path"]);ownStyledMask&&(styledMaskIds=styledMaskIds.concat([ownStyledMask]));for(var smi=0;smi<styledMaskIds.length;smi++)createMaskShapeForTarget(styledMaskIds[smi],styledTextId,parentId,vb,model)}catch(eStyledMask){}var blendModeApplied=!1,groupBlendMode=node.attrs&&(node.attrs["mix-blend-mode"]||node.attrs.style&&extractStyleProperty(node.attrs.style,"mix-blend-mode"));if(groupBlendMode&&"normal"!==groupBlendMode&&(applyBlendMode(styledTextId,node.attrs),blendModeApplied=!0),!blendModeApplied&&node.children&&node.children.length>0)for(var bmIdx=0;bmIdx<node.children.length&&!blendModeApplied;bmIdx++){var bmChild=node.children[bmIdx];if("text"===bmChild.type&&bmChild.attrs){var childBlendMode=bmChild.attrs["mix-blend-mode"]||bmChild.attrs.style&&extractStyleProperty(bmChild.attrs.style,"mix-blend-mode");childBlendMode&&"normal"!==childBlendMode&&(applyBlendMode(styledTextId,bmChild.attrs),blendModeApplied=!0)}}try{var fIdStyled=extractUrlRefId(node.attrs&&node.attrs.filter);if(!fIdStyled&&node.attrs&&node.attrs._inheritedFilterId&&(fIdStyled=node.attrs._inheritedFilterId),!fIdStyled&&node.children&&node.children.length>0)for(var fcIdx=0;fcIdx<node.children.length&&!fIdStyled;fcIdx++){var filterChild=node.children[fcIdx];if("text"===filterChild.type&&filterChild.attrs){var childFilterId=extractUrlRefId(filterChild.attrs.filter);childFilterId||(childFilterId=filterChild.attrs._inheritedFilterId),childFilterId&&(fIdStyled=childFilterId)}}if(fIdStyled&&__svgFilterMap&&__svgFilterMap[fIdStyled]){for(var passesStyled=detectShadowPasses(__svgFilterMap[fIdStyled]),pStyled=0;pStyled<passesStyled.length;pStyled++)createAndAttachDropShadow(styledTextId,passesStyled[pStyled]);for(var innerPassesStyled=detectInnerShadowPasses(__svgFilterMap[fIdStyled]),inpStyled=0;inpStyled<innerPassesStyled.length;inpStyled++)createAndAttachInnerShadow(styledTextId,innerPassesStyled[inpStyled]);var blurAmtStyled=detectBlurAmount(__svgFilterMap[fIdStyled]);null!==blurAmtStyled&&createAndAttachBlur(styledTextId,blurAmtStyled)}}catch(eStyledFilter){console.warn("[Styled Text] Error applying filters: "+(eStyledFilter.message||eStyledFilter))}return stats&&(stats.texts=(stats.texts||0)+1),styledTextId}}}}"svg"!==node.type&&(_registerChild(parentId,gid=createGroup(groupName,parentId)),stats&&(stats.groups=(stats.groups||0)+1),applyBlendMode(gid,node.attrs));var inheritedFilterId=extractUrlRefId(node.attrs&&node.attrs.filter);if(!inheritedFilterId&&node.attrs&&node.attrs._inheritedFilterId&&(inheritedFilterId=node.attrs._inheritedFilterId),!groupMatrix){var rotDeg=getRotationDegFromTransform(node.attrs&&node.attrs.transform||"");if(Math.abs(rotDeg)>1e-4&&null!=gid&&api.set(gid,{rotation:-rotDeg}),(0!==nodeT.x||0!==nodeT.y)&&"root"!==node.type){var zero=svgToCavalryPosition(0,0,vb),moved=svgToCavalryPosition(nodeT.x,nodeT.y,vb);api.set(gid,{"position.x":moved.x-zero.x,"position.y":moved.y-zero.y})}}var childTargets=node.children.slice();if(inheritedFilterId){for(var geomIdxs=[],gi2=0;gi2<childTargets.length;gi2++){var t=childTargets[gi2].type;("path"===t||"rect"===t||"circle"===t||"ellipse"===t||"text"===t||"polygon"===t||"polyline"===t||"line"===t||"image"===t)&&geomIdxs.push(gi2)}for(var chosenIdx=null,gi3=0;gi3<geomIdxs.length;gi3++){var idx=geomIdxs[gi3],nm=(childTargets[idx].name||"")+"";if(/editableShape#\d+/i.test(nm)){chosenIdx=idx;break}if("path"===nm){chosenIdx=idx;break}}if(null===chosenIdx&&geomIdxs.length>0&&(chosenIdx=geomIdxs[0]),null===chosenIdx){for(var wrapperIdx=null,wi=0;wi<childTargets.length;wi++){var ctw=childTargets[wi];if("g"===ctw.type&&ctw.attrs&&(ctw.attrs["clip-path"]||ctw.attrs.clipPath)){wrapperIdx=wi;break}}if(null===wrapperIdx)for(var wj=0;wj<childTargets.length;wj++)if("g"===childTargets[wj].type){wrapperIdx=wj;break}null!==wrapperIdx&&(chosenIdx=wrapperIdx)}for(var ci2=0;ci2<childTargets.length;ci2++){var chN=childTargets[ci2];chN.attrs||(chN.attrs={}),!!extractUrlRefId(chN.attrs.filter)||ci2!==chosenIdx||(chN.attrs._inheritedFilterId=inheritedFilterId)}}var groupBgBlur=node.attrs&&node.attrs["data-figma-bg-blur-radius"];if(groupBgBlur)for(var blurIdx=0;blurIdx<childTargets.length;blurIdx++){var blurChild=childTargets[blurIdx],blurType=blurChild.type;if(("path"===blurType||"rect"===blurType||"circle"===blurType||"ellipse"===blurType||"polygon"===blurType||"polyline"===blurType)&&!blurChild.attrs["data-figma-bg-blur-radius"]){blurChild.attrs||(blurChild.attrs={}),blurChild.attrs["data-figma-bg-blur-radius"]=groupBgBlur;break}}groupName=node.attrs&&node.attrs.id||node.name||"unnamed";var ownMaskId=extractUrlRefId(node.attrs&&node.attrs.mask)||extractUrlRefId(node.attrs&&node.attrs["clip-path"]),masksToPropagate=(node.attrs&&node.attrs._inheritedMaskIds||[]).slice();ownMaskId&&masksToPropagate.push(ownMaskId);for(var dbgC=0;dbgC<childTargets.length;dbgC++)childTargets[dbgC];if(masksToPropagate.length>0)for(var mi=0;mi<childTargets.length;mi++){var chM=childTargets[mi];chM.attrs||(chM.attrs={});extractUrlRefId(chM.attrs.mask)||extractUrlRefId(chM.attrs["clip-path"]);chM.attrs._inheritedMaskIds=masksToPropagate.slice()}var groupOpacity=parseFloat(node.attrs&&node.attrs.opacity),inheritedOpacity=parseFloat(node.attrs&&node.attrs._inheritedOpacity);isNaN(groupOpacity)&&(groupOpacity=1),isNaN(inheritedOpacity)&&(inheritedOpacity=1);var effectiveGroupOpacity=groupOpacity*inheritedOpacity;if(effectiveGroupOpacity<.999)for(var oi=0;oi<childTargets.length;oi++){var chO=childTargets[oi];chO.attrs||(chO.attrs={}),chO.attrs._inheritedOpacity=effectiveGroupOpacity}var composedMatrix=groupMatrix;parentMatrix&&groupMatrix?composedMatrix=_matMultiply(parentMatrix,groupMatrix):parentMatrix&&!groupMatrix&&(composedMatrix=parentMatrix);for(var i=0;i<node.children.length;i++)importNode(node.children[i],gid,vb,{x:0,y:0},stats,model,!1,combinedScale,composedMatrix);return gid}if("clipPath"===node.type||"mask"===node.type||"defs"===node.type){for(var i2=0;i2<node.children.length;i2++)importNode(node.children[i2],parentId,vb,{x:0,y:0},stats,model,!0,inheritedScale,parentMatrix);return null}if(inHiddenDefs)return null;if("rect"===node.type){var rectFill=node.attrs&&node.attrs.fill,hasFigmaGradientData=!(!node.attrs||!node.attrs["data-figma-gradient-fill"]),isGenericName="rect"===node.name||!node.name;if(rectFill&&!hasFigmaGradientData&&isGenericName){var fillIdMatch=/url\(#([^)]+)\)/.exec(rectFill);if(fillIdMatch){var fillId=fillIdMatch[1].toLowerCase();if(-1!==fillId.indexOf("_diamond_")||-1!==fillId.indexOf("_angular_"))return null}}var clone=JSON.parse(JSON.stringify(node)),x=parseFloat(clone.attrs.x||"0"),y=parseFloat(clone.attrs.y||"0"),w=parseFloat(clone.attrs.width||"0"),h=parseFloat(clone.attrs.height||"0");node.name;if(parentMatrix){var tl={x:parentMatrix.a*x+parentMatrix.c*y+parentMatrix.e,y:parentMatrix.b*x+parentMatrix.d*y+parentMatrix.f},tr={x:parentMatrix.a*(x+w)+parentMatrix.c*y+parentMatrix.e,y:parentMatrix.b*(x+w)+parentMatrix.d*y+parentMatrix.f},bl={x:parentMatrix.a*x+parentMatrix.c*(y+h)+parentMatrix.e,y:parentMatrix.b*x+parentMatrix.d*(y+h)+parentMatrix.f},br={x:parentMatrix.a*(x+w)+parentMatrix.c*(y+h)+parentMatrix.e,y:parentMatrix.b*(x+w)+parentMatrix.d*(y+h)+parentMatrix.f},minXP=Math.min(tl.x,tr.x,bl.x,br.x),maxXP=Math.max(tl.x,tr.x,bl.x,br.x),minYP=Math.min(tl.y,tr.y,bl.y,br.y),maxYP=Math.max(tl.y,tr.y,bl.y,br.y);clone.attrs.x=minXP.toString(),clone.attrs.y=minYP.toString(),clone.attrs.width=(maxXP-minXP).toString(),clone.attrs.height=(maxYP-minYP).toString(),delete clone.attrs.transform}else if(node.attrs&&node.attrs.transform){var transformStr=node.attrs.transform,hasMatrix=-1!==transformStr.indexOf("matrix"),hasRotate=-1!==transformStr.indexOf("rotate"),hasScale=-1!==transformStr.indexOf("scale"),hasSkew=-1!==transformStr.indexOf("skew");if(hasMatrix||hasRotate||hasScale||hasSkew){var fullMatrix=parseTransformMatrixList(transformStr),rotationDeg=(decomposed=decomposeMatrix(fullMatrix)).rotationDeg||0,centerX=x+w/2,centerY=y+h/2,transformedCenterX=fullMatrix.a*centerX+fullMatrix.c*centerY+fullMatrix.e,transformedCenterY=fullMatrix.b*centerX+fullMatrix.d*centerY+fullMatrix.f;clone.attrs.width=w.toString(),clone.attrs.height=h.toString(),clone.attrs._rotationDeg=rotationDeg,clone.attrs._transformedCenterX=transformedCenterX+inheritedTranslate.x,clone.attrs._transformedCenterY=transformedCenterY+inheritedTranslate.y,clone.attrs.x=(transformedCenterX-w/2+inheritedTranslate.x).toString(),clone.attrs.y=(transformedCenterY-h/2+inheritedTranslate.y).toString(),clone.attrs._localCenterX=x+w/2,clone.attrs._localCenterY=y+h/2,clone.attrs._scaleY=decomposed.scaleY,delete clone.attrs.transform}else clone.attrs.x=(x+nodeT.x+inheritedTranslate.x).toString(),clone.attrs.y=(y+nodeT.y+inheritedTranslate.y).toString(),clone.attrs._localCenterX=x+w/2,clone.attrs._localCenterY=y+h/2,!clone.attrs.transform||0===nodeT.x&&0===nodeT.y||(clone.attrs.transform=clone.attrs.transform.replace(/translate\([^)]*\)\s*/g,"").trim(),""===clone.attrs.transform&&delete clone.attrs.transform)}else clone.attrs.x=(x+inheritedTranslate.x).toString(),clone.attrs.y=(y+inheritedTranslate.y).toString(),clone.attrs._localCenterX=x+w/2,clone.attrs._localCenterY=y+h/2;var rid=createRect(clone,parentId,vb);_registerChild(parentId,rid);try{var fId=extractUrlRefId(node.attrs&&node.attrs.filter);if(!fId&&node.attrs&&node.attrs._inheritedFilterId&&(fId=node.attrs._inheritedFilterId),fId&&__svgFilterMap&&__svgFilterMap[fId]){var siblings=__groupDirectChildren[parentId]||[];if(!((node.name||"")+"").match(/editableShape#\d+/i)&&siblings.length>0){for(var hasEditableNamed=!1,si0=0;si0<siblings.length;si0++)try{var n0=api.getName(siblings[si0])||"";if(/editableShape#\d+/i.test(n0)){hasEditableNamed=!0;break}}catch(eGN){}hasEditableNamed&&(fId=null)}}if(fId&&__svgFilterMap&&__svgFilterMap[fId]){for(var passes=detectShadowPasses(__svgFilterMap[fId]),pi=0;pi<passes.length;pi++)createAndAttachDropShadow(rid,passes[pi]);for(var innerPasses=detectInnerShadowPasses(__svgFilterMap[fId]),ipi=0;ipi<innerPasses.length;ipi++)createAndAttachInnerShadow(rid,innerPasses[ipi],ipi,innerPasses.length);var blurAmount=detectBlurAmount(__svgFilterMap[fId]);null!==blurAmount&&createAndAttachBlur(rid,blurAmount)}}catch(eDs){}try{var bgBlurRadius=node.attrs&&node.attrs["data-figma-bg-blur-radius"];if(bgBlurRadius){var bgBlurAmount=parseFloat(bgBlurRadius);!isNaN(bgBlurAmount)&&bgBlurAmount>0&&queueBackgroundBlur(rid,bgBlurAmount,parentId)}}catch(eBgBlur){console.warn("[Background Blur] Error processing rect: "+eBgBlur.message)}try{var allMaskIds=node.attrs&&node.attrs._inheritedMaskIds?node.attrs._inheritedMaskIds.slice():[],ownMask=extractUrlRefId(node.attrs&&node.attrs.mask)||extractUrlRefId(node.attrs&&node.attrs["clip-path"]);ownMask&&-1===allMaskIds.indexOf(ownMask)&&allMaskIds.push(ownMask);var svgGeometry={x:x,y:y,width:w,height:h};if(allMaskIds.length>0){for(var mri=0;mri<allMaskIds.length;mri++)createMaskShapeForTarget(allMaskIds[mri],rid,parentId,vb,model,svgGeometry);allMaskIds.length}}catch(eMask){}var rotDegR=getRotationDegFromTransform(node.attrs&&node.attrs.transform||"");return Math.abs(rotDegR)>1e-4&&api.set(rid,{rotation:-rotDegR}),stats&&(stats.rects=(stats.rects||0)+1),rid}if("circle"===node.type){var cloneC=JSON.parse(JSON.stringify(node)),cxCircle=parseFloat(cloneC.attrs.cx||"0"),cyCircle=parseFloat(cloneC.attrs.cy||"0");if(node.attrs&&node.attrs.transform&&-1!==node.attrs.transform.indexOf("matrix")){var transformed=applyMatrixToPoint(node.attrs.transform,cxCircle,cyCircle);cloneC.attrs.cx=(transformed.x+inheritedTranslate.x).toString(),cloneC.attrs.cy=(transformed.y+inheritedTranslate.y).toString(),cloneC.attrs._localCenterX=cxCircle,cloneC.attrs._localCenterY=cyCircle;var decomposedC=decomposeMatrix(parseTransformMatrixList(node.attrs.transform));Math.abs(decomposedC.rotationDeg)>1e-4&&(cloneC.attrs._rotationDeg=decomposedC.rotationDeg),cloneC.attrs._scaleY=decomposedC.scaleY,delete cloneC.attrs.transform}else cloneC.attrs.cx=(cxCircle+nodeT.x+inheritedTranslate.x).toString(),cloneC.attrs.cy=(cyCircle+nodeT.y+inheritedTranslate.y).toString(),cloneC.attrs._localCenterX=cxCircle,cloneC.attrs._localCenterY=cyCircle,(cloneC.attrs.transform&&0!==nodeT.x||0!==nodeT.y)&&(cloneC.attrs.transform=cloneC.attrs.transform.replace(/translate\([^)]*\)\s*/g,"").trim(),""===cloneC.attrs.transform&&delete cloneC.attrs.transform);var cid=createCircle(cloneC,parentId,vb);_registerChild(parentId,cid);try{var fIdC=extractUrlRefId(node.attrs&&node.attrs.filter);if(!fIdC&&node.attrs&&node.attrs._inheritedFilterId&&(fIdC=node.attrs._inheritedFilterId),fIdC&&__svgFilterMap&&__svgFilterMap[fIdC]){for(var passesC=detectShadowPasses(__svgFilterMap[fIdC]),pC=0;pC<passesC.length;pC++)createAndAttachDropShadow(cid,passesC[pC]);for(var innerPassesC=detectInnerShadowPasses(__svgFilterMap[fIdC]),ipC=0;ipC<innerPassesC.length;ipC++)createAndAttachInnerShadow(cid,innerPassesC[ipC],ipC,innerPassesC.length);var blurAmountC=detectBlurAmount(__svgFilterMap[fIdC]);null!==blurAmountC&&createAndAttachBlur(cid,blurAmountC)}}catch(eDsC){}try{var bgBlurRadiusC=node.attrs&&node.attrs["data-figma-bg-blur-radius"];if(bgBlurRadiusC){var bgBlurAmountC=parseFloat(bgBlurRadiusC);!isNaN(bgBlurAmountC)&&bgBlurAmountC>0&&queueBackgroundBlur(cid,bgBlurAmountC,parentId)}}catch(eBgBlurC){console.warn("[Background Blur] Error processing circle: "+eBgBlurC.message)}try{var allMaskIdsC=node.attrs&&node.attrs._inheritedMaskIds?node.attrs._inheritedMaskIds.slice():[],ownMaskC=extractUrlRefId(node.attrs&&node.attrs.mask)||extractUrlRefId(node.attrs&&node.attrs["clip-path"]);ownMaskC&&-1===allMaskIdsC.indexOf(ownMaskC)&&allMaskIdsC.push(ownMaskC);var svgGeometryC={cx:cx,cy:cy,r:parseFloat(node.attrs.r||"0")};if(allMaskIdsC.length>0){for(var mci=0;mci<allMaskIdsC.length;mci++)createMaskShapeForTarget(allMaskIdsC[mci],cid,parentId,vb,model,svgGeometryC);allMaskIdsC.length}}catch(eMaskC){}var rotDegC=getRotationDegFromTransform(node.attrs&&node.attrs.transform||"");return Math.abs(rotDegC)>1e-4&&api.set(cid,{rotation:-rotDegC}),stats&&(stats.circles=(stats.circles||0)+1),cid}if("ellipse"===node.type){var cloneE=JSON.parse(JSON.stringify(node)),cx=parseFloat(cloneE.attrs.cx||"0"),cy=parseFloat(cloneE.attrs.cy||"0");parseFloat(cloneE.attrs.rx||"0"),parseFloat(cloneE.attrs.ry||"0");if(node.attrs&&node.attrs.transform&&-1!==node.attrs.transform.indexOf("matrix")){transformed=applyMatrixToPoint(node.attrs.transform,cx,cy);cloneE.attrs.cx=(transformed.x+inheritedTranslate.x).toString(),cloneE.attrs.cy=(transformed.y+inheritedTranslate.y).toString(),cloneE.attrs._localCenterX=cx,cloneE.attrs._localCenterY=cy;var decomposedE=decomposeMatrix(parseTransformMatrixList(node.attrs.transform));Math.abs(decomposedE.rotationDeg)>1e-4&&(cloneE.attrs._rotationDeg=decomposedE.rotationDeg),cloneE.attrs._scaleY=decomposedE.scaleY,delete cloneE.attrs.transform}else cloneE.attrs.cx=(cx+nodeT.x+inheritedTranslate.x).toString(),cloneE.attrs.cy=(cy+nodeT.y+inheritedTranslate.y).toString(),cloneE.attrs._localCenterX=cx,cloneE.attrs._localCenterY=cy,(cloneE.attrs.transform&&0!==nodeT.x||0!==nodeT.y)&&(cloneE.attrs.transform=cloneE.attrs.transform.replace(/translate\([^)]*\)\s*/g,"").trim(),""===cloneE.attrs.transform&&delete cloneE.attrs.transform);var eid=createEllipse(cloneE,parentId,vb);_registerChild(parentId,eid);try{var fIdE=extractUrlRefId(node.attrs&&node.attrs.filter);if(!fIdE&&node.attrs&&node.attrs._inheritedFilterId&&(fIdE=node.attrs._inheritedFilterId),fIdE&&__svgFilterMap&&__svgFilterMap[fIdE]){for(var passesE=detectShadowPasses(__svgFilterMap[fIdE]),pE=0;pE<passesE.length;pE++)createAndAttachDropShadow(eid,passesE[pE]);for(var innerPassesE=detectInnerShadowPasses(__svgFilterMap[fIdE]),ipE=0;ipE<innerPassesE.length;ipE++)createAndAttachInnerShadow(eid,innerPassesE[ipE],ipE,innerPassesE.length);var blurAmountE=detectBlurAmount(__svgFilterMap[fIdE]);null!==blurAmountE&&createAndAttachBlur(eid,blurAmountE)}}catch(eDsE){}try{var bgBlurRadiusE=node.attrs&&node.attrs["data-figma-bg-blur-radius"];if(bgBlurRadiusE){var bgBlurAmountE=parseFloat(bgBlurRadiusE);!isNaN(bgBlurAmountE)&&bgBlurAmountE>0&&queueBackgroundBlur(eid,bgBlurAmountE,parentId)}}catch(eBgBlurE){console.warn("[Background Blur] Error processing ellipse: "+eBgBlurE.message)}try{var allMaskIdsE=node.attrs&&node.attrs._inheritedMaskIds?node.attrs._inheritedMaskIds.slice():[],ownMaskE=extractUrlRefId(node.attrs&&node.attrs.mask)||extractUrlRefId(node.attrs&&node.attrs["clip-path"]);ownMaskE&&-1===allMaskIdsE.indexOf(ownMaskE)&&allMaskIdsE.push(ownMaskE);var svgGeometryE={cx:cx,cy:cy,rx:parseFloat(node.attrs.rx||"0"),ry:parseFloat(node.attrs.ry||"0")};if(allMaskIdsE.length>0){for(var mei=0;mei<allMaskIdsE.length;mei++)createMaskShapeForTarget(allMaskIdsE[mei],eid,parentId,vb,model,svgGeometryE);allMaskIdsE.length}}catch(eMaskE){}var rotDegE=getRotationDegFromTransform(node.attrs&&node.attrs.transform||"");return Math.abs(rotDegE)>1e-4&&api.set(eid,{rotation:-rotDegE}),stats&&(stats.ellipses=(stats.ellipses||0)+1),eid}if("text"===node.type){var cloneT=JSON.parse(JSON.stringify(node));if(parentMatrix){for(var k=0;k<cloneT.tspans.length;k++){var origX=cloneT.tspans[k].x,origY=cloneT.tspans[k].y,newX=parentMatrix.a*origX+parentMatrix.c*origY+parentMatrix.e,newY=parentMatrix.b*origX+parentMatrix.d*origY+parentMatrix.f;cloneT.tspans[k].x=newX,cloneT.tspans[k].y=newY}var decomposedParentT=decomposeMatrix(parentMatrix);cloneT.attrs||(cloneT.attrs={}),cloneT.attrs._scaleY=decomposedParentT.scaleY}if(node.attrs&&node.attrs.transform&&-1!==node.attrs.transform.indexOf("matrix")){for(k=0;k<cloneT.tspans.length;k++){transformed=applyMatrixToPoint(node.attrs.transform,cloneT.tspans[k].x,cloneT.tspans[k].y);cloneT.tspans[k].x=transformed.x+inheritedTranslate.x,cloneT.tspans[k].y=transformed.y+inheritedTranslate.y}var decomposedT=decomposeMatrix(parseTransformMatrixList(node.attrs.transform));cloneT.attrs._scaleY=decomposedT.scaleY}else if(!parentMatrix)for(k=0;k<cloneT.tspans.length;k++)cloneT.tspans[k].x+=nodeT.x+inheritedTranslate.x,cloneT.tspans[k].y+=nodeT.y+inheritedTranslate.y;var tid=createText(cloneT,parentId,vb,inheritedScale);if(!tid)return null;_registerChild(parentId,tid);try{var fIdT=extractUrlRefId(node.attrs&&node.attrs.filter);if(!fIdT&&node.attrs&&node.attrs._inheritedFilterId&&(fIdT=node.attrs._inheritedFilterId),fIdT&&__svgFilterMap&&__svgFilterMap[fIdT]){for(var passesT=detectShadowPasses(__svgFilterMap[fIdT]),pT=0;pT<passesT.length;pT++)createAndAttachDropShadow(tid,passesT[pT]);for(var innerPassesT=detectInnerShadowPasses(__svgFilterMap[fIdT]),ipT=0;ipT<innerPassesT.length;ipT++)createAndAttachInnerShadow(tid,innerPassesT[ipT],ipT,innerPassesT.length);var blurAmountT=detectBlurAmount(__svgFilterMap[fIdT]);null!==blurAmountT&&createAndAttachBlur(tid,blurAmountT)}}catch(eDsT){}try{var allMaskIdsT=node.attrs&&node.attrs._inheritedMaskIds?node.attrs._inheritedMaskIds.slice():[],ownMaskT=extractUrlRefId(node.attrs&&node.attrs.mask)||extractUrlRefId(node.attrs&&node.attrs["clip-path"]);if(ownMaskT&&-1===allMaskIdsT.indexOf(ownMaskT)&&allMaskIdsT.push(ownMaskT),allMaskIdsT.length>0)for(var mti=0;mti<allMaskIdsT.length;mti++)createMaskShapeForTarget(allMaskIdsT[mti],tid,parentId,vb,model)}catch(eMaskT){}var rotDegT=getRotationDegFromTransform(node.attrs&&node.attrs.transform||"");return Math.abs(rotDegT)>1e-4&&api.set(tid,{rotation:-rotDegT}),stats&&(stats.texts=(stats.texts||0)+1),tid}if("image"===node.type){var cloneImg=JSON.parse(JSON.stringify(node));x=parseFloat(cloneImg.attrs.x||"0"),y=parseFloat(cloneImg.attrs.y||"0"),w=parseFloat(cloneImg.attrs.width||"0"),h=parseFloat(cloneImg.attrs.height||"0");if(node.attrs&&node.attrs.transform&&-1!==node.attrs.transform.indexOf("matrix")){tl=applyMatrixToPoint(node.attrs.transform,x,y),tr=applyMatrixToPoint(node.attrs.transform,x+w,y),bl=applyMatrixToPoint(node.attrs.transform,x,y+h),br=applyMatrixToPoint(node.attrs.transform,x+w,y+h);var minX=Math.min(tl.x,tr.x,bl.x,br.x),maxX=Math.max(tl.x,tr.x,bl.x,br.x),minY=Math.min(tl.y,tr.y,bl.y,br.y),maxY=Math.max(tl.y,tr.y,bl.y,br.y);cloneImg.attrs.x=(minX+inheritedTranslate.x).toString(),cloneImg.attrs.y=(minY+inheritedTranslate.y).toString(),cloneImg.attrs.width=(maxX-minX).toString(),cloneImg.attrs.height=(maxY-minY).toString()}else cloneImg.attrs.x=(x+nodeT.x+inheritedTranslate.x).toString(),cloneImg.attrs.y=(y+nodeT.y+inheritedTranslate.y).toString();var idImg=createImage(cloneImg,parentId,vb);_registerChild(parentId,idImg);try{var fIdI=extractUrlRefId(node.attrs&&node.attrs.filter);if(!fIdI&&node.attrs&&node.attrs._inheritedFilterId&&(fIdI=node.attrs._inheritedFilterId),fIdI&&__svgFilterMap&&__svgFilterMap[fIdI]){for(var passesI=detectShadowPasses(__svgFilterMap[fIdI]),pI=0;pI<passesI.length;pI++)createAndAttachDropShadow(idImg,passesI[pI]);for(var innerPassesI=detectInnerShadowPasses(__svgFilterMap[fIdI]),ipI=0;ipI<innerPassesI.length;ipI++)createAndAttachInnerShadow(idImg,innerPassesI[ipI],ipI,innerPassesI.length);var blurAmountI=detectBlurAmount(__svgFilterMap[fIdI]);null!==blurAmountI&&createAndAttachBlur(idImg,blurAmountI)}}catch(eDsI){}var rotDegI=getRotationDegFromTransform(node.attrs&&node.attrs.transform||"");Math.abs(rotDegI)>1e-4&&api.set(idImg,{rotation:-rotDegI});try{var rotPivotI=parseRotatePivot(node.attrs&&node.attrs.transform||"");if(rotPivotI&&null!==rotPivotI.cx&&null!==rotPivotI.cy){var newCenterSvgI=rotatePointAround(parseFloat(node.attrs.x||0)+parseFloat(node.attrs.width||0)/2,parseFloat(node.attrs.y||0)+parseFloat(node.attrs.height||0)/2,rotPivotI.angle,rotPivotI.cx,rotPivotI.cy),newPosI=svgToCavalryPosition(newCenterSvgI.x,newCenterSvgI.y,vb);api.set(idImg,{"position.x":newPosI.x,"position.y":newPosI.y})}}catch(ePI){}try{var allMaskIdsI=node.attrs&&node.attrs._inheritedMaskIds?node.attrs._inheritedMaskIds.slice():[],ownMaskI=extractUrlRefId(node.attrs&&node.attrs.mask)||extractUrlRefId(node.attrs&&node.attrs["clip-path"]);ownMaskI&&-1===allMaskIdsI.indexOf(ownMaskI)&&allMaskIdsI.push(ownMaskI);if(allMaskIdsI.length>0)for(var mii=0;mii<allMaskIdsI.length;mii++)createMaskShapeForTarget(allMaskIdsI[mii],idImg,parentId,vb,model)}catch(eMaskI){}return stats&&(stats.images=(stats.images||0)+1),idImg}if("use"===node.type){var refId=(node.attrs.href||"").replace("#",""),referencedNode=model._idIndex&&model._idIndex[refId];if(!referencedNode||"image"!==referencedNode.type)return null;var cloneUse=JSON.parse(JSON.stringify(node));cloneUse.type="image";var actualHref=referencedNode.attrs&&(referencedNode.attrs.href||referencedNode.attrs["xlink:href"]);cloneUse.attrs.href=actualHref;x=parseFloat(cloneUse.attrs.x||"0"),y=parseFloat(cloneUse.attrs.y||"0"),w=parseFloat(cloneUse.attrs.width||"0"),h=parseFloat(cloneUse.attrs.height||"0");if(parentMatrix){tl={x:parentMatrix.a*x+parentMatrix.c*y+parentMatrix.e,y:parentMatrix.b*x+parentMatrix.d*y+parentMatrix.f},tr={x:parentMatrix.a*(x+w)+parentMatrix.c*y+parentMatrix.e,y:parentMatrix.b*(x+w)+parentMatrix.d*y+parentMatrix.f},bl={x:parentMatrix.a*x+parentMatrix.c*(y+h)+parentMatrix.e,y:parentMatrix.b*x+parentMatrix.d*(y+h)+parentMatrix.f},br={x:parentMatrix.a*(x+w)+parentMatrix.c*(y+h)+parentMatrix.e,y:parentMatrix.b*(x+w)+parentMatrix.d*(y+h)+parentMatrix.f},minX=Math.min(tl.x,tr.x,bl.x,br.x),maxX=Math.max(tl.x,tr.x,bl.x,br.x),minY=Math.min(tl.y,tr.y,bl.y,br.y),maxY=Math.max(tl.y,tr.y,bl.y,br.y);cloneUse.attrs.x=minX.toString(),cloneUse.attrs.y=minY.toString(),cloneUse.attrs.width=(maxX-minX).toString(),cloneUse.attrs.height=(maxY-minY).toString()}var rectId=api.primitive("rectangle",cloneUse.name||"image");parentId&&api.parent(rectId,parentId),_registerChild(parentId,rectId);x=parseFloat(cloneUse.attrs.x||"0"),y=parseFloat(cloneUse.attrs.y||"0");var centre=svgToCavalryPosition(x+(w=parseFloat(cloneUse.attrs.width||"0"))/2,y+(h=parseFloat(cloneUse.attrs.height||"0"))/2,vb);try{api.set(rectId,{"generator.dimensions":[w,h],"position.x":centre.x,"position.y":centre.y})}catch(eSet){}__imageCounter++;var shaderName=(cloneUse.name||"image")+"_"+__imageCounter,shaderNode=api.create("imageShader",shaderName);if(shaderNode&&actualHref){var saved=_resolveImageHrefToAsset(actualHref,cloneUse),linkVal=saved||actualHref;if(linkVal){var assetId=null;try{saved&&api.loadAsset&&(assetId=api.loadAsset(saved,!1))}catch(eLoad){}if(!assetId)try{saved&&api.importAsset&&(assetId=api.importAsset(saved))}catch(eImp){}if(assetId){try{api.connect(assetId,"id",shaderNode,"image")}catch(eConn){}
// Parent asset under Quiver group
var quiverGroup=_ensureQuiverAssetGroup();if(quiverGroup)try{api.parent(assetId,quiverGroup)}catch(ePar){}}else _setFirstSupported(shaderNode,["image","generator.image","file","path"],linkVal)}try{api.setFill(rectId,!0),api.set(rectId,{"material.materialColor.a":0}),api.connect(shaderNode,"id",rectId,"material.colorShaders"),api.parent(shaderNode,rectId);try{_hasAttr(shaderNode,"legacyGraph")&&api.set(shaderNode,{legacyGraph:!1})}catch(eLG){}try{api.set(shaderNode,{scaleMode:4})}catch(eSM){}try{api.set(shaderNode,{tilingX:3,tilingY:3})}catch(eT){}var fqOk=!1;try{api.set(shaderNode,{filterQuality:imageFilterQuality}),fqOk=!0}catch(eFQ1){fqOk=!1}if(!fqOk)try{api.set(shaderNode,{"generator.filterQuality":imageFilterQuality})}catch(eFQ2){}_setFirstSupported(shaderNode,["offset","generator.offset"],[0,0])}catch(eShader){}}return stats&&(stats.images=(stats.images||0)+1),rectId}if("path"===node.type||"polygon"===node.type||"polyline"===node.type||"line"===node.type){var pathFill=node.attrs&&node.attrs.fill,pathHasFigmaGradientData=!(!node.attrs||!node.attrs["data-figma-gradient-fill"]),pathIsGenericName=node.name===node.type||!node.name;if(pathFill&&!pathHasFigmaGradientData&&pathIsGenericName){var pathFillIdMatch=/url\(#([^)]+)\)/.exec(pathFill);if(pathFillIdMatch){var pathFillId=pathFillIdMatch[1].toLowerCase();if(-1!==pathFillId.indexOf("_diamond_")||-1!==pathFillId.indexOf("_angular_"))return null}}var translateAll={x:nodeT.x+inheritedTranslate.x,y:nodeT.y+inheritedTranslate.y},hasParentMatrix=(hasMatrix=node.attrs&&node.attrs.transform&&-1!==node.attrs.transform.indexOf("matrix"),!!parentMatrix);if("line"===node.type){var x1=parseFloat(node.attrs.x1||"0"),y1=parseFloat(node.attrs.y1||"0"),x2=parseFloat(node.attrs.x2||"0"),y2=parseFloat(node.attrs.y2||"0");if(hasParentMatrix){var p1={x:parentMatrix.a*x1+parentMatrix.c*y1+parentMatrix.e,y:parentMatrix.b*x1+parentMatrix.d*y1+parentMatrix.f},p2={x:parentMatrix.a*x2+parentMatrix.c*y2+parentMatrix.e,y:parentMatrix.b*x2+parentMatrix.d*y2+parentMatrix.f};x1=p1.x,y1=p1.y,x2=p2.x,y2=p2.y,translateAll={x:0,y:0}}if(hasMatrix){var t1=applyMatrixToPoint(node.attrs.transform,x1,y1),t2=applyMatrixToPoint(node.attrs.transform,x2,y2);x1=t1.x,y1=t1.y,x2=t2.x,y2=t2.y,hasParentMatrix||(translateAll={x:inheritedTranslate.x,y:inheritedTranslate.y})}_registerChild(parentId,vecId=createEditableFromPathSegments(segments=[{cmd:"M",x:x1,y:y1},{cmd:"L",x:x2,y:y2}],node.name||"Line",parentId,vb,translateAll,node.attrs));try{var fIdL=extractUrlRefId(node.attrs&&node.attrs.filter);if(!fIdL&&node.attrs&&node.attrs._inheritedFilterId&&(fIdL=node.attrs._inheritedFilterId),fIdL&&__svgFilterMap&&__svgFilterMap[fIdL]){for(var passesL=detectShadowPasses(__svgFilterMap[fIdL]),pL=0;pL<passesL.length;pL++)createAndAttachDropShadow(vecId,passesL[pL]);for(var innerPassesL=detectInnerShadowPasses(__svgFilterMap[fIdL]),ipL=0;ipL<innerPassesL.length;ipL++)createAndAttachInnerShadow(vecId,innerPassesL[ipL],ipL,innerPassesL.length);var blurAmountL=detectBlurAmount(__svgFilterMap[fIdL]);null!==blurAmountL&&createAndAttachBlur(vecId,blurAmountL)}}catch(eDsL){}var rotDegL=getRotationDegFromTransform(node.attrs&&node.attrs.transform||"");Math.abs(rotDegL)>1e-4&&api.set(vecId,{rotation:-rotDegL});try{var allMaskIdsL=node.attrs&&node.attrs._inheritedMaskIds?node.attrs._inheritedMaskIds.slice():[],ownMaskL=extractUrlRefId(node.attrs&&node.attrs.mask)||extractUrlRefId(node.attrs&&node.attrs["clip-path"]);if(ownMaskL&&-1===allMaskIdsL.indexOf(ownMaskL)&&allMaskIdsL.push(ownMaskL),allMaskIdsL.length>0)for(var mli=0;mli<allMaskIdsL.length;mli++)createMaskShapeForTarget(allMaskIdsL[mli],vecId,parentId,vb,model)}catch(eMaskL){}try{var bgBlurRadiusL=node.attrs&&node.attrs["data-figma-bg-blur-radius"];if(bgBlurRadiusL){var bgBlurAmountL=parseFloat(bgBlurRadiusL);!isNaN(bgBlurAmountL)&&bgBlurAmountL>0&&queueBackgroundBlur(vecId,bgBlurAmountL,parentId)}}catch(eBgBlurL){console.warn("[Background Blur] Error processing line: "+eBgBlurL.message)}return stats&&(stats.paths=(stats.paths||0)+1),vecId}if("polygon"===node.type||"polyline"===node.type){var polyPts=parsePoints(node.attrs.points||"");if(hasMatrix&&polyPts){for(pi=0;pi<polyPts.length;pi++){transformed=applyMatrixToPoint(node.attrs.transform,polyPts[pi].x,polyPts[pi].y);polyPts[pi].x=transformed.x,polyPts[pi].y=transformed.y}translateAll={x:inheritedTranslate.x,y:inheritedTranslate.y}}var primId=createRegularPolygonPrimitive(node.name||("polygon"===node.type?"Polygon":"Polyline"),polyPts,parentId,vb,translateAll,node.attrs);if(primId)return stats&&(stats.paths=(stats.paths||0)+1),primId}var vecId,segments=[];if("path"===node.type){if(segments=parsePathDataToAbsolute(node.attrs.d||""),hasParentMatrix){for(var si=0;si<segments.length;si++){if(void 0!==(seg=segments[si]).x&&void 0!==seg.y){newX=parentMatrix.a*seg.x+parentMatrix.c*seg.y+parentMatrix.e,newY=parentMatrix.b*seg.x+parentMatrix.d*seg.y+parentMatrix.f;seg.x=newX,seg.y=newY}if(void 0!==seg.cp1x&&void 0!==seg.cp1y){var newCp1X=parentMatrix.a*seg.cp1x+parentMatrix.c*seg.cp1y+parentMatrix.e,newCp1Y=parentMatrix.b*seg.cp1x+parentMatrix.d*seg.cp1y+parentMatrix.f;seg.cp1x=newCp1X,seg.cp1y=newCp1Y}if(void 0!==seg.cp2x&&void 0!==seg.cp2y){var newCp2X=parentMatrix.a*seg.cp2x+parentMatrix.c*seg.cp2y+parentMatrix.e,newCp2Y=parentMatrix.b*seg.cp2x+parentMatrix.d*seg.cp2y+parentMatrix.f;seg.cp2x=newCp2X,seg.cp2y=newCp2Y}if(void 0!==seg.cpx&&void 0!==seg.cpy){var newCpX=parentMatrix.a*seg.cpx+parentMatrix.c*seg.cpy+parentMatrix.e,newCpY=parentMatrix.b*seg.cpx+parentMatrix.d*seg.cpy+parentMatrix.f;seg.cpx=newCpX,seg.cpy=newCpY}}translateAll={x:0,y:0}}if(hasMatrix){for(si=0;si<segments.length;si++){var seg;if(void 0!==(seg=segments[si]).x&&void 0!==seg.y){transformed=applyMatrixToPoint(node.attrs.transform,seg.x,seg.y);seg.x=transformed.x,seg.y=transformed.y}if(void 0!==seg.x1&&void 0!==seg.y1){t1=applyMatrixToPoint(node.attrs.transform,seg.x1,seg.y1);seg.x1=t1.x,seg.y1=t1.y}if(void 0!==seg.x2&&void 0!==seg.y2){t2=applyMatrixToPoint(node.attrs.transform,seg.x2,seg.y2);seg.x2=t2.x,seg.y2=t2.y}}hasParentMatrix||(translateAll={x:inheritedTranslate.x,y:inheritedTranslate.y})}}else if(polyPts&&polyPts.length){segments.push({cmd:"M",x:polyPts[0].x,y:polyPts[0].y});for(var ppi=1;ppi<polyPts.length;ppi++)segments.push({cmd:"L",x:polyPts[ppi].x,y:polyPts[ppi].y});"polygon"===node.type&&segments.push({cmd:"Z"})}_registerChild(parentId,vecId=createEditableFromPathSegments(segments,node.name||"Path",parentId,vb,translateAll,node.attrs));try{var fIdP=extractUrlRefId(node.attrs&&node.attrs.filter);if(!fIdP&&node.attrs&&node.attrs._inheritedFilterId&&(fIdP=node.attrs._inheritedFilterId),fIdP&&__svgFilterMap&&__svgFilterMap[fIdP]){for(var passesP=detectShadowPasses(__svgFilterMap[fIdP]),pP=0;pP<passesP.length;pP++)createAndAttachDropShadow(vecId,passesP[pP]);for(var innerPassesP=detectInnerShadowPasses(__svgFilterMap[fIdP]),ipP=0;ipP<innerPassesP.length;ipP++)createAndAttachInnerShadow(vecId,innerPassesP[ipP],ipP,innerPassesP.length);var blurAmountP=detectBlurAmount(__svgFilterMap[fIdP]);null!==blurAmountP&&createAndAttachBlur(vecId,blurAmountP)}}catch(eDsP){}try{var bgBlurRadiusP=node.attrs&&node.attrs["data-figma-bg-blur-radius"];if(bgBlurRadiusP){var bgBlurAmountP=parseFloat(bgBlurRadiusP);!isNaN(bgBlurAmountP)&&bgBlurAmountP>0&&queueBackgroundBlur(vecId,bgBlurAmountP,parentId)}}catch(eBgBlurP){console.warn("[Background Blur] Error processing path: "+eBgBlurP.message)}var rotDegP=getRotationDegFromTransform(node.attrs&&node.attrs.transform||"");Math.abs(rotDegP)>1e-4&&api.set(vecId,{rotation:-rotDegP});try{var rotPivotP=parseRotatePivot(node.attrs&&node.attrs.transform||"");if(rotPivotP&&null!==rotPivotP.cx&&null!==rotPivotP.cy){var bbp=null;try{bbp=api.getBoundingBox(vecId,!0)}catch(eBB){}if(bbp&&bbp.centre){var guessSvgX=0,guessSvgY=0,countM=0;for(si=0;si<segments.length;si++)"M"===segments[si].cmd&&(guessSvgX+=segments[si].x,guessSvgY+=segments[si].y,countM++);countM>0?(guessSvgX/=countM,guessSvgY/=countM):(guessSvgX=vb.x+vb.width/2+bbp.centre.x,guessSvgY=vb.y+vb.height/2-bbp.centre.y);var newSvgC=rotatePointAround(guessSvgX,guessSvgY,rotPivotP.angle,rotPivotP.cx,rotPivotP.cy),newPosP=svgToCavalryPosition(newSvgC.x,newSvgC.y,vb);api.set(vecId,{"position.x":newPosP.x,"position.y":newPosP.y})}}}catch(ePP){}try{var allMaskIdsP=node.attrs&&node.attrs._inheritedMaskIds?node.attrs._inheritedMaskIds.slice():[],ownMaskP=extractUrlRefId(node.attrs&&node.attrs.mask)||extractUrlRefId(node.attrs&&node.attrs["clip-path"]);ownMaskP&&-1===allMaskIdsP.indexOf(ownMaskP)&&allMaskIdsP.push(ownMaskP);var svgGeometryP=null;if("path"===node.type&&node.attrs&&node.attrs.d&&(svgGeometryP={d:node.attrs.d}),allMaskIdsP.length>0){for(var mpi=0;mpi<allMaskIdsP.length;mpi++)createMaskShapeForTarget(allMaskIdsP[mpi],vecId,parentId,vb,model,svgGeometryP);allMaskIdsP.length}}catch(eMaskP){console.error("[DEBUG MASK PATH] Error applying mask: "+(eMaskP.message||eMaskP))}return stats&&(stats.paths=(stats.paths||0)+1),vecId}return null}function postProcessMasks(modelRootId,model){}function _safeHasFill(id){try{return api.hasFill(id)}catch(e){return!1}}function _safeHasStroke(id){try{return api.hasStroke(id)}catch(e){return!1}}function _safeGet(id,attr,defv){try{var v=api.get(id,attr);return null==v?defv:v}catch(e){return defv}}function unifyPathStrokePairsAfterImport(){if(__createdPathLayers&&0!==__createdPathLayers.length){for(var byParent={},i=0;i<__createdPathLayers.length;i++){var rec=__createdPathLayers[i];if(rec&&api.layerExists(rec.id)){var p=null==rec.parent?-1:rec.parent;byParent[p]||(byParent[p]=[]),byParent[p].push(rec.id)}}for(var parentKey in byParent){for(var ids=byParent[parentKey],fills=[],strokes=[],j=0;j<ids.length;j++){var lid=ids[j],hasF=_safeHasFill(lid),hasS=_safeHasStroke(lid);hasF&&!hasS?fills.push(lid):!hasF&&hasS&&strokes.push(lid)}if(0!==fills.length&&0!==strokes.length)for(var f=0;f<fills.length;f++){var fid=fills[f],bbF=null;try{bbF=api.getBoundingBox(fid,!0)}catch(eF){}if(bbF){for(var best=null,bestScore=1e9,s=0;s<strokes.length;s++){var sid=strokes[s];if(sid){var bbS=null;try{bbS=api.getBoundingBox(sid,!0)}catch(eS){}if(bbS){var sw=parseFloat(_safeGet(sid,"stroke.width",0));if(sw>0){var dw=bbF.width-bbS.width,dh=bbF.height-bbS.height,cxDiff=Math.abs(bbF.centre.x-bbS.centre.x),cyDiff=Math.abs(bbF.centre.y-bbS.centre.y),tol=Math.max(.5,.15*sw),inner=Math.abs(dw-sw)<=tol&&Math.abs(dh-sw)<=tol,outer=Math.abs(dw+sw)<=tol&&Math.abs(dh+sw)<=tol;if((inner||outer)&&!(cxDiff>tol||cyDiff>tol)){var score=Math.abs(dw)+Math.abs(dh)+cxDiff+cyDiff;score<bestScore&&(best={sid:sid,inner:inner,outer:outer,sw:sw},bestScore=score)}}}}}if(best){try{var scol=_safeGet(best.sid,"stroke.strokeColor","#000000"),sa=_safeGet(best.sid,"stroke.alpha",100);api.setStroke(fid,!0),api.set(fid,{"stroke.strokeColor":scol,"stroke.width":best.sw,"stroke.alpha":sa});var alignEnum=best.inner?1:2;try{api.set(fid,{"stroke.align":alignEnum})}catch(eAlign){}try{api.deleteLayer(best.sid)}catch(eDel){}}catch(eMerge){}for(var s2=0;s2<strokes.length;s2++)if(strokes[s2]===best.sid){strokes[s2]=null;break}}}}}}}function flattenAllGroupsAfterImport(){var groupIds=getImportedGroupIds();if(!groupIds||0===groupIds.length)return console.info("[Flatten] No groups to flatten"),0;console.info("[Flatten] Processing "+groupIds.length+" group(s) for flattening...");for(var flattenedCount=0,unparentedCount=0,i=groupIds.length-1;i>=0;i--){var groupId=groupIds[i];try{var groupName="";try{groupName=api.getNiceName(groupId)}catch(e){console.info("[Flatten] Group "+groupId+" no longer exists, skipping");continue}try{api.getParent(groupId)}catch(e){0}var children=[];try{children=api.getChildren(groupId)}catch(e){children=[]}if(console.info('[Flatten] Group "'+groupName+'" ('+groupId+") has "+children.length+" children"),0===children.length){try{api.deleteLayer(groupId),console.info("[Flatten] Deleted empty group: "+groupName)}catch(e){}flattenedCount++;continue}for(var c=children.length-1;c>=0;c--){var childId=children[c],childName="";try{childName=api.getNiceName(childId)}catch(e){childName=childId}try{api.unParent(childId),unparentedCount++,console.info('[Flatten] Unparented "'+childName+'" from "'+groupName+'"')}catch(eUnparent){console.warn('[Flatten] Failed to unparent "'+childName+'": '+eUnparent.message)}}try{api.deleteLayer(groupId),flattenedCount++,console.info("[Flatten] Deleted group: "+groupName)}catch(eDelete){console.warn('[Flatten] Failed to delete group "'+groupName+'": '+eDelete.message)}}catch(eGroup){console.warn("[Flatten] Error processing group: "+eGroup.message)}}return console.info("[Flatten] Complete: flattened "+flattenedCount+" groups, unparented "+unparentedCount+" children"),flattenedCount}function saveSceneBeforeImport(){try{return api.saveScene(),!0}catch(e){return!1}}function svgContainsImages(svgCode){return!!/<image[^>]*>/i.test(svgCode)||!!/<pattern[^>]*>[\s\S]*?<image/i.test(svgCode)}function hasProjectPath(){try{var path=api.getProjectPath&&api.getProjectPath();return path&&""!==path&&null!==path}catch(e){return!1}}function processAndImportSVG(svgCode,options){options=options||{};try{if(!svgCode||""===(svgCode+"").trim())return console.error("No valid SVG content"),!1;if(!svgCode.includes("<svg")||!svgCode.includes("</svg>"))return console.error("Invalid SVG format"),!1;if(svgContainsImages(svgCode)&&!hasProjectPath())return console.error("üèπ Can't import images without a Project. Go to File > Project Settings to create one."),!1;var vb=extractViewBox(svgCode);vb||(vb={x:0,y:0,width:1e3,height:1e3}),__svgViewBox=vb,__imageCounter=0,__imageNamingContext={},__groupCounter=0,resetImportedGroupIds();var model=parseSVGStructure(svgCode);try{mergeFillStrokePairs(model)}catch(eMerge){}try{__svgFilterMap=extractFilters(svgCode)||{}}catch(eF){__svgFilterMap={}}try{setPatternContext(extractPatterns(svgCode)||{})}catch(ePatt){setPatternContext({})}try{setMaskContext(extractMasks(svgCode)||{}),resetMaskShapeCache()}catch(eMask){setMaskContext({}),resetMaskShapeCache()}for(var gradientMap={},gradsArr=extractGradients(svgCode),gi=0;gi<gradsArr.length;gi++){var gid=gradsArr[gi].id;gid&&(gradientMap[gid]=gradsArr[gi])}setGradientContext(gradientMap),clearDeferredBackgroundBlurs(),console.info("Creating layers‚Ä¶");var stats={groups:0,rects:0,circles:0,ellipses:0,texts:0,paths:0};for(var i=0;i<model.children.length;i++)importNode(model.children[i],null,vb,{x:0,y:0},stats,model,!1,{x:1,y:1},null);postProcessMasks(null,model);try{unifyPathStrokePairsAfterImport()}catch(eUP){}try{processDeferredBackgroundBlurs()}catch(eBgBlurPost){console.warn("[Background Blur] Post-processing error: "+eBgBlurPost.message)}var finalGroupCount=stats.groups;if(!options.skipFlatten&&void 0!==importGroupsEnabled&&!importGroupsEnabled)try{var flattened=flattenAllGroupsAfterImport();flattened>0&&(finalGroupCount=0,console.info("üèπ Flattened "+flattened+" group(s)"))}catch(eFlatten){console.warn("[Flatten] Error: "+eFlatten.message)}return console.info("üèπ Import complete ‚Äî groups: "+finalGroupCount+", rects: "+stats.rects+", circles: "+stats.circles+", ellipses: "+stats.ellipses+", texts: "+stats.texts+", paths: "+stats.paths),!0}catch(e){var errorMsg=e&&e.message?e.message:"Import failed";return"undefined"!==errorMsg&&"null"!==errorMsg&&console.error("Error: "+errorMsg),!1}}
// quiver_utilities_webserver.js
var QUIVER_PORT=8765,quiverServer=null,Quiver={version:"1.6.2",port:QUIVER_PORT,processAndImportSVG:processAndImportSVG,parseSVGStructure:parseSVGStructure,flattenShape:flattenShape,convertSelectionToRect:convertSelectionToRect,applyDynamicAlignToLayer:applyDynamicAlignToLayer,renameSelectedLayers:renameSelectedLayers,serverRunning:!1};
/**
 * Initialize the Quiver web server
 * Listens for HTTP POST requests from external tools (Figma plugins, etc.)
 */
function initializeQuiverWebServer(){try{if(void 0===api.WebServer)return console.info("üèπ Quiver: Web server requires Cavalry 2.4.0+"),!1;quiverServer=new api.WebServer;var serverCallbacks={onPost:function(){var request,post=quiverServer.getNextPost();try{request=JSON.parse(post.result)}catch(e){return void console.error("üèπ Quiver: Failed to parse request as JSON")}"importSVG"===request.action&&request.svgCode?handleImportSVG(request):"importFromClipboard"===request.action?handleImportFromClipboard(request):"importFromFigma"===request.action&&request.figmaData?handleImportFromFigma(request):"ping"===request.action?handlePing():(console.error("üèπ Quiver: Unknown action '"+(request.action||"none")+"'"),console.error("   Available actions: importSVG, importFromClipboard, importFromFigma, ping"))}};return quiverServer.listen("127.0.0.1",QUIVER_PORT),quiverServer.addCallbackObject(serverCallbacks),quiverServer.setHighFrequency(),Quiver.serverRunning=!0,console.info("üèπ Quiver API server listening on http://127.0.0.1:"+QUIVER_PORT),!0}catch(e){return console.warn("üèπ Quiver: Could not start web server - "+e.message),!1}}var __loadingIndicatorLayers=[];function getCompDimensions(){var defaultDims={width:1920,height:1080};try{var compId=api.getActiveComp();if(!compId)return defaultDims;var resolution=api.get(compId,"resolution");if(resolution&&resolution.length>=2)return{width:resolution[0],height:resolution[1]};var w=api.get(compId,"resolution.x"),h=api.get(compId,"resolution.y");if(w&&h)return{width:w,height:h}}catch(e){}return defaultDims}var LOADER_TOP_GROUP_NAME="Firing...";
/**
 * Show loading indicator by importing the Firing....svg file
 * Uses Quiver's native SVG import pipeline (processAndImportSVG)
 * Adjusts dimensions to match active composition bounds
 * 
 * Does NOT inject a wrapper group - this caused content to be incorrectly
 * parented to the loader on some systems. Instead, we find and delete
 * the loader's actual top-level group ("Firing...") by name.
 * 
 * @returns {void} - No return value; hideLoadingIndicator finds loader by name
 */function showLoadingIndicator(){try{var compDims=getCompDimensions(),compWidth=compDims.width,compHeight=compDims.height,svgPath=QUIVER_ASSETS_PATH+"quiver_firing-loader_v02.svg",svgContent=null;try{svgContent=api.readFromFile(svgPath)}catch(readError){return}if(!svgContent||""===svgContent.trim())return;var newDialogX=Math.round((compWidth-646.505)/2),newDialogY=Math.round((compHeight-127)/2),offsetX=newDialogX-637,offsetY=newDialogY-476;svgContent=(svgContent=svgContent.replace(/width="1920"\s+height="1080"\s+viewBox="0 0 1920 1080"/,'width="'+compWidth+'" height="'+compHeight+'" viewBox="0 0 '+compWidth+" "+compHeight+'"')).replace(/<rect width="1920" height="1080" fill="black" fill-opacity="0.7"\/>/,'<rect width="'+compWidth+'" height="'+compHeight+'" fill="black" fill-opacity="0.7"/>'),0===offsetX&&0===offsetY||(svgContent=svgContent.replace(/<g id="Firing...">/,'<g id="Firing..." transform="translate('+offsetX+", "+offsetY+')">')),processAndImportSVG(svgContent,{skipFlatten:!0});try{"function"==typeof api.select&&api.select([])}catch(e){}"function"==typeof api.processEvents&&api.processEvents()}catch(e){}}function hideLoadingIndicator(){try{var allLayers=api.getCompLayers(!1);if(!allLayers||0===allLayers.length)return;for(var i=0;i<allLayers.length;i++)try{api.getNiceName(allLayers[i])===LOADER_TOP_GROUP_NAME&&api.deleteLayer(allLayers[i])}catch(e){}}catch(e){}}function handleImportSVG(request){showLoadingIndicator();try{var viewBox;if(request.textData&&request.textData.length>0?setFigmaTextData(request.textData):clearFigmaTextData(),clearCreatedTextShapes(),!processAndImportSVG(request.svgCode))return hideLoadingIndicator(),clearFigmaTextData(),void clearCreatedTextShapes();if(console.info("üèπ Quiver: SVG imported successfully"),request.vectorData&&request.vectorData.length>0)(viewBox=extractViewBox(request.svgCode))||(viewBox={x:0,y:0,width:request.frameWidth||1e3,height:request.frameHeight||1e3}),processStrokeGradientNodes(request.vectorData,viewBox);if(request.emojiData&&request.emojiData.length>0)if(void 0===importEmojisEnabled||importEmojisEnabled)(viewBox=extractViewBox(request.svgCode))||(viewBox={x:0,y:0,width:request.frameWidth||1e3,height:request.frameHeight||1e3}),processEmojiData(request.emojiData,viewBox);clearFigmaTextData(),clearCreatedTextShapes(),"function"==typeof clearEmojiIndexMaps&&clearEmojiIndexMaps(),hideLoadingIndicator();try{void 0!==api.raiseWindow?api.raiseWindow():void 0!==api.requestUserAttention&&api.requestUserAttention()}catch(e){}}catch(e){hideLoadingIndicator(),console.error("üèπ Quiver: Import failed - "+e.message)}}var __processedHybridLayers={},__figmaTextData={},__figmaTextDataByContent={},__createdTextShapes={};function setFigmaTextData(textDataArray){if(__figmaTextData={},__figmaTextDataByContent={},textDataArray&&0!==textDataArray.length)for(var i=0;i<textDataArray.length;i++){var td=textDataArray[i];if(td&&td.name&&(__figmaTextData[td.name]||(__figmaTextData[td.name]=[]),__figmaTextData[td.name].push(td),td.characters)){var contentKey=td.characters.substring(0,50);__figmaTextDataByContent[contentKey]||(__figmaTextDataByContent[contentKey]=td)}}}function getFigmaTextData(name,content,svgPosition){var baseName=name.replace(/_\d+$/,""),allCandidates=[];if(__figmaTextData[baseName])for(var i=0;i<__figmaTextData[baseName].length;i++)allCandidates.push(__figmaTextData[baseName][i]);for(var consecutiveMisses=0,suffix=2;suffix<=50&&consecutiveMisses<5;suffix++){var suffixedName=baseName+"_"+suffix;if(__figmaTextData[suffixedName]){for(var j=0;j<__figmaTextData[suffixedName].length;j++)allCandidates.push(__figmaTextData[suffixedName][j]);consecutiveMisses=0}else consecutiveMisses++}if(baseName!==name&&allCandidates.length,0===allCandidates.length&&name!==baseName&&__figmaTextData[name])for(var k=0;k<__figmaTextData[name].length;k++)allCandidates.push(__figmaTextData[name][k]);if(0===allCandidates.length){if(content){var contentKey=content.substring(0,50);if(__figmaTextDataByContent[contentKey])return __figmaTextDataByContent[contentKey]}return null}var contentMatches=[];if(content)for(var m=0;m<allCandidates.length;m++)allCandidates[m].characters===content&&contentMatches.push(allCandidates[m]);var candidateEntries=contentMatches.length>0?contentMatches:allCandidates;if(1===candidateEntries.length)return candidateEntries[0];if(svgPosition&&(void 0!==svgPosition.x||void 0!==svgPosition.y)){for(var bestMatch=null,bestDistance=1/0,n=0;n<candidateEntries.length;n++){var entry=candidateEntries[n],entryX=void 0!==entry.relativeX?entry.relativeX:entry.x,entryY=void 0!==entry.relativeY?entry.relativeY:entry.y;if(void 0!==entryX&&void 0!==entryY){var distance=Math.abs((entryX||0)-(svgPosition.x||0))+.3*Math.abs((entryY||0)-(svgPosition.y||0));distance<bestDistance&&(bestDistance=distance,bestMatch=entry)}}if(bestMatch&&bestDistance<500)return bestMatch}for(var p=0;p<candidateEntries.length;p++)if(!candidateEntries[p]._used)return candidateEntries[p]._used=!0,candidateEntries[p];return candidateEntries[0]}function clearFigmaTextData(){__figmaTextData={},__figmaTextDataByContent={}}function registerCreatedTextShape(figmaTextName,textShapeId){figmaTextName&&textShapeId&&(__createdTextShapes[figmaTextName]||(__createdTextShapes[figmaTextName]=[]),__createdTextShapes[figmaTextName].push(textShapeId))}function getCreatedTextShape(figmaTextName){if(!figmaTextName)return null;var entries=__createdTextShapes[figmaTextName];if(entries&&entries.length>0)return entries[0];var cleanName=figmaTextName.replace(/[\u{1F000}-\u{1FFFF}]/gu,"").trim();for(var key in __createdTextShapes){if(__createdTextShapes.hasOwnProperty(key))if(key.replace(/[\u{1F000}-\u{1FFFF}]/gu,"").trim()===cleanName||key.indexOf(cleanName)>=0||cleanName.indexOf(key)>=0)return __createdTextShapes[key][0]}return null}function clearCreatedTextShapes(){__createdTextShapes={}}function resetProcessedHybridLayers(){__processedHybridLayers={}}function markLayerAsProcessed(layerId){__processedHybridLayers[layerId]=!0}function isLayerProcessed(layerId){return!0===__processedHybridLayers[layerId]}function processStrokeGradientNodes(vectorDataArray,viewBox){resetProcessedHybridLayers(),console.log("[StrokeGradient] Processing "+vectorDataArray.length+" stroke gradient node(s)...");for(var i=0;i<vectorDataArray.length;i++){var nodeData=vectorDataArray[i];try{console.log('[StrokeGradient] Looking for layer named: "'+nodeData.name+'"');var existingLayerId=findLayerByName(nodeData.name);if(existingLayerId){var foundLayerName="";try{foundLayerName=api.getNiceName(existingLayerId)}catch(e){}console.log('[StrokeGradient] Found layer: "'+foundLayerName+'" (ID: '+existingLayerId+")"),markLayerAsProcessed(existingLayerId);var positionSourceLayerId=existingLayerId;try{if("group"===existingLayerId.split("#")[0]){var groupChildren=api.getChildren(existingLayerId);if(groupChildren&&groupChildren.length>0)for(var gc=0;gc<groupChildren.length;gc++){var childType=groupChildren[gc].split("#")[0];if("editableShape"===childType||"basicShape"===childType||"path"===childType){positionSourceLayerId=groupChildren[gc];break}}}}catch(eGroupCheck){}var existingPos={x:0,y:0};try{existingPos.x=api.get(positionSourceLayerId,"position.x")||0,existingPos.y=api.get(positionSourceLayerId,"position.y")||0}catch(ePos){}var existingRot=0;try{var rawRot=api.get(positionSourceLayerId,"rotation");existingRot="number"==typeof rawRot?rawRot:parseFloat(rawRot)||0}catch(eRot){}var parentId=null,originalIndex=0;try{if(parentId=api.getParent(existingLayerId)){var siblings=api.getChildren(parentId);siblings.length;for(var si=0;si<siblings.length;si++)if(siblings[si]===existingLayerId){originalIndex=si;break}}}catch(eP){}var existingStrokeShader=null,existingFillShader=null,allShaders=[],allFilters=[],existingClippingMasks=[];function collectMasksRecursively(layerId,depth){if(!(depth>3)){try{var masks=getMaskShapesForTarget(layerId);if(masks&&masks.length>0)for(var mi=0;mi<masks.length;mi++)-1===existingClippingMasks.indexOf(masks[mi])&&existingClippingMasks.push(masks[mi])}catch(e){}try{for(var children=api.getChildren(layerId),ci=0;ci<children.length;ci++)collectMasksRecursively(children[ci],depth+1)}catch(e){}}}if(collectMasksRecursively(existingLayerId,0),0===existingClippingMasks.length)try{var clipMaskChildren=api.getAttrChildren(existingLayerId,"masks");if(clipMaskChildren&&clipMaskChildren.length>0)for(var cmc=0;cmc<clipMaskChildren.length;cmc++){var childAttrId=clipMaskChildren[cmc],maskLayerId=null;try{var directValue=api.get(existingLayerId,childAttrId);directValue&&"string"==typeof directValue&&-1!==directValue.indexOf("#")&&(maskLayerId=directValue)}catch(eGet){}if(!maskLayerId)try{var conn=api.getInConnection(existingLayerId,childAttrId);if(conn&&conn.length>0){var maskParts=conn.split(".");maskParts.length>0&&maskParts[0]&&(maskLayerId=maskParts[0])}}catch(eConn){}maskLayerId&&existingClippingMasks.push(maskLayerId)}}catch(eCM){}function getLayerType(layerId){if(!layerId||"string"!=typeof layerId)return"";var hashIndex=layerId.indexOf("#");return hashIndex>0?layerId.substring(0,hashIndex):layerId}var filterTypes=["dropShadowFilter","dropShadow","blurFilter","blur","shadowFilter"];function collectShadersAndFilters(layerId,depth){if(!(depth>3)){for(var d=0;d<depth;d++)0;try{for(var children=api.getChildren(layerId),c=0;c<children.length;c++){var childId=children[c],childType=getLayerType(childId),childName="";try{childName=api.getNiceName(childId)}catch(eN){childName=childId}"gradientShader"===childType&&allShaders.push({id:childId,name:childName});for(var isFilter=!1,ft=0;ft<filterTypes.length;ft++)if(childType===filterTypes[ft]){allFilters.push({id:childId,name:childName,type:childType}),isFilter=!0;break}isFilter||"gradientShader"===childType||"editableShape"!==childType&&"group"!==childType&&"path"!==childType||collectShadersAndFilters(childId,depth+1)}}catch(eFind){}}}collectShadersAndFilters(existingLayerId,0);var hasFigmaFill=nodeData.fills&&nodeData.fills.length>0&&!1!==nodeData.fills[0].visible,hasFigmaGradientFill=hasFigmaFill&&nodeData.fills[0].gradientType;allShaders.length>=2&&hasFigmaGradientFill?(existingStrokeShader=allShaders[0].id,existingFillShader=allShaders[1].id):allShaders.length>=1&&(existingStrokeShader=allShaders[0].id,allShaders.length>=2&&hasFigmaFill&&(existingFillShader=allShaders[1].id));var newLayerId=createPathFromVectorDataWithExistingShaders(nodeData,viewBox,null,existingStrokeShader,existingFillShader,hasFigmaFill,existingPos,existingRot);if(newLayerId){if(parentId)try{if(api.parent(newLayerId,parentId),api.select([newLayerId]),api.bringToFront(),originalIndex>0)for(var m=0;m<originalIndex;m++)api.moveBackward()}catch(eParent){console.error("   Failed to parent/reorder: "+eParent.message)}if(allFilters.length>0)for(var fi=0;fi<allFilters.length;fi++){var filter=allFilters[fi];if(filter&&filter.id){try{api.parent(filter.id,newLayerId)}catch(eParentFilter){console.error("     Failed to re-parent filter: "+eParentFilter.message)}try{api.connect(filter.id,"id",newLayerId,"filters")}catch(eConnFilter){console.error("     Failed to connect filter: "+eConnFilter.message);try{api.connect(filter.id,"id",newLayerId,"deformers")}catch(eConnDeform){console.error("     Deformers fallback also failed: "+eConnDeform.message)}}}else console.error("     Skipping invalid filter at index "+fi)}if(existingClippingMasks.length>0)for(var cmi=0;cmi<existingClippingMasks.length;cmi++){var maskId=existingClippingMasks[cmi];try{api.connect(maskId,"id",newLayerId,"masks");try{api.set(maskId,{hidden:!1})}catch(eVis){}}catch(eConnMask){console.error("     Failed to connect clipping mask: "+eConnMask.message)}}try{var deletingLayerName="";try{deletingLayerName=api.getNiceName(existingLayerId)}catch(e){}console.log('[StrokeGradient] DELETING old layer: "'+deletingLayerName+'" (ID: '+existingLayerId+")"),api.deleteLayer(existingLayerId)}catch(eDel){console.error("   Failed to delete old layer: "+eDel.message)}markLayerAsProcessed(newLayerId)}}else console.log('[StrokeGradient] Layer "'+nodeData.name+'" NOT FOUND - creating new'),createPathFromVectorData(nodeData,viewBox,null)}catch(eNode){console.error("   Failed to process '"+nodeData.name+"': "+eNode.message)}}console.log("[StrokeGradient] Done processing stroke gradients")}function findLayerByName(name){try{var allLayers=api.getCompLayers(!1);if(!allLayers||0===allLayers.length)return null;for(var candidates=[],i=0;i<allLayers.length;i++)try{if(isLayerProcessed(allLayers[i]))continue;var layerName=api.getNiceName(allLayers[i]);candidates.push({id:allLayers[i],name:layerName})}catch(e){}for(var j=0;j<candidates.length;j++)if(candidates[j].name===name)return candidates[j].id;for(var suffix=2;suffix<=20;suffix++)for(var suffixedName=name+"_"+suffix,k=0;k<candidates.length;k++)if(candidates[k].name===suffixedName)return candidates[k].id;return null}catch(e){var errMsg="unknown error";try{errMsg=e.message||String(e)}catch(eStr){errMsg="could not get error message"}console.error("findLayerByName error: "+errMsg)}return null}function createPathFromVectorDataWithExistingShaders(nodeData,viewBox,parentId,existingStrokeShader,existingFillShader,hasFigmaFill,targetPosition,targetRotation){try{if(!nodeData.vectorPaths||0===nodeData.vectorPaths.length)return console.error("   No vector paths in data for '"+nodeData.name+"'"),null;var pathData=nodeData.vectorPaths[0].data;if(!pathData)return console.error("   Empty path data for '"+nodeData.name+"'"),null;var segments=parsePathDataToAbsolute(pathData);if(!segments||0===segments.length)return console.error("   Failed to parse path segments for '"+nodeData.name+"'"),null;for(var path=new cavalry.Path,i=0;i<segments.length;i++){var s=segments[i];if("M"===s.cmd){var p=figmaToCavalryCoord(s.x,s.y,nodeData,viewBox);path.moveTo(p.x,p.y)}else if("L"===s.cmd){p=figmaToCavalryCoord(s.x,s.y,nodeData,viewBox);path.lineTo(p.x,p.y)}else if("C"===s.cmd){var c1=figmaToCavalryCoord(s.cp1x,s.cp1y,nodeData,viewBox),c2=figmaToCavalryCoord(s.cp2x,s.cp2y,nodeData,viewBox),pe=figmaToCavalryCoord(s.x,s.y,nodeData,viewBox);path.cubicTo(c1.x,c1.y,c2.x,c2.y,pe.x,pe.y)}else if("Q"===s.cmd){var cq=figmaToCavalryCoord(s.cpx,s.cpy,nodeData,viewBox);pe=figmaToCavalryCoord(s.x,s.y,nodeData,viewBox);path.quadTo(cq.x,cq.y,pe.x,pe.y)}else"Z"===s.cmd&&path.close()}var centre=null;try{var bb=path.boundingBox();bb&&bb.centre&&(centre={x:bb.centre.x,y:bb.centre.y})}catch(eBB){}centre&&path.translate(-centre.x,-centre.y);var layerId=api.createEditable(path,nodeData.name||"Path");if(parentId&&api.parent(layerId,parentId),centre){var finalPosX=centre.x,finalPosY=centre.y;if(targetPosition&&void 0!==targetPosition.x){var dx=centre.x-targetPosition.x,dy=centre.y-targetPosition.y;Math.sqrt(dx*dx+dy*dy)>50&&(finalPosX=targetPosition.x,finalPosY=targetPosition.y)}api.set(layerId,{"position.x":finalPosX,"position.y":finalPosY})}if(null!=targetRotation){var rotValue="number"==typeof targetRotation?targetRotation:parseFloat(targetRotation)||0;if(0!==rotValue)try{api.set(layerId,{rotation:rotValue})}catch(eRot){console.error("   Failed to apply rotation: "+eRot.message)}}if(hasFigmaFill){api.setFill(layerId,!0);var fillOpacity=1;if(nodeData.fills&&nodeData.fills.length>0&&void 0!==nodeData.fills[0].opacity&&(fillOpacity=nodeData.fills[0].opacity),fillOpacity<1)try{api.set(layerId,{"material.alpha":100*fillOpacity})}catch(eAlpha){console.error("   Failed to set fill opacity: "+eAlpha.message)}if(existingFillShader)try{connectShaderToShape(existingFillShader,layerId),api.parent(existingFillShader,layerId)}catch(eFillShader){console.error("   Failed to connect fill shader: "+eFillShader.message)}else if(nodeData.fills&&nodeData.fills.length>0){var fill=nodeData.fills[0];if("SOLID"===fill.type)api.set(layerId,{"material.materialColor":fill.color});else if(fill.gradientType){var fillShader=createGradientFromFigmaPaint(fill,nodeData.name+"_fill");fillShader&&connectShaderToShape(fillShader,layerId)}}}else api.setFill(layerId,!1);if(nodeData.strokes&&nodeData.strokes.length>0){api.setStroke(layerId,!0),api.set(layerId,{"stroke.width":nodeData.strokeWeight||1});var capStyle=0;"ROUND"===nodeData.strokeCap?capStyle=1:"SQUARE"===nodeData.strokeCap&&(capStyle=2);try{api.set(layerId,{"stroke.capStyle":capStyle})}catch(eCap){}var joinStyle=0;"ROUND"===nodeData.strokeJoin?joinStyle=1:"BEVEL"===nodeData.strokeJoin&&(joinStyle=2);try{api.set(layerId,{"stroke.joinStyle":joinStyle})}catch(eJoin){}if(nodeData.dashPattern&&nodeData.dashPattern.length>0)try{api.set(layerId,{"stroke.dashPatternMode":0});var dashCsv=nodeData.dashPattern.join(", ");api.set(layerId,{"stroke.dashPattern":dashCsv})}catch(eDash){console.error("   Failed to apply dash pattern: "+eDash.message)}if(existingStrokeShader)try{var stroke;connectShaderToStroke(existingStrokeShader,layerId),api.parent(existingStrokeShader,layerId),(stroke=nodeData.strokes&&nodeData.strokes[0])&&stroke.gradientType}catch(eShader){console.error("   Failed to connect stroke shader: "+eShader.message)}else if("SOLID"===(stroke=nodeData.strokes[0]).type)api.set(layerId,{"stroke.strokeColor":stroke.color});else if(stroke.gradientType){var strokeShader=createGradientFromFigmaPaint(stroke,nodeData.name+"_stroke");strokeShader&&connectShaderToStroke(strokeShader,layerId)}}if(nodeData.cornerRadius&&nodeData.cornerRadius>0)try{var bevelId=api.create("bevel","Bevel");bevelId&&(api.set(bevelId,{mode:0}),api.set(bevelId,{radius:nodeData.cornerRadius}),api.connect(bevelId,"id",layerId,"deformers"),api.parent(bevelId,layerId))}catch(eBevel){console.error("   Failed to apply Bevel deformer: "+eBevel.message)}return layerId}catch(e){return console.error("   createPathFromVectorDataWithExistingShaders failed: "+e.message),null}}function createPathFromVectorData(nodeData,viewBox,parentId){try{if(!nodeData.vectorPaths||0===nodeData.vectorPaths.length)return console.error("   No vector paths in data for '"+nodeData.name+"'"),null;var pathData=nodeData.vectorPaths[0].data;if(!pathData)return console.error("   Empty path data for '"+nodeData.name+"'"),null;var segments=parsePathDataToAbsolute(pathData);if(!segments||0===segments.length)return console.error("   Failed to parse path segments for '"+nodeData.name+"'"),null;for(var path=new cavalry.Path,i=0;i<segments.length;i++){var s=segments[i];if("M"===s.cmd){var p=figmaToCavalryCoord(s.x,s.y,nodeData,viewBox);path.moveTo(p.x,p.y)}else if("L"===s.cmd){p=figmaToCavalryCoord(s.x,s.y,nodeData,viewBox);path.lineTo(p.x,p.y)}else if("C"===s.cmd){var c1=figmaToCavalryCoord(s.cp1x,s.cp1y,nodeData,viewBox),c2=figmaToCavalryCoord(s.cp2x,s.cp2y,nodeData,viewBox),pe=figmaToCavalryCoord(s.x,s.y,nodeData,viewBox);path.cubicTo(c1.x,c1.y,c2.x,c2.y,pe.x,pe.y)}else if("Q"===s.cmd){var cq=figmaToCavalryCoord(s.cpx,s.cpy,nodeData,viewBox);pe=figmaToCavalryCoord(s.x,s.y,nodeData,viewBox);path.quadTo(cq.x,cq.y,pe.x,pe.y)}else"Z"===s.cmd&&path.close()}var centre=null;try{var bb=path.boundingBox();bb&&bb.centre&&(centre={x:bb.centre.x,y:bb.centre.y})}catch(eBB){}centre&&path.translate(-centre.x,-centre.y);var layerId=api.createEditable(path,nodeData.name||"Path");if(parentId&&api.parent(layerId,parentId),centre&&api.set(layerId,{"position.x":centre.x,"position.y":centre.y}),nodeData.fills&&nodeData.fills.length>0){var fill=nodeData.fills[0];if("SOLID"===fill.type)api.setFill(layerId,!0),api.set(layerId,{"material.materialColor":fill.color});else if(fill.gradientType){api.setFill(layerId,!0);var fillShader=createGradientFromFigmaPaint(fill,nodeData.name+"_fill");fillShader&&connectShaderToShape(fillShader,layerId)}}else api.setFill(layerId,!1);if(nodeData.strokes&&nodeData.strokes.length>0){var stroke=nodeData.strokes[0];api.setStroke(layerId,!0),api.set(layerId,{"stroke.width":nodeData.strokeWeight||1});var capStyle=0;"ROUND"===nodeData.strokeCap?capStyle=1:"SQUARE"===nodeData.strokeCap&&(capStyle=2);try{api.set(layerId,{"stroke.capStyle":capStyle})}catch(eCap){}var joinStyle=0;"ROUND"===nodeData.strokeJoin?joinStyle=1:"BEVEL"===nodeData.strokeJoin&&(joinStyle=2);try{api.set(layerId,{"stroke.joinStyle":joinStyle})}catch(eJoin){}if(nodeData.dashPattern&&nodeData.dashPattern.length>0)try{api.set(layerId,{"stroke.dashPatternMode":0});var dashCsv=nodeData.dashPattern.join(", ");api.set(layerId,{"stroke.dashPattern":dashCsv})}catch(eDash){console.error("   Failed to apply dash pattern: "+eDash.message)}if("SOLID"===stroke.type)api.set(layerId,{"stroke.strokeColor":stroke.color});else if(stroke.gradientType){var strokeShader=createGradientFromFigmaPaint(stroke,nodeData.name+"_stroke");strokeShader&&connectShaderToStroke(strokeShader,layerId)}}return layerId}catch(e){return console.error("   createPathFromVectorData failed: "+e.message),null}}function figmaToCavalryCoord(x,y,nodeData,viewBox){var frameRelX=x,frameRelY=y;if(nodeData.relativeTransform){var t=nodeData.relativeTransform;frameRelX=t.a*x+t.c*y+t.e,frameRelY=t.b*x+t.d*y+t.f}else frameRelX=x+(nodeData.relativeX||nodeData.x||0),frameRelY=y+(nodeData.relativeY||nodeData.y||0);return svgToCavalryPosition(frameRelX,frameRelY,viewBox)}function createGradientFromFigmaPaint(paintData,name){try{if(!paintData.gradientStops||0===paintData.gradientStops.length)return null;var gradTypeName="radial"===paintData.gradientType?"Radial":"Linear",firstStop=paintData.gradientStops[0],lastStop=paintData.gradientStops[paintData.gradientStops.length-1],gradientName=gradTypeName+" "+(firstStop&&firstStop.color?firstStop.color.toUpperCase():"")+" ‚Üí "+(lastStop&&lastStop.color?lastStop.color.toUpperCase():""),shaderId=api.create("gradientShader",gradientName);if("radial"===paintData.gradientType)try{api.setGenerator(shaderId,"generator","radialGradientShader")}catch(e){}else try{api.setGenerator(shaderId,"generator","linearGradientShader")}catch(e){}if("linear"===paintData.gradientType&&paintData.gradientTransform)try{var t=paintData.gradientTransform,angle=180*Math.atan2(t.b,t.a)/Math.PI;api.set(shaderId,{"generator.rotation":angle})}catch(eRot){}if("radial"===paintData.gradientType)try{if(api.set(shaderId,{"generator.radiusMode":1}),paintData.gradientTransform){t=paintData.gradientTransform;var shapeWidth=paintData.shapeWidth||1,shapeHeight=paintData.shapeHeight||1,centerX=.5*t.a+.5*t.c+t.e,centerY=.5*t.b+.5*t.d+t.f,handle1X=1*t.a+.5*t.c+t.e,handle1Y=1*t.b+.5*t.d+t.f,handle2X=.5*t.a+1*t.c+t.e,handle2Y=.5*t.b+1*t.d+t.f,dx1=(handle1X-centerX)*shapeWidth,dy1=(handle1Y-centerY)*shapeHeight,dist1=Math.sqrt(dx1*dx1+dy1*dy1),dx2=(handle2X-centerX)*shapeWidth,dy2=(handle2Y-centerY)*shapeHeight,dist2=Math.sqrt(dx2*dx2+dy2*dy2),scaleX=dist1/(shapeWidth/2)*100,scaleY=dist2/(shapeHeight/2)*100;api.set(shaderId,{"generator.radiusRatio":1}),api.set(shaderId,{"generator.scale.x":scaleX,"generator.scale.y":scaleY});var rotationDeg=180*Math.atan2(t.b,t.a)/Math.PI;api.set(shaderId,{"generator.rotation":rotationDeg}),void 0!==t.e&&void 0!==t.f&&api.set(shaderId,{"generator.offset.x":t.e,"generator.offset.y":-t.f})}}catch(eRadial){console.warn("[RADIAL GRADIENT FIGMA] Error applying transform: "+eRadial.message)}var colors=paintData.gradientStops.map(function(stop){return stop.color||"#000000"});1===colors.length&&colors.push(colors[0]),api.setGradientFromColors(shaderId,"generator.gradient",colors);for(var i=0;i<paintData.gradientStops.length;i++){var stop=paintData.gradientStops[i];try{var posAttr={};posAttr["generator.gradient."+i+".position"]=stop.position,api.set(shaderId,posAttr)}catch(ePos){}try{var colAttr={};colAttr["generator.gradient."+i+".color"]=colorWithOpacity(stop.color,stop.opacity),api.set(shaderId,colAttr)}catch(eCol){}}return shaderId}catch(e){return console.error("   createGradientFromFigmaPaint failed: "+e.message),null}}function processEmojiData(emojiDataArray,viewBox){if(emojiDataArray&&0!==emojiDataArray.length){for(var emojiNameCounts={},emojisByTextNode={},i=0;i<emojiDataArray.length;i++){emojisByTextNode[textNodeName=(emoji=emojiDataArray[i]).textNodeName||""]||(emojisByTextNode[textNodeName]=[]),emojisByTextNode[textNodeName].push(emoji)}for(var textNodeName in emojisByTextNode)if(emojisByTextNode.hasOwnProperty(textNodeName)){var emojisForNode=emojisByTextNode[textNodeName],textShapeId=getCreatedTextShape(textNodeName);if(textShapeId){var actualWordCount=-1;try{var countSubMeshId=api.create("countSubMeshes","Temp Count");api.connect(textShapeId,"id",countSubMeshId,"inputShape"),api.set(countSubMeshId,{levelMode:2}),actualWordCount=api.get(countSubMeshId,"count"),api.deleteLayer(countSubMeshId)}catch(eCount){console.warn("[Emoji] Could not create Count Sub-Meshes: "+(eCount.message||eCount))}for(var emojiWordData=[],k=0;k<emojisForNode.length;k++){var wordInfo="function"==typeof getWordIndexForEmoji?getWordIndexForEmoji(textNodeName,emojisForNode[k].charIndex):{wordIndex:-1};emojiWordData.push(wordInfo)}try{var applyMaterialId=api.create("applyTextMaterial","Hide Emoji Placeholders"),escapedPlaceholder=(void 0!==emojiPlaceholder&&3===emojiPlaceholder.length?emojiPlaceholder:"[e]").replace(/[\\^$.|?*+()[\]{}]/g,"\\$&");api.set(applyMaterialId,{mode:0,regex:escapedPlaceholder}),api.setFill(applyMaterialId,!0),api.set(applyMaterialId,{"material.alpha":0}),api.connect(applyMaterialId,"id",textShapeId,"materialBehaviours"),api.parent(applyMaterialId,textShapeId)}catch(eApply){console.warn("[Emoji] Could not create Apply Text Material: "+(eApply.message||eApply))}for(var createdEmojiShapes=[],m=0;m<emojisForNode.length;m++){var emoji=emojisForNode[m],emojiWord=emojiWordData[m];try{
// Save the base64 PNG to the Quiver assets folder
var savedPath=null;if(emoji.base64)try{savedPath=_saveDataUriToQuiverFolder(emoji.base64,{attrs:{id:"emoji_"+emoji.emojiChar}})}catch(eSave){console.error("[Emoji] Failed to save image: "+(eSave.message||eSave))}if(!savedPath){console.warn('[Emoji] Could not save emoji image for "'+emoji.emojiChar+'"');continue}var baseEmojiName=emoji.emojiChar;emojiNameCounts[baseEmojiName]||(emojiNameCounts[baseEmojiName]=0),emojiNameCounts[baseEmojiName]++;var emojiName=baseEmojiName;emojiNameCounts[baseEmojiName]>1&&(emojiName=baseEmojiName+"_"+emojiNameCounts[baseEmojiName]);var wordIndex=emojiWord.wordIndex;actualWordCount>0&&wordIndex>=actualWordCount&&(console.warn("[Emoji] Word index "+wordIndex+" exceeds actual count "+actualWordCount+", clamping to "+(actualWordCount-1)),wordIndex=actualWordCount-1);var getSubMeshId=null;try{getSubMeshId=api.create("getSubMeshTransform",emojiName+" Transform"),api.set(getSubMeshId,{levelMode:2,useBoundingBox:!0,index:wordIndex}),api.connect(textShapeId,"id",getSubMeshId,"inputShape")}catch(eSubMesh){console.error("[Emoji] Failed to create Get Sub-Mesh Transform: "+(eSubMesh.message||eSubMesh));continue}var shapeId=null;try{shapeId=api.primitive("rectangle",emojiName)}catch(ePrim){console.error("[Emoji] Failed to create shape: "+(ePrim.message||ePrim));continue}if(!shapeId){console.warn("[Emoji] Could not create shape for emoji");continue}try{api.set(shapeId,{"generator.dimensions":[emoji.width||emoji.fontSize,emoji.height||emoji.fontSize]})}catch(eSet){console.error("[Emoji] Failed to set shape dimensions: "+(eSet.message||eSet))}try{api.connect(getSubMeshId,"position",shapeId,"position"),api.connect(getSubMeshId,"rotation",shapeId,"rotation"),api.connect(getSubMeshId,"scale",shapeId,"scale")}catch(eConnect){console.error("[Emoji] Failed to connect transform: "+(eConnect.message||eConnect))}try{api.parent(getSubMeshId,shapeId)}catch(eParentSub){}try{var textParentId=api.getParent(textShapeId);if(textParentId){api.parent(shapeId,textParentId);for(var siblings=api.getChildren(textParentId),textIndex=-1,si=0;si<siblings.length;si++)if(siblings[si]===textShapeId){textIndex=si;break}if(textIndex>0){var layerAboveText=siblings[textIndex-1];api.reorder(shapeId,layerAboveText)}else api.select([shapeId]),api.bringToFront()}}catch(eLayerOrder){console.warn("[Emoji] Could not reorder layer: "+(eLayerOrder.message||eLayerOrder))}try{var textMasks=getMaskShapesForTarget(textShapeId);if(textMasks&&textMasks.length>0)for(var mi=0;mi<textMasks.length;mi++){var maskLayerId=textMasks[mi];try{try{api.getNiceName(maskLayerId)}catch(eName){}if(api.connect(maskLayerId,"id",shapeId,"masks"),addMaskShapeForTarget(shapeId,maskLayerId),void 0!==__shapesUsedAsMattes&&__shapesUsedAsMattes[maskLayerId])try{api.set(maskLayerId,{hidden:!1})}catch(eVis){}0}catch(eConnect){console.warn("[Emoji] Failed to connect mask "+maskLayerId+": "+(eConnect.message||eConnect))}}}catch(eMask){console.warn("[Emoji] Could not get/apply masks: "+(eMask.message||eMask))}try{var textFilters=getFiltersForTarget(textShapeId);if(textFilters&&textFilters.length>0)for(var fi=0;fi<textFilters.length;fi++){var filterLayerId=textFilters[fi];try{try{api.getNiceName(filterLayerId)}catch(eFName){}api.connect(filterLayerId,"id",shapeId,"filters"),addFilterForTarget(shapeId,filterLayerId)}catch(eFilterConnect){console.warn("[Emoji] Failed to connect filter "+filterLayerId+": "+(eFilterConnect.message||eFilterConnect))}}}catch(eFilter){console.warn("[Emoji] Could not get/apply filters: "+(eFilter.message||eFilter))}var assetId=null;try{api.loadAsset?assetId=api.loadAsset(savedPath,!1):api.importAsset&&(assetId=api.importAsset(savedPath))}catch(eLoad){console.error("[Emoji] Failed to load asset: "+(eLoad.message||eLoad))}if(assetId){var shaderId=null;try{shaderId=api.create("imageShader",emojiName)}catch(eShader){console.error("[Emoji] Failed to create shader: "+(eShader.message||eShader))}if(shaderId){try{api.connect(assetId,"id",shaderId,"image")}catch(eConnAsset){console.error("[Emoji] Failed to connect asset to shader: "+(eConnAsset.message||eConnAsset))}try{var fqSet=!1;try{api.set(shaderId,{filterQuality:imageFilterQuality}),fqSet=!0}catch(eFQ1){}if(!fqSet)try{api.set(shaderId,{"generator.filterQuality":imageFilterQuality})}catch(eFQ2){}}catch(eFQ){}try{api.connect(shaderId,"id",shapeId,"material.colorShaders")}catch(eConnShape){console.error("[Emoji] Failed to connect shader to shape: "+(eConnShape.message||eConnShape))}try{api.parent(shaderId,shapeId)}catch(eParent){}
// Parent the asset under the Quiver group in Assets Window
var quiverGroup=_ensureQuiverAssetGroup();if(quiverGroup)try{api.parent(assetId,quiverGroup)}catch(eAssetParent){}}}try{api.setStroke(shapeId,!1)}catch(eStroke){}try{api.set(shapeId,{"material.materialColor.a":0})}catch(eAlpha){console.error("[Emoji] Failed to set alpha: "+(eAlpha.message||eAlpha))}createdEmojiShapes.push({shapeId:shapeId,emojiChar:emoji.emojiChar})}catch(eEmoji){console.error("[Emoji] Failed to process emoji: "+(eEmoji.message||eEmoji))}}if(createdEmojiShapes.length>=5)try{for(var groupNameEmojis=[],gi=0;gi<createdEmojiShapes.length;gi++)groupNameEmojis.push(createdEmojiShapes[gi].emojiChar);var emojiGroupName=groupNameEmojis.join(" "),emojiGroupId=api.create("group",emojiGroupName),emojiParentId=null;try{emojiParentId=api.getParent(createdEmojiShapes[0].shapeId)}catch(eGetParent){}if(emojiParentId)try{api.parent(emojiGroupId,emojiParentId)}catch(eParentGroup){console.warn("[Emoji] Could not parent group: "+(eParentGroup.message||eParentGroup))}for(var ri=0;ri<createdEmojiShapes.length;ri++)try{api.parent(createdEmojiShapes[ri].shapeId,emojiGroupId)}catch(eReparent){console.warn("[Emoji] Could not re-parent emoji to group: "+(eReparent.message||eReparent))}try{for(siblings=api.getChildren(emojiParentId),textIndex=-1,si=0;si<siblings.length;si++)if(siblings[si]===textShapeId){textIndex=si;break}if(textIndex>0){layerAboveText=siblings[textIndex-1];api.reorder(emojiGroupId,layerAboveText)}else api.select([emojiGroupId]),api.bringToFront()}catch(eReorder){}}catch(eGroup){console.warn("[Emoji] Could not create emoji group: "+(eGroup.message||eGroup))}}else{console.warn('[Emoji] Could not find text shape for "'+textNodeName+'" - using fallback positioning');for(var j=0;j<emojisForNode.length;j++){processEmojiWithFallback(emojisForNode[j],viewBox)}}}}}function processEmojiWithFallback(emoji,viewBox){try{
// Save the base64 PNG to the Quiver assets folder
var savedPath=null;if(emoji.base64)try{savedPath=_saveDataUriToQuiverFolder(emoji.base64,{attrs:{id:"emoji_"+emoji.emojiChar}})}catch(eSave){console.error("[Emoji Fallback] Failed to save image: "+(eSave.message||eSave))}if(!savedPath)return 0;var cavalryPos=svgToCavalryPosition(emoji.x+emoji.width/2,emoji.y+emoji.height/2,viewBox),emojiName="Emoji "+emoji.emojiChar,shapeId=api.primitive("rectangle",emojiName);if(!shapeId)return 0;api.set(shapeId,{"generator.dimensions":[emoji.width,emoji.height],"position.x":cavalryPos.x,"position.y":cavalryPos.y});var assetId=api.loadAsset?api.loadAsset(savedPath,!1):null;if(assetId){var shaderId=api.create("imageShader",emojiName);if(shaderId){api.connect(assetId,"id",shaderId,"image");try{var fqSet=!1;try{api.set(shaderId,{filterQuality:imageFilterQuality}),fqSet=!0}catch(eFQ1){}if(!fqSet)try{api.set(shaderId,{"generator.filterQuality":imageFilterQuality})}catch(eFQ2){}}catch(eFQ){}api.connect(shaderId,"id",shapeId,"material.colorShaders"),api.parent(shaderId,shapeId)}}return api.setStroke(shapeId,!1),api.set(shapeId,{"material.materialColor.a":0}),1}catch(e){return console.error("[Emoji Fallback] Failed: "+(e.message||e)),0}}function handleImportFromClipboard(request){showLoadingIndicator();try{var svg=api.getClipboardText();if(!svg||""===svg.trim())return hideLoadingIndicator(),void console.error("üèπ Quiver: Clipboard is empty");processAndImportSVG(svg),console.info("üèπ Quiver: Clipboard imported successfully"),hideLoadingIndicator()}catch(e){hideLoadingIndicator(),console.error("üèπ Quiver: Clipboard import failed - "+e.message)}}function handleImportFromFigma(request){console.info("üèπ Quiver: Figma import received")}function handlePing(){}function cleanupQuiverWebServer(){try{quiverServer&&Quiver.serverRunning&&("function"==typeof quiverServer.stop&&quiverServer.stop(),quiverServer=null,Quiver.serverRunning=!1,console.info("üèπ Quiver: Web server stopped"))}catch(e){quiverServer=null,Quiver.serverRunning=!1}}Quiver.cleanup=cleanupQuiverWebServer,initializeQuiverWebServer(),ui.show();